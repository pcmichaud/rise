
  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   15.0   Copyright 1985-2017 StataCorp LLC
  Statistics/Data Analysis            StataCorp
                                      4905 Lakeway Drive
     MP - Parallel Edition            College Station, Texas 77845 USA
                                      800-STATA-PC        http://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

Single-user 4-core Stata perpetual license:
       Serial number:  501506229585
         Licensed to:  Pierre Carl Michaud
                       HEC

Notes:
      1.  Stata is running in batch mode.
      2.  Unicode is supported; see help unicode_advice.
      3.  More than 2 billion observations are allowed; see help obs_advice.
      4.  Maximum number of variables is set to 5000; see help set_maxvar.

. ***********************************************************

. * Master program to prepare data, moments and parameters

. * Fonseca, Michaud, Kapteyn and Galama (2017)

. * version 32: March 2017

. * all parameters saved to params

. * figures saved to figures

. * complete log under params/input/control.log

. ***********************************************************

. clear all

. capture log close

. set more off

. 
. * setting home directory of project 

. cd ~/rise
/Users/michaud/rise

. 
. * setup options and data

. do do/setup.do

. 
. 
. * directory for datasource
. global src "~/cedia/Projets/rise-data"

. * make a temporary directory to save temp datasets
. ! mkdir -p $src/temp


. 
. * global graph options
. global fig "graphregion(color(white)) bgcolor(white)"

. * display time stamp
. display "$S_TIME  $S_DATE"
10:09:53  18 Jul 2018

. 
end of do-file

. 
. * construct PSID extract

. do do/extract-psid32.do

. *************************************************
. * Constructing PSID Panel                       *
. * Fonseca, Michaud, Kapteyn and Galama (2012)
. * version 21, November 2012
. * Inputs
. * PSID Cornell Equivalence Files  1980-2005     *
. * wealth files (1984,1989,1994,1999,2001(2)2005 *
. * Individual files (1986, 1994-2005)            *
. * Outputs
. * data/psid_panel.dta                                                   *
. *************************************************
. 
. global fig "graphregion(color(white)) bgcolor(white)"

. **************************
. * append equivalence files
. * from PSID directory
. **************************
. use $src/raw/psid/pequiv_1980.dta, clear

. rensfix _1980

. gen year = 1980

. save $src/temp/psid_panel.dta, replace
file ~/cedia/Projets/rise-data/temp/psid_panel.dta saved

. 
. foreach s of numlist 1981/1997 1999 2001 2003 2005{
  2.         use $src/raw/psid/pequiv_`s'.dta, clear
  3.         rensfix _`s'
  4.         gen year = `s'
  5.         save $src/temp/psid_panel_`s', replace
  6.         use $src/temp/psid_panel.dta, clear
  7.         append using $src/temp/psid_panel_`s'.dta
  8.         save $src/temp/psid_panel.dta, replace
  9.         erase $src/temp/psid_panel_`s'.dta
 10. }
(note: file /Users/michaud/cedia/Projets/rise-data/temp/psid_panel_1981.dta not
>  found)
file ~/cedia/Projets/rise-data/temp/psid_panel_1981.dta saved
(note: variable i11114 was float, now double to accommodate using data's
       values)
(note: variable i11117 was int, now long to accommodate using data's values)
(note: variable e11105 was byte, now int to accommodate using data's values)
(note: variable m11102 was byte, now int to accommodate using data's values)
(label d11112ll already defined)
(label d11102ll already defined)
(label x11104ll already defined)
file ~/cedia/Projets/rise-data/temp/psid_panel.dta saved
(note: file /Users/michaud/cedia/Projets/rise-data/temp/psid_panel_1982.dta not
>  found)
file ~/cedia/Projets/rise-data/temp/psid_panel_1982.dta saved
(label d11112ll already defined)
(label d11102ll already defined)
(label x11104ll already defined)
file ~/cedia/Projets/rise-data/temp/psid_panel.dta saved
(note: file /Users/michaud/cedia/Projets/rise-data/temp/psid_panel_1983.dta not
>  found)
file ~/cedia/Projets/rise-data/temp/psid_panel_1983.dta saved
(note: variable i11115 was int, now long to accommodate using data's values)
(note: variable i11118 was int, now long to accommodate using data's values)
(label d11112ll already defined)
(label d11102ll already defined)
(label x11104ll already defined)
file ~/cedia/Projets/rise-data/temp/psid_panel.dta saved
(note: file /Users/michaud/cedia/Projets/rise-data/temp/psid_panel_1984.dta not
>  found)
file ~/cedia/Projets/rise-data/temp/psid_panel_1984.dta saved
(label d11112ll already defined)
(label d11102ll already defined)
(label x11104ll already defined)
file ~/cedia/Projets/rise-data/temp/psid_panel.dta saved
(note: file /Users/michaud/cedia/Projets/rise-data/temp/psid_panel_1985.dta not
>  found)
file ~/cedia/Projets/rise-data/temp/psid_panel_1985.dta saved
(note: variable d11101 was byte, now int to accommodate using data's values)
(label d11112ll already defined)
(label d11102ll already defined)
(label x11104ll already defined)
file ~/cedia/Projets/rise-data/temp/psid_panel.dta saved
(note: file /Users/michaud/cedia/Projets/rise-data/temp/psid_panel_1986.dta not
>  found)
file ~/cedia/Projets/rise-data/temp/psid_panel_1986.dta saved
(note: variable i11107 was int, now long to accommodate using data's values)
(note: variable m11122 was byte, now float to accommodate using data's
       values)
(note: variable m11123 was byte, now float to accommodate using data's
       values)
(label d11112ll already defined)
(label d11102ll already defined)
(label x11104ll already defined)
file ~/cedia/Projets/rise-data/temp/psid_panel.dta saved
(note: file /Users/michaud/cedia/Projets/rise-data/temp/psid_panel_1987.dta not
>  found)
file ~/cedia/Projets/rise-data/temp/psid_panel_1987.dta saved
(label d11112ll already defined)
(label d11102ll already defined)
(label x11104ll already defined)
file ~/cedia/Projets/rise-data/temp/psid_panel.dta saved
(note: file /Users/michaud/cedia/Projets/rise-data/temp/psid_panel_1988.dta not
>  found)
file ~/cedia/Projets/rise-data/temp/psid_panel_1988.dta saved
(label d11112ll already defined)
(label d11102ll already defined)
(label x11104ll already defined)
file ~/cedia/Projets/rise-data/temp/psid_panel.dta saved
(note: file /Users/michaud/cedia/Projets/rise-data/temp/psid_panel_1989.dta not
>  found)
file ~/cedia/Projets/rise-data/temp/psid_panel_1989.dta saved
(note: variable w11102 was byte, now float to accommodate using data's
       values)
(label d11112ll already defined)
(label d11102ll already defined)
(label x11104ll already defined)
file ~/cedia/Projets/rise-data/temp/psid_panel.dta saved
(note: file /Users/michaud/cedia/Projets/rise-data/temp/psid_panel_1990.dta not
>  found)
file ~/cedia/Projets/rise-data/temp/psid_panel_1990.dta saved
(label d11112ll already defined)
(label d11102ll already defined)
(label x11104ll already defined)
file ~/cedia/Projets/rise-data/temp/psid_panel.dta saved
(note: file /Users/michaud/cedia/Projets/rise-data/temp/psid_panel_1991.dta not
>  found)
file ~/cedia/Projets/rise-data/temp/psid_panel_1991.dta saved
(label d11112ll already defined)
(label d11102ll already defined)
(label x11104ll already defined)
file ~/cedia/Projets/rise-data/temp/psid_panel.dta saved
(note: file /Users/michaud/cedia/Projets/rise-data/temp/psid_panel_1992.dta not
>  found)
file ~/cedia/Projets/rise-data/temp/psid_panel_1992.dta saved
(note: variable i11108 was int, now long to accommodate using data's values)
(label d11112ll already defined)
(label d11102ll already defined)
(label x11104ll already defined)
file ~/cedia/Projets/rise-data/temp/psid_panel.dta saved
(note: file /Users/michaud/cedia/Projets/rise-data/temp/psid_panel_1993.dta not
>  found)
file ~/cedia/Projets/rise-data/temp/psid_panel_1993.dta saved
(label d11112ll already defined)
(label d11102ll already defined)
(label x11104ll already defined)
file ~/cedia/Projets/rise-data/temp/psid_panel.dta saved
(note: file /Users/michaud/cedia/Projets/rise-data/temp/psid_panel_1994.dta not
>  found)
file ~/cedia/Projets/rise-data/temp/psid_panel_1994.dta saved
(note: variable i11101 was long, now double to accommodate using data's
       values)
(note: variable i11103 was long, now double to accommodate using data's
       values)
(note: variable i11104 was long, now double to accommodate using data's
       values)
(note: variable i11105 was float, now double to accommodate using data's
       values)
(note: variable i11106 was long, now double to accommodate using data's
       values)
(note: variable i11107 was long, now double to accommodate using data's
       values)
(note: variable i11108 was long, now double to accommodate using data's
       values)
(note: variable i11117 was long, now double to accommodate using data's
       values)
(note: variable e11101 was int, now float to accommodate using data's values)
(note: variable i11110 was long, now double to accommodate using data's
       values)
(label d11112ll already defined)
(label d11102ll already defined)
(label x11104ll already defined)
file ~/cedia/Projets/rise-data/temp/psid_panel.dta saved
(note: file /Users/michaud/cedia/Projets/rise-data/temp/psid_panel_1995.dta not
>  found)
file ~/cedia/Projets/rise-data/temp/psid_panel_1995.dta saved
(label d11112ll already defined)
(label d11102ll already defined)
(label x11104ll already defined)
file ~/cedia/Projets/rise-data/temp/psid_panel.dta saved
(note: file /Users/michaud/cedia/Projets/rise-data/temp/psid_panel_1996.dta not
>  found)
file ~/cedia/Projets/rise-data/temp/psid_panel_1996.dta saved
(label d11112ll already defined)
(label d11102ll already defined)
(label x11104ll already defined)
file ~/cedia/Projets/rise-data/temp/psid_panel.dta saved
(note: file /Users/michaud/cedia/Projets/rise-data/temp/psid_panel_1997.dta not
>  found)
file ~/cedia/Projets/rise-data/temp/psid_panel_1997.dta saved
(label d11112ll already defined)
(label d11102ll already defined)
(label x11104ll already defined)
file ~/cedia/Projets/rise-data/temp/psid_panel.dta saved
(note: file /Users/michaud/cedia/Projets/rise-data/temp/psid_panel_1999.dta not
>  found)
file ~/cedia/Projets/rise-data/temp/psid_panel_1999.dta saved
(label d11112ll already defined)
(label d11102ll already defined)
(label x11104ll already defined)
file ~/cedia/Projets/rise-data/temp/psid_panel.dta saved
(note: file /Users/michaud/cedia/Projets/rise-data/temp/psid_panel_2001.dta not
>  found)
file ~/cedia/Projets/rise-data/temp/psid_panel_2001.dta saved
(label d11112ll already defined)
(label d11102ll already defined)
(label x11104ll already defined)
file ~/cedia/Projets/rise-data/temp/psid_panel.dta saved
(note: file /Users/michaud/cedia/Projets/rise-data/temp/psid_panel_2003.dta not
>  found)
file ~/cedia/Projets/rise-data/temp/psid_panel_2003.dta saved
(note: variable i11115 was long, now double to accommodate using data's
       values)
(note: variable i11116 was long, now double to accommodate using data's
       values)
(label d11112ll already defined)
(label d11102ll already defined)
(label x11104ll already defined)
file ~/cedia/Projets/rise-data/temp/psid_panel.dta saved
(note: file /Users/michaud/cedia/Projets/rise-data/temp/psid_panel_2005.dta not
>  found)
file ~/cedia/Projets/rise-data/temp/psid_panel_2005.dta saved
file ~/cedia/Projets/rise-data/temp/psid_panel.dta saved

. 
. save $src/temp/psid_panel.dta, replace
file ~/cedia/Projets/rise-data/temp/psid_panel.dta saved

. 
. **************************
. *  select sample
. **************************
. use $src/temp/psid_panel.dta, clear

. * generate death indicator (not used)
. gen death = x11103==2 if x11103!=0

. * Selecting sample
. * only household heads
. keep if d11105==1
(285,791 observations deleted)

. * age range
. keep if d11101>21&d11101<100
(3,332 observations deleted)

. * drop oversample
. keep if x11104ll==11
(66,320 observations deleted)

. save $src/temp/psid_panel.dta, replace
file ~/cedia/Projets/rise-data/temp/psid_panel.dta saved

. 
. 
. *****************************
. * merge wealth information 
. * from wealth files
. *****************************
. 
. * merge back wealth data to psid_panel
. use $src/temp/psid_panel.dta, clear

. sort x11102 year

. foreach s of numlist 1984 1989 1994 1999 2001 2003 2005 {
  2.         capture drop _merge
  3.         merge m:1 x11102 year using $src/raw/psid/wlth_`s'.dta, update
  4.         drop _merge
  5.         sort x11102 year
  6. }
(note: variable x11102 was int, now float to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                        92,656
        from master                    89,405  (_merge==1)
        from using                      3,251  (_merge==2)

    matched                             3,687
        not updated                     3,687  (_merge==3)
        missing updated                     0  (_merge==4)
        nonmissing conflict                 0  (_merge==5)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        95,945
        from master                    92,580  (_merge==1)
        from using                      3,365  (_merge==2)

    matched                             3,763
        not updated                         0  (_merge==3)
        missing updated                 3,763  (_merge==4)
        nonmissing conflict                 0  (_merge==5)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        99,242
        from master                    95,143  (_merge==1)
        from using                      4,099  (_merge==2)

    matched                             4,565
        not updated                         0  (_merge==3)
        missing updated                 4,565  (_merge==4)
        nonmissing conflict                 0  (_merge==5)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                       100,546
        from master                    98,658  (_merge==1)
        from using                      1,888  (_merge==2)

    matched                             5,149
        not updated                         0  (_merge==3)
        missing updated                 5,149  (_merge==4)
        nonmissing conflict                 0  (_merge==5)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                       102,321
        from master                   100,284  (_merge==1)
        from using                      2,037  (_merge==2)

    matched                             5,411
        not updated                         0  (_merge==3)
        missing updated                 5,411  (_merge==4)
        nonmissing conflict                 0  (_merge==5)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                       104,282
        from master                   102,073  (_merge==1)
        from using                      2,209  (_merge==2)

    matched                             5,659
        not updated                         0  (_merge==3)
        missing updated                 5,659  (_merge==4)
        nonmissing conflict                 0  (_merge==5)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                       106,656
        from master                   104,281  (_merge==1)
        from using                      2,375  (_merge==2)

    matched                             5,660
        not updated                         0  (_merge==3)
        missing updated                 5,660  (_merge==4)
        nonmissing conflict                 0  (_merge==5)
    -----------------------------------------

. 
. save $src/temp/psid_panel.dta, replace
file ~/cedia/Projets/rise-data/temp/psid_panel.dta saved

. 
. ****************************
. * merge CPI information (BLS)
. ****************************
. use $src/temp/psid_panel.dta, clear

. sort year

. merge year using $src/raw/other/cpi.dta, nokeep
(note: you are using old merge syntax; see [D] merge for new syntax)
variable year does not uniquely identify observations in the master data

. drop c19* c20*

. save $src/temp/psid_panel.dta, replace
file ~/cedia/Projets/rise-data/temp/psid_panel.dta saved

. 
. *****************************
. * rename variables
. *****************************
. 
. use $src/temp/psid_panel.dta, clear

. rename x11101ll hhidpn

. rename x11102 hhid

. rename d11103 hrace

. rename d11106 hhsize

. rename d11107 hhchild

. rename l11101 hgstate

. global ids "hhidpn hhid year hgstate hrace hhsize hhchild"

. 
. rename d11101 rage

. rename d11102ll rsex

. rename d11112ll rrace

. rename d11104  rmstat

. rename d11108 reduc

. rename d11109 redyrs

. global demo "rage rsex rrace rmstat reduc redyrs"

. 
. rename w11102 wghh

. rename w11101 wgid_cs

. rename w11103 wgid_long

. global weights "wghh wgid_*"

. 
. rename i11103 hiearn

. rename i11104 hicap

. rename i11106 hipriv

. rename i11107 hipub

. rename i11108 hissben

. rename i11117 hipen

. rename i11118 hiothr

. rename i11110 riearn

. global inc "hi* riearn"

. 
. rename h11103 hnkid1

. rename h11104 hnkid4

. rename h11105 hnkid7

. rename h11106 hnkid12

. rename h11110 hnothr

. rename h11112 hspouse

. global hhcomp "hnkid* hnothr hspouse"

. 
. rename e11101 rhours

. rename e11102 rwork

. rename e11103 rpart

. rename e11105 rjcocc

. rename e11106 rjcind

. global work "rhours rwork rpart rjcocc rjcind"

. 
. rename m11101 rhstay

. rename m11102 rhdays

. rename m11104 rhvigact

. rename m11105 rstroke

. rename m11106 rhibpe

. rename m11107 rdiabe

. rename m11108 rcance

. rename m11109 rpsyce

. rename m11110 rarthe

. rename m11111 rheare

. rename m11112 radl_breathe

. rename m11113 radl_climb

. rename m11114 radl_bathing

. rename m11115 radl_dress

. rename m11116 radl_bed

. rename m11117 riadl_shop

. rename m11118 riadl_walk

. rename m11119 riadl_hwork

. rename m11120 riadl_kneel

. rename m11121 riadl_vig

. rename m11122 rhgt

. rename m11123 rwgt

. rename m11124 rdis

. rename m11126 rshlt

. global medc "rhstay rhdays"

. global risk "rhvigact rhgt rwgt"

. global cond "rstroke rhibpe rdiabe rcance rpsyce rarthe rheare death "

. global adls "radl_*"

. global iadls "riadl_*"

. global shlt "rdis rshlt" 

. 
. rename S16 hatotn

. rename S17 hatota

. global wlth "hatotn hatota"

. 
. ***************************
. * Keep variables of interest
. ***************************
. 
. keep $ids $demo $weights $inc $hhcomp $work $medc $risk $cond $adls $iadls $s
> hlt $wlth cpi

. order $ids $demo $weights $inc $hhcomp $work $medc $risk $cond $adls $iadls $
> shlt $wlth cpi

. sort hhidpn year

. by hhidpn: gen time = _n

. by hhidpn: gen period = _N

. by hhidpn: gen fyear = year[1]

. by hhidpn: gen lyear = year[_N]

. tsset hhidpn time
       panel variable:  hhidpn (unbalanced)
        time variable:  time, 1 to 22
                delta:  1 unit

. 
. ************************************
. * convert to real 2005 dollars
. ************************************
. foreach var of varlist $inc $wlth {
  2.         replace `var' = `var'/cpi*195.3
  3. } 
(77,971 real changes made, 360 to missing)
(47,137 real changes made, 380 to missing)
(19,014 real changes made, 364 to missing)
(16,578 real changes made, 2,719 to missing)
(22,046 real changes made, 364 to missing)
(14,480 real changes made, 365 to missing)
variable hiothr was long now double
(5,983 real changes made, 236 to missing)
(74,005 real changes made, 364 to missing)
(48,457 real changes made)
(49,207 real changes made)

. gen rbyr = year - rage
(19,224 missing values generated)

. save $src/temp/psid_panel.dta, replace
file ~/cedia/Projets/rise-data/temp/psid_panel.dta saved

. 
. 
. ******************************
. * getting labor force status
. * from raw individual file (not necessariy to run)
. ******************************
. 
. global empq "ER30353 ER30382 ER30411 ER30441 ER30474 ER30509 ER30545 ER30580 
> ER30616 ER30653 ER30699 ER30744 ER30816 ER33111 ER33211 ER33311 ER33411 ER335
> 12 ER33612 ER33712 ER33813"

. use ER30001 ER30002  $empq using $src/raw/psid/indfile_fam.dta, clear

. gen hhidpn = ER30001*1000 + ER30002

. sort hhidpn

. rename ER30353 status1981

. rename ER30382 status1982

. rename ER30411 status1983

. rename ER30441 status1984

. rename ER30474 status1985

. rename ER30509 status1986

. rename ER30545 status1987

. rename ER30580 status1988

. rename ER30616 status1989

. rename ER30653 status1990

. rename ER30699 status1991

. rename ER30744 status1992

. rename ER30816 status1993

. rename ER33111 status1994

. rename ER33211 status1995

. rename ER33311 status1996

. rename ER33411 status1997

. rename ER33512 status1999

. rename ER33612 status2001

. rename ER33712 status2003

. rename ER33813 status2005

. reshape long status, i(hhidpn) 
(note: j = 1981 1982 1983 1984 1985 1986 1987 1988 1989 1990 1991 1992 1993 199
> 4 1995 1996 1997 1999 2001 2003 2005)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                    67271   -> 1.4e+06
Number of variables                  24   ->       5
j variable (21 values)                    ->   _j
xij variables:
   status1981 status1982 ... status2005   ->   status
-----------------------------------------------------------------------------

. rename _j year

. gen unemp = status==3 if status!=9&status!=0
(1,084,161 missing values generated)

. gen disab = status==5 if status!=9&status!=0
(1,084,161 missing values generated)

. sort hhidpn year

. save $src/temp/status.dta, replace
(note: file /Users/michaud/cedia/Projets/rise-data/temp/status.dta not found)
file ~/cedia/Projets/rise-data/temp/status.dta saved

. 
. *******************************************
. * update status for 1994 to 2005 
. * using files created using individual data
. *******************************************
. 
. use $src/temp/psid_panel.dta, clear

. sort hhidpn year

. merge m:1 hhidpn year using $src/temp/status.dta
(note: variable hhidpn was long, now double to accommodate using data's
       values)

    Result                           # of obs.
    -----------------------------------------
    not matched                     1,345,859
        from master                    22,742  (_merge==1)
        from using                  1,323,117  (_merge==2)

    matched                            89,574  (_merge==3)
    -----------------------------------------

. drop if _merge==2
(1,323,117 observations deleted)

. drop _merge

. save $src/temp/psid_panel.dta, replace
file ~/cedia/Projets/rise-data/temp/psid_panel.dta saved

. erase $src/temp/status.dta

. 
. ***********************************************
. * clean variables and create final PSID dataset
. ***********************************************
. 
. use $src/temp/psid_panel.dta, clear

. 
. * ids
. global ids "hhidpn hhid year wgid_cs"

. 
. * equivalence scale
. egen totkids  = rowtotal(hnkid*)

. gen hnadults = hhsize - totkids
(19,224 missing values generated)

. gen eqscale = (hnadults + 0.7*totkids)^0.7
(19,224 missing values generated)

. recode hhsize (6/max=6)
(hhsize: 872 changes made)

. recode hspouse (2=.), gen(spouse)
(7 differences between hspouse and spouse)

. label var spouse "spouse in household"

. 
. * Education 
. gen rskill=1 if (reduc==3)
(71,700 missing values generated)

. replace rskill=0 if (reduc==1|reduc==2)
(49,152 real changes made)

. label def skill 0 "no college" 1 "college"

. label values rskill skill

. * cohort groups (3 is reference for all analysis)
. #d ;
delimiter now ;
. recode rbyr (min/1925=1) (1926/1935=2) (1935/1945=3) (1946/1955=4) (1956/1965
> =5) (1966/max=6), gen(rbyr_c);
(93092 differences between rbyr and rbyr_c)

. #d cr
delimiter now cr
. 
. char rbyr_c[omit] 3

. label var rbyr_c "birth year group (1935-1945=3, ref)"

. 
. recode rsex (1=1) (2=0), gen(male)
(21717 differences between rsex and male)

. label var male "resp. is male"

. global group "rage rskill rbyr_c eqscale hhsize hnadults eqscale male spouse"

. 
. * Assets 
. rename hatota ass

. replace ass = . if ass>2e6
(518 real changes made, 518 to missing)

. replace ass = ass
(0 real changes made)

. 
. * Earnings
. replace riearn = riearn
(0 real changes made)

. gen logriearn = log(riearn)  if riearn!=0&missing(rhours)==0
(38,807 missing values generated)

. * drop the obs with earnings > 350k < 5k
. replace logriearn = . if riearn>3.5e5&missing(riearn)==0
(280 real changes made, 280 to missing)

. replace logriearn = . if riearn<5e3
(3,640 real changes made, 3,640 to missing)

. * drop those who work too many or too few hours
. replace logriearn = . if rhours>6000
(4 real changes made, 4 to missing)

. replace logriearn = . if rhours<100
(184 real changes made, 184 to missing)

. * wage
. gen rwage = riearn / rhours if rhours>0
(37,866 missing values generated)

. gen logrwage = log(rwage)
(39,024 missing values generated)

. global earn "riearn logriearn rwage logrwage"

. 
. * other household income
. replace hiearn = hiearn
(0 real changes made)

. replace hipub = hipub
(0 real changes made)

. replace hissben = hissben
(0 real changes made)

. replace hipen = hipen
(0 real changes made)

. replace hiothr = hiothr
(0 real changes made)

. gen otherinc = (hiearn -riearn) 
(19,588 missing values generated)

. label var otherinc "other household income (spouse)"

. global other "otherinc hipen hissben"

. 
. * Health status and mortality
. replace rshlt = 6 - rshlt
(72,634 real changes made, 14,525 to missing)

. gen rshlt3=.
(112,316 missing values generated)

. replace rshlt3=1 if (rshlt==1|rshlt==2)
(11,827 real changes made)

. replace rshlt3=2 if (rshlt==3)
(20,458 real changes made)

. replace rshlt3=3 if (rshlt==4|rshlt==5)
(46,282 real changes made)

. 
. label define rshlt3f 1 "bad" 2 "good" 3 "excellent"

. label value rshlt3 rshlt3f

. label variable rshlt3 "health status (3 cat)"

. 
. gen rshlt2=.
(112,316 missing values generated)

. replace rshlt2=1 if (rshlt3==2|rshlt3==3)
(66,740 real changes made)

. replace rshlt2=0 if (rshlt3==1)
(11,827 real changes made)

. label def rshlt2 0 "fair/poor" 1 "good or better"

. label values rshlt2 rshlt2

. 
. gen bmi = rwgt/(rhgt)^2
(87,181 missing values generated)

. label var bmi "bmi of respondent"

. gen obese = bmi>=30 if missing(bmi)==0
(87,181 missing values generated)

. label var obese "respondent is obese (bmi>30)"

. global health "rshlt* death bmi obese"

. 
. * claiming
. sort hhidpn year

. bysort hhidpn: gen n = _n

. tsset hhidpn n
       panel variable:  hhidpn (unbalanced)
        time variable:  n, 1 to 22
                delta:  1 unit

. gen ssclaim  = f.hissben>0 if hissben==0&missing(f.hissben)==0
(48,970 missing values generated)

. replace ssclaim = . if rage<=61
(60,977 real changes made, 60,977 to missing)

. replace ssclaim = . if rage>=70
(426 real changes made, 426 to missing)

. 
. * generate not participating (unemployed or disabled), not used
. gen nlfp = 0 if status==1|status==2
(46,465 missing values generated)

. replace nlfp = 1 if status==3
(2,900 real changes made)

. 
. gen nlfp2 = 0 if status==1|status==2
(46,465 missing values generated)

. replace nlfp2 = 1 if status==3
(2,900 real changes made)

. 
. global lfp "rwork ssclaim rpart"

. 
. order $ids $group ass $earn $other $health $lfp

. keep $ids $group ass $earn $other $health $lfp

. label var ass "net household assets"

. label var year "year of interview"

. label var death "dead next wave"

. label var eqscale "equivalence scale"

. label var rskill "education level, 2 cat"

. label var logriearn "log earnings"

. label var rshlt2 "health status (2 cat)"

. label var ssclaim "claiming status (2 cat)"

. 
. * drop if age is missing
. drop if rage==.
(19,224 observations deleted)

. 
. * keep males
. keep if male==1
(21,717 observations deleted)

. 
. * drop if health not available
. drop if rshlt==.
(11,197 observations deleted)

. 
. * merge life table information (HMD, mortality.org: michaud@rand.org, pass = 
> usual)
. merge m:1 male year rage using $src/raw/other/mortality.dta

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,471
        from master                         0  (_merge==1)
        from using                      4,471  (_merge==2)

    matched                            60,178  (_merge==3)
    -----------------------------------------

. drop if _merge==2
(4,471 observations deleted)

. label var mx "one-year mortality rate from HMD, age,gender,year"

. 
. * save final dataset
. label data "Fonseca, Michaud, Kapteyn and Galama (2017) - PSID extract, ver32
> "

. save $src/data/psid_extract.dta, replace
file ~/cedia/Projets/rise-data/data/psid_extract.dta saved

. 
. exit 

end of do-file


. 
. * construct MEPS extract (matched with NHIS for mortality follow-up)

. do do/meps_selected9608_32.do

. **************************
. ** Consolidated MEPS data
. **Revision of the paper for Restud 2017
. ** Authours Fonseca-Michaud-Kapteyn-Galama
. ** Period 1996-2008
. ***http://meps.ahrq.gov/mepsweb/
. **********************************
. 
. ****PC's directions
. global mepsdir  "$src/raw/MEPS"

. global mepsout "$src/data/outdata/MEPS"

. 
. *LIST OF FILE NUMBERS FOR ANNUAL CONSOLIDATED FILE 1996 - 2008
. *global csdlist  12 20 28 38 50 60      70      79      89      97      105  
>    113     121
. global csdlist   50 60  70      79      89      97      105     113     121

. *LIST OF FILE NUMBERS FOR MEDICAL CONDITIONS FILE 2000 = 2008
. *Note: I changed the name hc006r to h6 for the year 1996
. *global condlist 6 18 27 37 52  61      69      78      87      96      104  
>    112     120
. global condlist 52      61      69      78      87      96      104     112  
>    120

. *LIST OF TWO-DIGIT YEARS - NEEDED TO RENAME VARIABLES
. *global yrlist 96 97 98 99 00 01 02 03 04 05 06 07 08 
. global yrlist 00 01 02 03 04 05 06 07 08 

. 
. *******************************************
. * Selected cost and disease variables from MEPS
. 
. *******************************************
. 
. ***1996
. fdause "$mepsdir/h12.ssp"

. 
.         ren inscope1 inscop31

.         ren inscope2 inscop42

.         ren marry96x marry53x

. 
.         * Rename variables
.         ren inscop96 inscopend

.         ren age96x age

.         *ren perwt96f perwt
.         ren wtdper96 perwt

.         gen male = sex == 1 if sex < .

.         *ren famwt96f famwt 
.         ren famsze96 famsze 

.         ren educyr96 educyear

.         ren region96 region53

.         
. *** MEDICAL Expenditures;
.         foreach item in exp slf mcr mcd prv va ofd wcp opr opu osr{
  2.                 ren tot`item'96 meps`item'
  3.         }

.         gen yr = 1996

. 
. *** Utilization variables ; 
.         foreach item in obtotv ipdis ipngtd {  
  2.                 ren `item'96 `item' 
  3.         }

.         
.         ren obtotv doctim 

.         ren ipdis  hsptim

.         ren ipngtd hspnit

. 
. **Health
.                 ren iadlhlp1 iadlhp53 

.                 ren adlhelp1 adlhlp53

.                 ren rtehlth1 rthlth53

.                 ren mnthlth1 mnhlth53   

.         
. ***Total income
.         ren ttlpnx  totinc      

.         
. ***Insurance variables;
. *       foreach item in triev mcrev mcdev opaev opbev unins inscov {  
. *               ren `item'96 `item' 
. *       }
. *perwt not found for 1996
. *diabdx53 hibpdx53 chddx53 angidx53 midx53 ohrtdx53 strkdx53 emphdx53 asthdx5
> 3 bmindx53 adsmok42
.         gen panel96 = 1

.         #d;
delimiter now ;
.         keep dupersid perwt yr male educyear age racex hispanx marry53x
>         meps* doctim hsptim hspnit  
>         duid famidyr famrfpyr famszeyr 
>         iadlhp53 adlhlp53 
>         region53 
>         rthlth53 mnhlth53 panel96
>         totinc
>         empst* selfcm* numemp* insc* held* offer* ;

.         * just the last years indcat* occc*;
.         #d cr
delimiter now cr
.         
.     save "$mepsout/m1996.dta", replace  
(note: file /Users/michaud/cedia/Projets/rise-data/data/outdata/MEPS/m1996.dta 
> not found)
file ~/cedia/Projets/rise-data/data/outdata/MEPS/m1996.dta saved

.         
.         
. *****1997
. 
. fdause "$mepsdir/h20.ssp"

. 
. 
.         * Rename variables
.         ren inscop97 inscopend

.         ren age97x age

.         *ren perwt97f perwt
.         ren wtdper97 perwt

.         gen male = sex == 1 if sex < .

.         *ren famwt97f famwt 
.         ren famsze97 famsze 

.         ren educyr97 educyear

. *** MEDICAL Expenditures;
.         foreach item in exp slf mcr mcd prv va ofd wcp opr opu osr{
  2.                 ren tot`item'97 meps`item'
  3.         }

.         gen yr = 1997

. 
. *** Utilization variables ; 
.         foreach item in obtotv ipdis ipngtd {  
  2.                 ren `item'97 `item' 
  3.         }

.         
.         ren obtotv doctim 

.         ren ipdis  hsptim

.         ren ipngtd hspnit

. 
.         
. ***Total income
.         ren ttlp97x  totinc     

.                 
. ***Insurance variables;
. *       foreach item in triev mcrev mcdev opaev opbev unins inscov {  
. *               ren `item'97 `item' 
. *       }
. *perwt  no found in 1997
. *       diabdx53 hibpdx53 chddx53 angidx53 midx53 ohrtdx53 strkdx53 emphdx53 
> asthdx53 bmindx53 adsmok42
. 
.         #d;
delimiter now ;
.         keep dupersid perwt yr male educyear age racex hispanx marry53x
>         meps* doctim hsptim hspnit 
>         duid famidyr famrfpyr famszeyr 
>         iadlhp53 adlhlp53 
>         region53 
>         rthlth53 mnhlth53 panel97
>         totinc
>         empst* selfcm* numemp* insc* held* offer* ;

.         * just the last years indcat* occc*;
.         #d cr
delimiter now cr
.         
.     save "$mepsout/m1997.dta", replace          
(note: file /Users/michaud/cedia/Projets/rise-data/data/outdata/MEPS/m1997.dta 
> not found)
file ~/cedia/Projets/rise-data/data/outdata/MEPS/m1997.dta saved

.         
. *****1998
. fdause "$mepsdir/h28.ssp

. 
. 
.         * Rename variables
.         ren inscop98 inscopend

.         ren age98x age

.         *ren perwt98f perwt
.         ren wtdper98 perwt

.         gen male = sex == 1 if sex < .

.         *ren famwt98f famwt 
.         ren famsze98 famsze 

.         ren educyr98 educyear

. *** MEDICAL Expenditures;
.         foreach item in exp slf mcr mcd prv va ofd wcp opr opu osr{
  2.                 ren tot`item'98 meps`item'
  3.         }

.         gen yr = 1998

. 
. *** Utilization variables ; 
.         foreach item in obtotv ipdis ipngtd {  
  2.                 ren `item'98 `item' 
  3.         }

.         
.         ren obtotv doctim 

.         ren ipdis  hsptim

.         ren ipngtd hspnit

.         
. ***Total income
.         ren ttlp98x  totinc             

.         
. ***Insurance variables;
. *       foreach item in triev mcrev mcdev opaev opbev unins inscov {  
. *               ren `item'98 `item' 
. *       }
. *perwt  no found in 1998
. *       diabdx53 hibpdx53 chddx53 angidx53 midx53 ohrtdx53 strkdx53 emphdx53 
> asthdx53 bmindx53 adsmok42
. 
.         #d;
delimiter now ;
.         keep dupersid perwt yr male educyear age racex hispanx marry53x
>         meps* doctim hsptim hspnit 
>         duid famidyr famrfpyr famszeyr panel98
>         iadlhp53 adlhlp53 
>         region53 
>         rthlth53 mnhlth53
>         totinc
>         empst* selfcm* numemp* insc* held* offer* ;

.         * just the last years indcat* occc*;
.         #d cr
delimiter now cr
.         
.     save "$mepsout/m1998.dta", replace          
(note: file /Users/michaud/cedia/Projets/rise-data/data/outdata/MEPS/m1998.dta 
> not found)
file ~/cedia/Projets/rise-data/data/outdata/MEPS/m1998.dta saved

. 
. *****1999
. 
. fdause "$mepsdir/h38.ssp"

. 
. 
.         * Rename variables
.         ren inscop99 inscopend

.         ren age99x age

.         ren perwt99f perwt

.         gen male = sex == 1 if sex < .

.         ren famwt99f famwt 

.         ren famsze99 famsze 

. 
. *** MEDICAL Expenditures;
.         foreach item in exp slf mcr mcd prv va ofd wcp opr opu osr{
  2.                 ren tot`item'99 meps`item'
  3.         }

.         gen yr = 1999

. 
. *** Utilization variables ; 
.         foreach item in obtotv ipdis ipngtd {  
  2.                 ren `item'99 `item' 
  3.         }

.         
.         ren obtotv doctim 

.         ren ipdis  hsptim

.         ren ipngtd hspnit

.         
. ***Total income
.         ren ttlp99x  totinc     

.                 
. ***Insurance variables;
. *       foreach item in triev mcrev mcdev opaev opbev unins inscov {  
. *               ren `item'99 `item' 
. *       }
. *perwt  no found in 1998
. *       diabdx53 hibpdx53 chddx53 angidx53 midx53 ohrtdx53 strkdx53 emphdx53 
> asthdx53 bmindx53 adsmok42
. 
.         #d;
delimiter now ;
.         keep dupersid perwt yr male educyear age racex hispanx marry53x
>         meps* doctim hsptim hspnit 
>         duid famidyr famrfpyr famszeyr panel99
>         iadlhp53 adlhlp53 
>         region53 
>         rthlth53 mnhlth53
>         totinc
>         empst* selfcm* numemp* insc* held* offer* ;

.         * just the last years indcat* occc*;
.         #d cr
delimiter now cr
.         
.     save "$mepsout/m1999.dta", replace          
(note: file /Users/michaud/cedia/Projets/rise-data/data/outdata/MEPS/m1999.dta 
> not found)
file ~/cedia/Projets/rise-data/data/outdata/MEPS/m1999.dta saved

. 
.         
.         
.         
. *******2000-2008
. forvalues frsyr = 2000/2008  {
  2.         
.         local fnumid = `frsyr' - 2000 + 1
  3.         local v =  word("$yrlist", `fnumid')
  4.         local fnum = word("$csdlist", `fnumid')
  5.         local i = `frsyr' - 2000
  6.         local pan = "0`i'"
  7.         drop _all
  8.         fdause "$mepsdir/h`fnum'.ssp"
  9.         if `frsyr' == 1996 {
 10.                 ren inscope1 inscop31
 11.                 ren inscope2 inscop42
 12.                 ren marry96x marry53x
 13.                 ren iadlhlp1 iadlhp53 
 14.                 ren adlhelp1 adlhlp53
 15.         }
 16.         
.         if `frsyr' < 1999{
 17.                 ren wtdper`v' perwt`v'f
 18.                 ren educyr`v' educyear
 19.         }
 20.         
.         if `frsyr' == 2000 {
 21.                 gen bmindx53 = (weight53 * 0.4545)/(hghtft53*0.3048+hghtin
> 53*0.0254)^2
 22.                 replace bmindx53 = . if weight53 <0 |hghtft53 < 0 | hghtin
> 53  < 0 
 23.         }
 24.         
.         if `frsyr' > 2004 {
 25.                 ren educyr educyear
 26.         }
 27.         
.         if `frsyr' > 2006 {
 28.                 foreach oldvar in diabdx hibpdx chddx angidx midx ohrtdx s
> trkdx emphdx asthdx  { 
 29.                         ren `oldvar' `oldvar'53
 30.                 }
 31.         }
 32.         * Only keep those with positive weights and in scope
.         * keep if perwt`v'f > 0 & perwt`v'f < . & insc1231 == 1
.         * keep if perwt`v'f > 0 & perwt`v'f < .
.         
.         * Rename variables
.         ren inscop`v' inscopend
 33.         ren age`v'x age
 34.         ren perwt`v'f perwt
 35.         gen male = sex == 1 if sex < .
 36.         *ren famwt`v'f famwt 
.         ren famsze`v' famsze
 37.         ren ttlp`v'  totinc
 38.         
. *** MEDICAL Expenditures;
.         foreach item in exp slf mcr mcd prv va ofd wcp opr opu osr{
 39.                 ren tot`item'`v' meps`item'
 40.         }
 41.         gen yr = `frsyr'
 42. 
. *** Utilization variables ; 
.         foreach item in obtotv ipdis ipngtd {  
 43.                 ren `item'`v' `item' 
 44.         }
 45.         
.         ren obtotv doctim 
 46.         ren ipdis  hsptim
 47.         ren ipngtd hspnit
 48.         
. ***Insurance variables;
. *       foreach item in triev mcrev mcdev opaev opbev unins inscov {  
. *               ren `item'`v' `item' 
. *       }
. 
.         
.         
. *no famwt 96    
.         if (`frsyr' >= 2005) {
 49.                 gen panel`pan' = panel
 50.         }       
 51.         #d;
delimiter now ;
.         keep dupersid yr male educyear age racex hispanx marry53x
>         meps* doctim hsptim hspnit perwt 
>         duid famidyr famrfpyr famszeyr 
>         iadlhp53 adlhlp53 diabdx53 hibpdx53 chddx53 angidx53 midx53 ohrtdx53 
> strkdx53 emphdx53 asthdx53 bmindx53 adsmok42
>         region53 
>         rthlth53 mnhlth53 panel`pan'
>         totinc
>         empst* selfcm* numemp* insc* held* offer* ;
 52.         * just the last years indcat* occc*;
.         #d cr
delimiter now cr
.         save "$mepsout/m`frsyr'.dta", replace
 53. }
(8,433 real changes made, 8,433 to missing)
(note: file /Users/michaud/cedia/Projets/rise-data/data/outdata/MEPS/m2000.dta 
> not found)
file ~/cedia/Projets/rise-data/data/outdata/MEPS/m2000.dta saved
(note: file /Users/michaud/cedia/Projets/rise-data/data/outdata/MEPS/m2001.dta 
> not found)
file ~/cedia/Projets/rise-data/data/outdata/MEPS/m2001.dta saved
(note: file /Users/michaud/cedia/Projets/rise-data/data/outdata/MEPS/m2002.dta 
> not found)
file ~/cedia/Projets/rise-data/data/outdata/MEPS/m2002.dta saved
(note: file /Users/michaud/cedia/Projets/rise-data/data/outdata/MEPS/m2003.dta 
> not found)
file ~/cedia/Projets/rise-data/data/outdata/MEPS/m2003.dta saved
(note: file /Users/michaud/cedia/Projets/rise-data/data/outdata/MEPS/m2004.dta 
> not found)
file ~/cedia/Projets/rise-data/data/outdata/MEPS/m2004.dta saved
(note: file /Users/michaud/cedia/Projets/rise-data/data/outdata/MEPS/m2005.dta 
> not found)
file ~/cedia/Projets/rise-data/data/outdata/MEPS/m2005.dta saved
(note: file /Users/michaud/cedia/Projets/rise-data/data/outdata/MEPS/m2006.dta 
> not found)
file ~/cedia/Projets/rise-data/data/outdata/MEPS/m2006.dta saved
(note: file /Users/michaud/cedia/Projets/rise-data/data/outdata/MEPS/m2007.dta 
> not found)
file ~/cedia/Projets/rise-data/data/outdata/MEPS/m2007.dta saved
(note: file /Users/michaud/cedia/Projets/rise-data/data/outdata/MEPS/m2008.dta 
> not found)
file ~/cedia/Projets/rise-data/data/outdata/MEPS/m2008.dta saved

. 
. * Combine mutiple years of cost data
. 
. drop _all

. set obs 1
number of observations (_N) was 0, now 1

. gen t = 1

. forvalues i = 2008(-1)1996{
  2.         append using "$mepsout/m`i'.dta"
  3.         erase "$mepsout/m`i'.dta"
  4. }

. drop if t == 1
(1 observation deleted)

. drop t

. save "$mepsout/csd", replace
(note: file /Users/michaud/cedia/Projets/rise-data/data/outdata/MEPS/csd.dta no
> t found)
file ~/cedia/Projets/rise-data/data/outdata/MEPS/csd.dta saved

. 
. 
. *****************************************************
. ****** From 1996 to 2008
. ******SELF REPORTED CONDITIONS
. *****************************************************
. 
. 
. clear

. set more off

. clear matrix

. set seed 2344234

. set trace off

. 
. 
. global mepsdir  "$src/raw/MEPS"

. global mepsout "$src/data/outdata/MEPS"

. 
. 
. *LIST OF FILE NUMBERS FOR ANNUAL CONSOLIDATED FILE 1996 - 2008
. global csdlist  12 20 28 38 50 60       70      79      89      97      105  
>    113     121

. *global csdlist   50 60 70      79      89      97      105     113     121
. *LIST OF FILE NUMBERS FOR MEDICAL CONDITIONS FILE 2000 = 2008
. *Note: I changed the name hc006r to h6 for the year 1996
. global condlist 6 18 27 37 52   61      69      78      87      96      104  
>    112     120

. *global condlist 52     61      69      78      87      96      104     112  
>    120
. *LIST OF TWO-DIGIT YEARS - NEEDED TO RENAME VARIABLES
. global yrlist 96 97 98 99 00 01 02 03 04 05 06 07 08 

. *global yrlist 00 01 02 03 04 05 06 07 08 
. 
. 
. 
. 
. *******************************************
. * Selected self-reported conditions from conditions file
. *******************************************
. #d;
delimiter now ;
.         use "$mepsout/csd", clear ;

.         sort dupersid yr, stable ;

.         tempfile old ;

.         save `old', replace ;
(note: file /var/folders/lb/r8wr59px1n3fq8fcwnkslzp00000gn/T//St38335.000001 no
> t found)
file /var/folders/lb/r8wr59px1n3fq8fcwnkslzp00000gn/T//St38335.000001 saved

.  set trace off ;

. forvalues i = 1996/2008 { ;
  2.         dis "year `i'" ;
  3.         local fnumid = `i' - 1996 + 1 ;
  4.         local fnum = word("$condlist", `fnumid');
  5.                 fdause "$mepsdir/h`fnum'.ssp", clear ;
  6.         keep dupersid cccodex ;
  7.         * Destring cccodex ;
.         destring cccodex, gen(ncccodex)  ;
  8.         gen cancrecr = 1 if inrange(ncccodex, 11, 21) | inrange(ncccodex, 
> 24,45) ;
  9.         gen heartecr = 1 if inrange(ncccodex, 96,97) | inrange(ncccodex, 1
> 00,108) ;
 10.         * gen lungecr  = 1 if inrange(ncccodex, 127,127) | inrange(ncccode
> x, 129,134) ;
.         gen lungecr  = 1 if inlist(ncccodex, 127,129,130,131,132) ;
 11.                 gen diabecr  = 1 if inlist(ncccodex, 49,50) ;
 12.         gen hibpecr  = 1 if inlist(ncccodex, 98,99) ;
 13.         gen strokecr = 1 if inlist(ncccodex, 109,110,112,113) ;
 14.         gen kdny1cr = 1 if inlist(ncccodex,156,158,161) ;
 15.         gen kdny2cr = 1 if inlist(ncccodex,156,158,160,161);
 16.                 * One observation per person ;
.         sort dupersid, stable;
 17.         foreach v in diabe hibpe stroke hearte lunge cancre kdny1 kdny2 { 
> ;
 18.                 by dupersid: egen cum = total(`v'cr == 1) ;
 19.                 by dupersid: replace `v' = cum  >= 1 ;
 20.                 drop cum ;
 21.         } ;
 22.         by dupersid: keep if _n == 1 ;
 23.                 gen yr = `i' ;
 24.         merge 1:1 dupersid yr using `old' ;
 25.         tab _merge ;
 26.         qui count if _merge == 1 ;
 27.         if r(N) > 0 { ;
 28.                 dis "NO matched file in CSD: " r(N);
 29.         };
 30.         drop if _merge == 1 ;
 31.         drop _merge;
 32.         keep if yr == `i' ;
 33.                 foreach v in diabe hibpe stroke hearte lunge cancre kdny1 
> kdny2 { ;
 34.                 replace `v'cr = 0 if `v'cr!= 1 ;
 35.         };
 36.                 drop *codex ;
 37.         sort dupersid yr, stable ;
 38.         save "$mepsout/c`i'", replace ;
 39.  } ;
year 1996
cccodex: all characters numeric; ncccodex generated as int
(75,716 missing values generated)
(74,720 missing values generated)
(75,037 missing values generated)
(75,536 missing values generated)
(74,181 missing values generated)
(76,245 missing values generated)
(76,305 missing values generated)
(76,186 missing values generated)
(75536 real changes made)
(74181 real changes made)
(76245 real changes made)
(74720 real changes made)
(75037 real changes made)
(75716 real changes made)
(76305 real changes made)
(76186 real changes made)
(56,874 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                       384,861
        from master                         0  (_merge==1)
        from using                    384,861  (_merge==2)

    matched                            19,552  (_merge==3)
    -----------------------------------------

                 _merge |      Freq.     Percent        Cum.
------------------------+-----------------------------------
         using only (2) |    384,861       95.17       95.17
            matched (3) |     19,552        4.83      100.00
------------------------+-----------------------------------
                  Total |    404,413      100.00
(0 observations deleted)
(381,812 observations deleted)
(3,049 real changes made)
(3,049 real changes made)
(3,049 real changes made)
(3,049 real changes made)
(3,049 real changes made)
(3,049 real changes made)
(3,049 real changes made)
(3,049 real changes made)
(note: file /Users/michaud/cedia/Projets/rise-data/data/outdata/MEPS/c1996.dta 
> not found)
file ~/cedia/Projets/rise-data/data/outdata/MEPS/c1996.dta saved
year 1997
cccodex: all characters numeric; ncccodex generated as int
(108,759 missing values generated)
(106,827 missing values generated)
(107,734 missing values generated)
(108,269 missing values generated)
(106,049 missing values generated)
(109,449 missing values generated)
(109,689 missing values generated)
(109,512 missing values generated)
(108269 real changes made)
(106049 real changes made)
(109449 real changes made)
(106827 real changes made)
(107734 real changes made)
(108759 real changes made)
(109689 real changes made)
(109512 real changes made)
(81,560 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                       376,114
        from master                         0  (_merge==1)
        from using                    376,114  (_merge==2)

    matched                            28,299  (_merge==3)
    -----------------------------------------

                 _merge |      Freq.     Percent        Cum.
------------------------+-----------------------------------
         using only (2) |    376,114       93.00       93.00
            matched (3) |     28,299        7.00      100.00
------------------------+-----------------------------------
                  Total |    404,413      100.00
(0 observations deleted)
(369,862 observations deleted)
(6,252 real changes made)
(6,252 real changes made)
(6,252 real changes made)
(6,252 real changes made)
(6,252 real changes made)
(6,252 real changes made)
(6,252 real changes made)
(6,252 real changes made)
(note: file /Users/michaud/cedia/Projets/rise-data/data/outdata/MEPS/c1997.dta 
> not found)
file ~/cedia/Projets/rise-data/data/outdata/MEPS/c1997.dta saved
year 1998
cccodex: all characters numeric; ncccodex generated as int
(71,813 missing values generated)
(70,526 missing values generated)
(71,304 missing values generated)
(71,374 missing values generated)
(69,819 missing values generated)
(72,292 missing values generated)
(72,458 missing values generated)
(72,337 missing values generated)
(71374 real changes made)
(69819 real changes made)
(72292 real changes made)
(70526 real changes made)
(71304 real changes made)
(71813 real changes made)
(72458 real changes made)
(72337 real changes made)
(53,041 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                       384,878
        from master                         0  (_merge==1)
        from using                    384,878  (_merge==2)

    matched                            19,535  (_merge==3)
    -----------------------------------------

                 _merge |      Freq.     Percent        Cum.
------------------------+-----------------------------------
         using only (2) |    384,878       95.17       95.17
            matched (3) |     19,535        4.83      100.00
------------------------+-----------------------------------
                  Total |    404,413      100.00
(0 observations deleted)
(380,341 observations deleted)
(4,537 real changes made)
(4,537 real changes made)
(4,537 real changes made)
(4,537 real changes made)
(4,537 real changes made)
(4,537 real changes made)
(4,537 real changes made)
(4,537 real changes made)
(note: file /Users/michaud/cedia/Projets/rise-data/data/outdata/MEPS/c1998.dta 
> not found)
file ~/cedia/Projets/rise-data/data/outdata/MEPS/c1998.dta saved
year 1999
cccodex: all characters numeric; ncccodex generated as int
(69,134 missing values generated)
(67,994 missing values generated)
(68,771 missing values generated)
(68,712 missing values generated)
(67,136 missing values generated)
(69,681 missing values generated)
(69,790 missing values generated)
(69,646 missing values generated)
(68712 real changes made)
(67136 real changes made)
(69681 real changes made)
(67994 real changes made)
(68771 real changes made)
(69134 real changes made)
(69790 real changes made)
(69646 real changes made)
(50,151 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                       384,667
        from master                         0  (_merge==1)
        from using                    384,667  (_merge==2)

    matched                            19,746  (_merge==3)
    -----------------------------------------

                 _merge |      Freq.     Percent        Cum.
------------------------+-----------------------------------
         using only (2) |    384,667       95.12       95.12
            matched (3) |     19,746        4.88      100.00
------------------------+-----------------------------------
                  Total |    404,413      100.00
(0 observations deleted)
(379,795 observations deleted)
(4,872 real changes made)
(4,872 real changes made)
(4,872 real changes made)
(4,872 real changes made)
(4,872 real changes made)
(4,872 real changes made)
(4,872 real changes made)
(4,872 real changes made)
(note: file /Users/michaud/cedia/Projets/rise-data/data/outdata/MEPS/c1999.dta 
> not found)
file ~/cedia/Projets/rise-data/data/outdata/MEPS/c1999.dta saved
year 2000
cccodex: all characters numeric; ncccodex generated as int
(71,816 missing values generated)
(70,620 missing values generated)
(71,529 missing values generated)
(71,332 missing values generated)
(69,608 missing values generated)
(72,369 missing values generated)
(72,506 missing values generated)
(72,388 missing values generated)
(71332 real changes made)
(69608 real changes made)
(72369 real changes made)
(70620 real changes made)
(71529 real changes made)
(71816 real changes made)
(72506 real changes made)
(72388 real changes made)
(52,571 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                       384,360
        from master                         0  (_merge==1)
        from using                    384,360  (_merge==2)

    matched                            20,053  (_merge==3)
    -----------------------------------------

                 _merge |      Freq.     Percent        Cum.
------------------------+-----------------------------------
         using only (2) |    384,360       95.04       95.04
            matched (3) |     20,053        4.96      100.00
------------------------+-----------------------------------
                  Total |    404,413      100.00
(0 observations deleted)
(379,317 observations deleted)
(5,043 real changes made)
(5,043 real changes made)
(5,043 real changes made)
(5,043 real changes made)
(5,043 real changes made)
(5,043 real changes made)
(5,043 real changes made)
(5,043 real changes made)
(note: file /Users/michaud/cedia/Projets/rise-data/data/outdata/MEPS/c2000.dta 
> not found)
file ~/cedia/Projets/rise-data/data/outdata/MEPS/c2000.dta saved
year 2001
cccodex: all characters numeric; ncccodex generated as int
(101,443 missing values generated)
(99,844 missing values generated)
(100,829 missing values generated)
(100,704 missing values generated)
(98,295 missing values generated)
(102,175 missing values generated)
(102,320 missing values generated)
(102,136 missing values generated)
(100704 real changes made)
(98295 real changes made)
(102175 real changes made)
(99844 real changes made)
(100829 real changes made)
(101443 real changes made)
(102320 real changes made)
(102136 real changes made)
(75,265 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                       377,189
        from master                         0  (_merge==1)
        from using                    377,189  (_merge==2)

    matched                            27,224  (_merge==3)
    -----------------------------------------

                 _merge |      Freq.     Percent        Cum.
------------------------+-----------------------------------
         using only (2) |    377,189       93.27       93.27
            matched (3) |     27,224        6.73      100.00
------------------------+-----------------------------------
                  Total |    404,413      100.00
(0 observations deleted)
(370,857 observations deleted)
(6,332 real changes made)
(6,332 real changes made)
(6,332 real changes made)
(6,332 real changes made)
(6,332 real changes made)
(6,332 real changes made)
(6,332 real changes made)
(6,332 real changes made)
(note: file /Users/michaud/cedia/Projets/rise-data/data/outdata/MEPS/c2001.dta 
> not found)
file ~/cedia/Projets/rise-data/data/outdata/MEPS/c2001.dta saved
year 2002
cccodex: all characters numeric; ncccodex generated as int
(119,558 missing values generated)
(117,405 missing values generated)
(118,943 missing values generated)
(118,547 missing values generated)
(115,665 missing values generated)
(120,399 missing values generated)
(120,553 missing values generated)
(120,298 missing values generated)
(118547 real changes made)
(115665 real changes made)
(120399 real changes made)
(117405 real changes made)
(118943 real changes made)
(119558 real changes made)
(120553 real changes made)
(120298 real changes made)
(89,399 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                       373,017
        from master                         0  (_merge==1)
        from using                    373,017  (_merge==2)

    matched                            31,396  (_merge==3)
    -----------------------------------------

                 _merge |      Freq.     Percent        Cum.
------------------------+-----------------------------------
         using only (2) |    373,017       92.24       92.24
            matched (3) |     31,396        7.76      100.00
------------------------+-----------------------------------
                  Total |    404,413      100.00
(0 observations deleted)
(365,248 observations deleted)
(7,769 real changes made)
(7,769 real changes made)
(7,769 real changes made)
(7,769 real changes made)
(7,769 real changes made)
(7,769 real changes made)
(7,769 real changes made)
(7,769 real changes made)
(note: file /Users/michaud/cedia/Projets/rise-data/data/outdata/MEPS/c2002.dta 
> not found)
file ~/cedia/Projets/rise-data/data/outdata/MEPS/c2002.dta saved
year 2003
cccodex: all characters numeric; ncccodex generated as int
(105,250 missing values generated)
(103,316 missing values generated)
(104,771 missing values generated)
(104,278 missing values generated)
(101,738 missing values generated)
(105,937 missing values generated)
(106,044 missing values generated)
(105,809 missing values generated)
(104278 real changes made)
(101738 real changes made)
(105937 real changes made)
(103316 real changes made)
(104771 real changes made)
(105250 real changes made)
(106044 real changes made)
(105809 real changes made)
(78,792 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                       376,926
        from master                         0  (_merge==1)
        from using                    376,926  (_merge==2)

    matched                            27,487  (_merge==3)
    -----------------------------------------

                 _merge |      Freq.     Percent        Cum.
------------------------+-----------------------------------
         using only (2) |    376,926       93.20       93.20
            matched (3) |     27,487        6.80      100.00
------------------------+-----------------------------------
                  Total |    404,413      100.00
(0 observations deleted)
(370,198 observations deleted)
(6,728 real changes made)
(6,728 real changes made)
(6,728 real changes made)
(6,728 real changes made)
(6,728 real changes made)
(6,728 real changes made)
(6,728 real changes made)
(6,728 real changes made)
(note: file /Users/michaud/cedia/Projets/rise-data/data/outdata/MEPS/c2003.dta 
> not found)
file ~/cedia/Projets/rise-data/data/outdata/MEPS/c2003.dta saved
year 2004
cccodex: all characters numeric; ncccodex generated as int
(105,716 missing values generated)
(103,735 missing values generated)
(105,187 missing values generated)
(104,573 missing values generated)
(101,849 missing values generated)
(106,379 missing values generated)
(106,528 missing values generated)
(106,302 missing values generated)
(104573 real changes made)
(101849 real changes made)
(106379 real changes made)
(103735 real changes made)
(105187 real changes made)
(105716 real changes made)
(106528 real changes made)
(106302 real changes made)
(79,398 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                       377,073
        from master                         0  (_merge==1)
        from using                    377,073  (_merge==2)

    matched                            27,340  (_merge==3)
    -----------------------------------------

                 _merge |      Freq.     Percent        Cum.
------------------------+-----------------------------------
         using only (2) |    377,073       93.24       93.24
            matched (3) |     27,340        6.76      100.00
------------------------+-----------------------------------
                  Total |    404,413      100.00
(0 observations deleted)
(370,010 observations deleted)
(7,063 real changes made)
(7,063 real changes made)
(7,063 real changes made)
(7,063 real changes made)
(7,063 real changes made)
(7,063 real changes made)
(7,063 real changes made)
(7,063 real changes made)
(note: file /Users/michaud/cedia/Projets/rise-data/data/outdata/MEPS/c2004.dta 
> not found)
file ~/cedia/Projets/rise-data/data/outdata/MEPS/c2004.dta saved
year 2005
cccodex: all characters numeric; ncccodex generated as int
(103,862 missing values generated)
(101,955 missing values generated)
(103,261 missing values generated)
(102,590 missing values generated)
(99,638 missing values generated)
(104,512 missing values generated)
(104,652 missing values generated)
(104,443 missing values generated)
(102590 real changes made)
(99638 real changes made)
(104512 real changes made)
(101955 real changes made)
(103261 real changes made)
(103862 real changes made)
(104652 real changes made)
(104443 real changes made)
(78,001 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                       377,559
        from master                         0  (_merge==1)
        from using                    377,559  (_merge==2)

    matched                            26,854  (_merge==3)
    -----------------------------------------

                 _merge |      Freq.     Percent        Cum.
------------------------+-----------------------------------
         using only (2) |    377,559       93.36       93.36
            matched (3) |     26,854        6.64      100.00
------------------------+-----------------------------------
                  Total |    404,413      100.00
(0 observations deleted)
(370,452 observations deleted)
(7,107 real changes made)
(7,107 real changes made)
(7,107 real changes made)
(7,107 real changes made)
(7,107 real changes made)
(7,107 real changes made)
(7,107 real changes made)
(7,107 real changes made)
(note: file /Users/michaud/cedia/Projets/rise-data/data/outdata/MEPS/c2005.dta 
> not found)
file ~/cedia/Projets/rise-data/data/outdata/MEPS/c2005.dta saved
year 2006
cccodex: all characters numeric; ncccodex generated as int
(104,151 missing values generated)
(102,292 missing values generated)
(103,720 missing values generated)
(102,649 missing values generated)
(99,631 missing values generated)
(104,843 missing values generated)
(104,954 missing values generated)
(104,707 missing values generated)
(102649 real changes made)
(99631 real changes made)
(104843 real changes made)
(102292 real changes made)
(103720 real changes made)
(104151 real changes made)
(104954 real changes made)
(104707 real changes made)
(77,964 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                       377,211
        from master                         0  (_merge==1)
        from using                    377,211  (_merge==2)

    matched                            27,202  (_merge==3)
    -----------------------------------------

                 _merge |      Freq.     Percent        Cum.
------------------------+-----------------------------------
         using only (2) |    377,211       93.27       93.27
            matched (3) |     27,202        6.73      100.00
------------------------+-----------------------------------
                  Total |    404,413      100.00
(0 observations deleted)
(370,268 observations deleted)
(6,943 real changes made)
(6,943 real changes made)
(6,943 real changes made)
(6,943 real changes made)
(6,943 real changes made)
(6,943 real changes made)
(6,943 real changes made)
(6,943 real changes made)
(note: file /Users/michaud/cedia/Projets/rise-data/data/outdata/MEPS/c2006.dta 
> not found)
file ~/cedia/Projets/rise-data/data/outdata/MEPS/c2006.dta saved
year 2007
cccodex: all characters numeric; ncccodex generated as int
(93,140 missing values generated)
(91,114 missing values generated)
(92,740 missing values generated)
(91,849 missing values generated)
(88,712 missing values generated)
(93,835 missing values generated)
(94,051 missing values generated)
(93,841 missing values generated)
(91849 real changes made)
(88712 real changes made)
(93835 real changes made)
(91114 real changes made)
(92740 real changes made)
(93140 real changes made)
(94051 real changes made)
(93841 real changes made)
(70,021 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                       380,188
        from master                         0  (_merge==1)
        from using                    380,188  (_merge==2)

    matched                            24,225  (_merge==3)
    -----------------------------------------

                 _merge |      Freq.     Percent        Cum.
------------------------+-----------------------------------
         using only (2) |    380,188       94.01       94.01
            matched (3) |     24,225        5.99      100.00
------------------------+-----------------------------------
                  Total |    404,413      100.00
(0 observations deleted)
(373,449 observations deleted)
(6,739 real changes made)
(6,739 real changes made)
(6,739 real changes made)
(6,739 real changes made)
(6,739 real changes made)
(6,739 real changes made)
(6,739 real changes made)
(6,739 real changes made)
(note: file /Users/michaud/cedia/Projets/rise-data/data/outdata/MEPS/c2007.dta 
> not found)
file ~/cedia/Projets/rise-data/data/outdata/MEPS/c2007.dta saved
year 2008
cccodex: all characters numeric; ncccodex generated as int
(100,991 missing values generated)
(98,357 missing values generated)
(100,257 missing values generated)
(99,705 missing values generated)
(96,165 missing values generated)
(101,718 missing values generated)
(101,973 missing values generated)
(101,758 missing values generated)
(99705 real changes made)
(96165 real changes made)
(101718 real changes made)
(98357 real changes made)
(100257 real changes made)
(100991 real changes made)
(101973 real changes made)
(101758 real changes made)
(76,141 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                       378,385
        from master                         0  (_merge==1)
        from using                    378,385  (_merge==2)

    matched                            26,028  (_merge==3)
    -----------------------------------------

                 _merge |      Freq.     Percent        Cum.
------------------------+-----------------------------------
         using only (2) |    378,385       93.56       93.56
            matched (3) |     26,028        6.44      100.00
------------------------+-----------------------------------
                  Total |    404,413      100.00
(0 observations deleted)
(371,347 observations deleted)
(7,038 real changes made)
(7,038 real changes made)
(7,038 real changes made)
(7,038 real changes made)
(7,038 real changes made)
(7,038 real changes made)
(7,038 real changes made)
(7,038 real changes made)
(note: file /Users/michaud/cedia/Projets/rise-data/data/outdata/MEPS/c2008.dta 
> not found)
file ~/cedia/Projets/rise-data/data/outdata/MEPS/c2008.dta saved

.  #d cr
delimiter now cr
. 
. drop _all

. set obs 1
number of observations (_N) was 0, now 1

. gen t = 1

. forvalues i = 2008(-1)1996{
  2.         append using "$mepsout/c`i'.dta"
  3.         erase "$mepsout/c`i'.dta"
  4. }

. drop if t == 1
(1 observation deleted)

. drop t

.         
.         label var diabecr "Diabetes CCC code 049/050" 

.         label var hibpecr "hypertension CCC code 098/099" 

.         label var strokecr "Stroke CCC code 109/110/112/113"  

.         label var lungecr "Lung disease CCC code 127/129-134"  

.         label var heartecr "Heart disease CCC code 96/97/100 to 108"  

.         label var cancrecr "Cancer (except skin) CCC code 11-21/24-45"  

.         label var kdny1cr "CKD CCC code 156/158/161"    

.         label var kdny2cr "CKD CCC code 156/158/160/161" 

.                         
.                 
.         ******************************  
.         * Recode variables              
.         ******************************  
.         
.         * Recode health conditions in MEPS
.         gen hearte = 0 

.         label var hearte "CHD/ANGINA/MI/OTHER heart problems"

.         foreach v in chd angi mi ohrt { 
  2.                 replace hearte = 1 if `v'dx53 == 1
  3.         }
(7,268 real changes made)
(2,037 real changes made)
(2,284 real changes made)
(9,297 real changes made)

.         foreach v in chd angi mi ohrt { 
  2.                 replace hearte = . if `v'dx53 < 0 & hearte == 0
  3.         }
(91,432 real changes made, 91,432 to missing)
(38 real changes made, 38 to missing)
(20 real changes made, 20 to missing)
(76 real changes made, 76 to missing)

.         
.         gen diabe = diabdx53 == 1 if inlist(diabdx53,1,2)
(128,211 missing values generated)

.         label var diabe "Ever diagnosed with diabetes"

.         gen hibpe = hibpdx53 == 1 if inlist(hibpdx53,1,2)
(197,545 missing values generated)

.         label var hibpe "Ever diagnosed with high blood pressure"

.         gen stroke = strkdx53 == 1 if inlist(strkdx53,1,2)
(197,218 missing values generated)

.         label var stroke "Ever diagnosed with stroke"

.         gen lunge   = emphdx53 == 1 if inlist(emphdx53,1,2)
(197,200 missing values generated)

.         label var lunge "Ever diagnosed with emphysema"

.         
.         gen adl1p = adlhlp53 == 1 if inlist(adlhlp53,1,2)
(6,236 missing values generated)

.         label var adl1p "One or more ADLs"

. 
.         gen iadl1 = iadlhp53 == 1 if inlist(iadlhp53,1,2)
(6,040 missing values generated)

.         replace iadl1 = 0 if adl1p == 1 
(5,535 real changes made)

.         label var iadl1 "IADL only"

.                 
.         ************
.         * Recode demographic variables 
.         ************
.         
.         gen age5659 = inrange(age,56,59) if age < .

.         label var age5659 "Aged 56-59"

.         gen age6064 = inrange(age,60,64) if age < . 

.         label var age6064 "Aged 60-64"

.         
.         ren hispanx hispan

.         replace hispan = 0 if hispan == 2
(300,262 real changes made)

.         gen black = racex == 2 & hispan == 0 if inrange(racex,1,6)
(66 missing values generated)

.         label var black "R is non-hispanic black"

.         
.         *** Note: in year 2000 and 2001, coding of racex is 1 to 5, and black
>  is 4
.         replace black = racex == 4 & hispan == 0 if inrange(racex,1,5) & inli
> st(yr,2000,2001)
(8,667 real changes made)

.         
.         #d;
delimiter now ;
.         recode educyear (0/11 = 1 "1 less than HS") (12 = 2 "2 HS grad")
>         (13/15 = 3 "3 Some college") (16/17 = 4 "4 College grad") (nonmissing
>  = .),gen(educ) ;
(395984 differences between educyear and educ)

.         label var educ "Education recoded";

.         #d cr
delimiter now cr
.         
.         gen hsdrop = educ == 1 if educyear < . 

.         label var hsdrop "Less than HS"

.         gen somecol = educ == 3 if educyear < . 

.         label var somecol "Some college"

.         gen collgrad = educ == 4 if educyear < . 

.         label var collgrad "College grad"

.         
.         gen regnth = region53 == 1 if region53>0 & region53<.
(3,922 missing values generated)

.         label var regnth "Census region: Northeast"

.         
.         gen regmid = region53 == 2 if region53>0 & region53<. 
(3,922 missing values generated)

.         label var regmid "Census region: Midwest"

.         
.         gen regwst = region53 == 4 if region53>0 & region53<. 
(3,922 missing values generated)

.         label var regwst "Census region: West"

.         
.         gen widowed = inlist(marry53,2,8) if marry53>0&marry53<.&marry53!=6
(109,791 missing values generated)

.         label var widowed "Marital status:widowed"

.         
.         gen single = inlist(marry53,3,4,5,9,10) if marry53>0&marry53<.&marry5
> 3!=6
(109,791 missing values generated)

.         label var single "Marital status: single"

.         
.         ************
.         * Recode smoking and obesity 
.         ************
. 
.         
.         gen bmi = bmindx53 if bmindx53>0&bmindx53<50
(203,907 missing values generated)

.         label var bmi "BMI if 0-50"

.         *** obesity
.         gen obese = 0*bmi
(203,907 missing values generated)

.         replace obese = 1 if bmi >=30 & bmi < .
(54,681 real changes made)

.         label var obese "whether obese (bmi>=30)"

.         
.         *** overweight
.         gen overwt = 0*bmi
(203,907 missing values generated)

.         replace overwt = 1 if bmi >= 25 & bmi < 30
(70,977 real changes made)

.         label var overwt "whether over weight (25<=bmi<30)"

.         
.         *** normal weight
.         gen normalwt = 0*bmi
(203,907 missing values generated)

.         replace normalwt = 1 if bmi >= 18.5 & bmi < 25
(70,903 real changes made)

.         label var normalwt "whether normal weight (20<=bmi<25)"

.         
.         *** underweight
.         generate underwt = 0*bmi
(203,907 missing values generated)

.         replace underwt = 1 if bmi < 18.5 & bmi > 0
(3,945 real changes made)

.         label var underwt "whether under-weight (bmi< 20)"

.         
.         *** exclusive weight status
.         gen wtstate = 0*bmi
(203,907 missing values generated)

.         replace wtstate = 1 if underwt  == 1
(3,945 real changes made)

.         replace wtstate = 2 if normalwt == 1
(70,903 real changes made)

.         replace wtstate = 3 if overwt == 1
(70,977 real changes made)

.         replace wtstate = 4 if obese == 1
(54,681 real changes made)

.         label var wtstate "bmi status"

.         
.         *** panel id
.         gen panel = 1 if panel96==1|panel97==1
(360,944 missing values generated)

.         replace panel = 2 if panel97==2|panel98==2
(26,618 real changes made)

.         replace panel = 3 if panel98==3|panel99==3
(21,577 real changes made)

.         replace panel = 4 if panel99==4|panel00==4
(28,141 real changes made)

.         replace panel = 5 if panel00==5|panel01==5
(21,988 real changes made)

.         replace panel = 6 if panel01==6|panel02==6
(44,660 real changes made)

.         replace panel = 7 if panel02==7|panel03==7
(33,994 real changes made)

.         replace panel = 8 if panel03==8|panel04==8
(34,383 real changes made)

.         replace panel = 9 if panel04==9|panel05==9
(34,280 real changes made)

.         replace panel = 10 if panel05==10|panel06==10
(33,390 real changes made)

.         replace panel = 11 if panel06==11|panel07==11
(35,159 real changes made)

.         replace panel = 12 if panel07==12|panel08==12
(26,783 real changes made)

.         replace panel = 13 if panel08==13
(19,971 real changes made)

.         
.         ************
.         * Save the file 
.         ************    
.         
.         ************
.         * adjust all monetary amouts
.         ************
.         gen year = yr

.         recode totinc  (500000/max = .) (min/0 = 0)
(totinc: 503 changes made)

.         
.         gen cpi = 156.9 if year==1996
(381,812 missing values generated)

.         replace cpi = 160.5 if year==1997
(34,551 real changes made)

.         replace cpi = 163.0 if year==1998
(24,072 real changes made)

.         replace cpi = 163.0 if year==1998
(0 real changes made)

.         replace cpi = 166.6 if year==1999
(24,618 real changes made)

.         replace cpi = 172.2 if year==2000
(25,096 real changes made)

.         replace cpi = 177.1 if year==2001
(33,556 real changes made)

.         replace cpi = 179.9 if year==2002
(39,165 real changes made)

.         replace cpi = 184 if year==2003
(34,215 real changes made)

.         replace cpi = 188.9 if year==2004
(34,403 real changes made)

.         replace cpi = 195.3 if year==2005
(33,961 real changes made)

.         replace cpi = 201.6 if year==2006
(34,145 real changes made)

.         replace cpi = 207.3 if year==2007
(30,964 real changes made)

.         replace cpi = 215.3 if year==2008
(33,066 real changes made)

.         global cpi2005 = 195.3

. 
.         * NHE
.         gen nhe = 3399 if year==1996
(381,812 missing values generated)

.         replace nhe = 3556 if year==1997
(34,551 real changes made)

.         replace nhe = 3717 if year==1998
(24,072 real changes made)

.         replace nhe = 3897 if year==1999
(24,618 real changes made)

.         replace nhe = 4129 if year==2000
(25,096 real changes made)

.         replace nhe = 4400 if year==2001
(33,556 real changes made)

.         replace nhe = 4768 if year==2002
(39,165 real changes made)

.         replace nhe = 5108 if year==2003
(34,215 real changes made)

.         replace nhe = 5438 if year==2004
(34,403 real changes made)

.         replace nhe = 5757 if year==2005
(33,961 real changes made)

.         replace nhe = 6065 if year==2006
(34,145 real changes made)

.         replace nhe = 6380 if year==2007
(30,964 real changes made)

.         replace nhe = 6638 if year==2008
(33,066 real changes made)

.         
.         * correct NHE to exclude NH spending, 6.3% share from NHE, adjust to 
> 2005 dollars
.         gen nhe_real = nhe * ($cpi2005/cpi) / (1.063)

.         * adjust other amounts to 2005 prices
.         gen mepsexp_real = mepsexp * $cpi2005/cpi

.         gen totinc_real = totinc * $cpi2005/cpi
(3 missing values generated)

.         foreach x in slf mcr mcd prv va ofd wcp opr opu osr {
  2.                 gen meps`x'_real = meps`x' * $cpi2005/cpi
  3.         }

. 
.         gen mepsexp_nhe = .
(404,413 missing values generated)

.         forvalues j = 1996/2008 {
  2.                 sum mepsexp_real [aw=perwt] if year==`j'
  3.                 global totmeps = r(mean)
  4.                 sum nhe_real [aw=perwt] if year==`j'
  5.                 global totnhe = r(mean)
  6.                 replace mepsexp_real = mepsexp_real * ($totnhe/$totmeps) i
> f year==`j'
  7.                 replace mepsslf_real = mepsslf_real * ($totnhe/$totmeps) i
> f year==`j'
  8.         }       

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
mepsexp_real |  21,571   268905490    2536.856   10355.99          0   531611.9

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
    nhe_real |  21,571   268905490     3980.13          0    3980.13    3980.13
(18,562 real changes made)
(16,749 real changes made)

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
mepsexp_real |  32,636   271278585    2481.567   9026.399          0   427294.5

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
    nhe_real |  32,636   271278585    4070.574   9.10e-13   4070.574   4070.574
(27,731 real changes made)
(24,631 real changes made)

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
mepsexp_real |  22,953   273533690     2455.58   8141.579          0   453608.8

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
    nhe_real |  22,953   273533690    4189.613          0   4189.613   4189.613
(19,354 real changes made)
(17,379 real changes made)

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
mepsexp_real |  23,565   276410767    2527.961   7996.522          0   242332.6

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
    nhe_real |  23,565   276410767    4297.584   9.10e-13   4297.584   4297.584
(19,935 real changes made)
(18,172 real changes made)

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
mepsexp_real |  23,839   278405516    2557.877   8163.544          0   312718.2

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
    nhe_real |  23,839   278405516    4405.353          0   4405.353   4405.353
(20,137 real changes made)
(18,354 real changes made)

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
mepsexp_real |  32,122   284247327    2817.966   8270.471          0   245312.7

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
    nhe_real |  32,122   284247327    4564.604   9.10e-13   4564.604   4564.604
(27,460 real changes made)
(24,988 real changes made)

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
mepsexp_real |  37,418   288181763    3054.062   8925.565          0   442383.3

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
    nhe_real |  37,418   288181763    4869.385          0   4869.385   4869.385
(31,834 real changes made)
(28,458 real changes made)

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
mepsexp_real |  32,681   290604436    3270.852   13414.76          0    1025948

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
    nhe_real |  32,681   290604436    5100.374   9.10e-13   5100.374   5100.374
(27,599 real changes made)
(24,428 real changes made)

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
mepsexp_real |  32,737   293527003     3395.05   10722.47          0   667866.1

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
    nhe_real |  32,737   293527003    5289.033          0   5289.033   5289.033
(27,493 real changes made)
(23,811 real changes made)

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
mepsexp_real |  32,320   296185002      3456.5   10690.58          0     403440

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
    nhe_real |  32,320   296185002    5415.804   9.10e-13   5415.804   5415.804
(27,086 real changes made)
(23,422 real changes made)

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
mepsexp_real |  32,577   299267035    3344.082   9556.343          0   504921.2

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
    nhe_real |  32,577   299267035    5527.252          0   5527.252   5527.252
(27,332 real changes made)
(23,788 real changes made)

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
mepsexp_real |  29,370   301309149    3520.875   10992.11          0   480847.8

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
    nhe_real |  29,370   301309149     5654.45          0    5654.45    5654.45
(24,964 real changes made)
(21,501 real changes made)

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
mepsexp_real |  31,262   304375942    3422.364   9276.396          0     502077

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
    nhe_real |  31,262   304375942    5664.508          0   5664.508   5664.508
(26,205 real changes made)
(22,216 real changes made)

.         
.         drop mepsexp mepsslf

.         rename mepsexp_real mepsexp

.         label var mepsexp "MEPS total spending corrected to match NHE, $2005"

.         rename mepsslf_real mepsslf

.         label var mepsslf "MEPS oop spending corrected to match NHE, $2005"

.         
.         * insurance coverage
.         gen inscov = .
(404,413 missing values generated)

.         replace inscov = inscov96 if year==1996
(22,601 real changes made)

.         replace inscov = inscov97 if year==1997
(34,551 real changes made)

.         replace inscov = inscov98 if year==1998
(24,072 real changes made)

.         replace inscov = inscov99 if year==1999
(24,618 real changes made)

.         replace inscov = inscov00 if year==2000
(25,096 real changes made)

.         replace inscov = inscov01 if year==2001
(33,556 real changes made)

.         replace inscov = inscov02 if year==2002
(39,165 real changes made)

.         replace inscov = inscov03 if year==2003
(34,215 real changes made)

.         replace inscov = inscov04 if year==2004
(34,403 real changes made)

.         replace inscov = inscov05 if year==2005
(33,961 real changes made)

.         replace inscov = inscov06 if year==2006
(34,145 real changes made)

.         replace inscov = inscov07 if year==2007
(30,964 real changes made)

.         replace inscov = inscov08 if year==2008
(33,066 real changes made)

. 
.         * keep males
.         keep if male==1
(211,506 observations deleted)

.         * age range
.         keep if age>=25&age<=84
(83,277 observations deleted)

.         * adjust total mepsexp for outliers     
.         recode mepsexp (100000/max=.)
(mepsexp: 523 changes made)

.         recode mepsslf (100000/max=.)
(mepsslf: 2 changes made)

.         
.         * recode health 
.         * 1 = dead, 2 = poor-fair, 3 = good, 4 = vgood-excellent
.         recode rthlth53 (1/2=4) (3=3) (4/5=2) (else=.), gen(hlth)
(78060 differences between rthlth53 and hlth)

. 
.         label data "MEPS1996-2008" 

.         saveold "$mepsout/MEPS9608", replace 
(saving in Stata 13 format)
(FYI, saveold has options version(12) and version(11) that write files in
      older Stata formats)
file ~/cedia/Projets/rise-data/data/outdata/MEPS/MEPS9608.dta saved

.         erase "$mepsout/csd.dta"

.                 
. 
.         
.         
.         
. 
end of do-file

. do do/getsmokenhis-32.do

. 
. 
. * getting smoking histories 1997 to 2008
. 
. forvalues j = 1997/2008 {
  2.         use $src/raw/nhis/samadult-`j'.dta, clear
  3.         gen nhis_yr = `j'
  4.         capture gen fpx = px
  5.         capture drop publicid
  6.         di "`j'"
  7.         tab fmx
  8.         tab fpx
  9.         egen publicid = concat(nhis_yr hhx fmx fpx)
 10.         keep publicid smkstat2 nhis_yr hhx fmx fpx
 11.         save $src/temp/nhis-smoke-`j'.dta, replace
 12. }
1997

     Family |
     Serial |
     Number |      Freq.     Percent        Cum.
------------+-----------------------------------
         01 |     35,346       97.87       97.87
         02 |        681        1.89       99.75
         03 |         65        0.18       99.93
         04 |         17        0.05       99.98
         05 |          5        0.01       99.99
         06 |          2        0.01      100.00
------------+-----------------------------------
      Total |     36,116      100.00

        fpx |      Freq.     Percent        Cum.
------------+-----------------------------------
         01 |     23,767       65.81       65.81
         02 |     10,484       29.03       94.84
         03 |      1,330        3.68       98.52
         04 |        343        0.95       99.47
         05 |        118        0.33       99.80
         06 |         45        0.12       99.92
         07 |         13        0.04       99.96
         08 |         10        0.03       99.98
         09 |          3        0.01       99.99
         11 |          1        0.00       99.99
         13 |          1        0.00      100.00
         15 |          1        0.00      100.00
------------+-----------------------------------
      Total |     36,116      100.00
file ~/cedia/Projets/rise-data/temp/nhis-smoke-1997.dta saved
1998

     Family |
     Serial |
     Number |      Freq.     Percent        Cum.
------------+-----------------------------------
         01 |     31,840       98.15       98.15
         02 |        518        1.60       99.75
         03 |         59        0.18       99.93
         04 |         17        0.05       99.98
         05 |          4        0.01       99.99
         06 |          2        0.01      100.00
------------+-----------------------------------
      Total |     32,440      100.00

        fpx |      Freq.     Percent        Cum.
------------+-----------------------------------
         01 |     21,397       65.96       65.96
         02 |      9,407       29.00       94.96
         03 |      1,137        3.50       98.46
         04 |        323        1.00       99.46
         05 |        107        0.33       99.79
         06 |         36        0.11       99.90
         07 |         20        0.06       99.96
         08 |          9        0.03       99.99
         09 |          2        0.01       99.99
         10 |          1        0.00      100.00
         13 |          1        0.00      100.00
------------+-----------------------------------
      Total |     32,440      100.00
file ~/cedia/Projets/rise-data/temp/nhis-smoke-1998.dta saved
1999

     Family |
     Serial |
     Number |      Freq.     Percent        Cum.
------------+-----------------------------------
         01 |     30,230       98.15       98.15
         02 |        502        1.63       99.78
         03 |         52        0.17       99.94
         04 |         13        0.04       99.99
         05 |          4        0.01      100.00
------------+-----------------------------------
      Total |     30,801      100.00

        fpx |      Freq.     Percent        Cum.
------------+-----------------------------------
         01 |     20,373       66.14       66.14
         02 |      8,895       28.88       95.02
         03 |      1,078        3.50       98.52
         04 |        284        0.92       99.44
         05 |         91        0.30       99.74
         06 |         45        0.15       99.89
         07 |         26        0.08       99.97
         08 |          4        0.01       99.98
         10 |          3        0.01       99.99
         11 |          2        0.01      100.00
------------+-----------------------------------
      Total |     30,801      100.00
file ~/cedia/Projets/rise-data/temp/nhis-smoke-1999.dta saved
2000

     Family |
     Serial |
     Number |      Freq.     Percent        Cum.
------------+-----------------------------------
         01 |     31,743       98.05       98.05
         02 |        546        1.69       99.74
         03 |         59        0.18       99.92
         04 |         18        0.06       99.98
         05 |          5        0.02       99.99
         06 |          3        0.01      100.00
------------+-----------------------------------
      Total |     32,374      100.00

        fpx |      Freq.     Percent        Cum.
------------+-----------------------------------
         01 |     21,435       66.21       66.21
         02 |      9,117       28.16       94.37
         03 |      1,191        3.68       98.05
         04 |        380        1.17       99.22
         05 |        132        0.41       99.63
         06 |         72        0.22       99.85
         07 |         24        0.07       99.93
         08 |         15        0.05       99.98
         09 |          2        0.01       99.98
         10 |          2        0.01       99.99
         11 |          1        0.00       99.99
         13 |          1        0.00       99.99
         15 |          1        0.00      100.00
         18 |          1        0.00      100.00
------------+-----------------------------------
      Total |     32,374      100.00
file ~/cedia/Projets/rise-data/temp/nhis-smoke-2000.dta saved
2001

     Family |
     Serial |
     Number |      Freq.     Percent        Cum.
------------+-----------------------------------
         01 |     32,608       97.85       97.85
         02 |        618        1.85       99.70
         03 |         73        0.22       99.92
         04 |         20        0.06       99.98
         05 |          3        0.01       99.99
         06 |          1        0.00       99.99
         07 |          2        0.01      100.00
         08 |          1        0.00      100.00
------------+-----------------------------------
      Total |     33,326      100.00

        fpx |      Freq.     Percent        Cum.
------------+-----------------------------------
         01 |     21,937       65.83       65.83
         02 |      9,563       28.70       94.52
         03 |      1,235        3.71       98.23
         04 |        342        1.03       99.25
         05 |        140        0.42       99.67
         06 |         67        0.20       99.87
         07 |         22        0.07       99.94
         08 |         13        0.04       99.98
         09 |          4        0.01       99.99
         12 |          1        0.00       99.99
         15 |          1        0.00      100.00
         17 |          1        0.00      100.00
------------+-----------------------------------
      Total |     33,326      100.00
file ~/cedia/Projets/rise-data/temp/nhis-smoke-2001.dta saved
2002

     Family |
     Serial |
     Number |      Freq.     Percent        Cum.
------------+-----------------------------------
         01 |     30,382       97.87       97.87
         02 |        560        1.80       99.67
         03 |         70        0.23       99.90
         04 |         25        0.08       99.98
         05 |          6        0.02      100.00
         06 |          1        0.00      100.00
------------+-----------------------------------
      Total |     31,044      100.00

        fpx |      Freq.     Percent        Cum.
------------+-----------------------------------
         01 |     20,699       66.68       66.68
         02 |      8,616       27.75       94.43
         03 |      1,143        3.68       98.11
         04 |        354        1.14       99.25
         05 |        134        0.43       99.68
         06 |         58        0.19       99.87
         07 |         18        0.06       99.93
         08 |         12        0.04       99.97
         09 |          6        0.02       99.99
         10 |          4        0.01      100.00
------------+-----------------------------------
      Total |     31,044      100.00
file ~/cedia/Projets/rise-data/temp/nhis-smoke-2002.dta saved
2003

     Family |
     Serial |
     Number |      Freq.     Percent        Cum.
------------+-----------------------------------
         01 |     30,197       97.88       97.88
         02 |        559        1.81       99.69
         03 |         64        0.21       99.90
         04 |         26        0.08       99.98
         05 |          5        0.02      100.00
         06 |          1        0.00      100.00
------------+-----------------------------------
      Total |     30,852      100.00

        fpx |      Freq.     Percent        Cum.
------------+-----------------------------------
         01 |     20,369       66.02       66.02
         02 |      8,721       28.27       94.29
         03 |      1,175        3.81       98.10
         04 |        364        1.18       99.28
         05 |        135        0.44       99.71
         06 |         49        0.16       99.87
         07 |         22        0.07       99.94
         08 |         11        0.04       99.98
         09 |          2        0.01       99.99
         10 |          1        0.00       99.99
         11 |          3        0.01      100.00
------------+-----------------------------------
      Total |     30,852      100.00
file ~/cedia/Projets/rise-data/temp/nhis-smoke-2003.dta saved
2004

IDN.000_35. |
000: Family |
     Serial |
     Number |      Freq.     Percent        Cum.
------------+-----------------------------------
         01 |     30,567       97.58       97.58
         02 |        584        1.86       99.44
         03 |        111        0.35       99.80
         04 |         37        0.12       99.91
         05 |         15        0.05       99.96
         06 |          8        0.03       99.99
         07 |          3        0.01      100.00
         09 |          1        0.00      100.00
------------+-----------------------------------
      Total |     31,326      100.00

IDN.000_40. |
000: Person |
 Number (in |
    family) |      Freq.     Percent        Cum.
------------+-----------------------------------
         01 |     21,514       68.68       68.68
         02 |      8,282       26.44       95.12
         03 |      1,044        3.33       98.45
         04 |        293        0.94       99.38
         05 |        118        0.38       99.76
         06 |         49        0.16       99.92
         07 |         16        0.05       99.97
         08 |          7        0.02       99.99
         10 |          2        0.01      100.00
         11 |          1        0.00      100.00
------------+-----------------------------------
      Total |     31,326      100.00
file ~/cedia/Projets/rise-data/temp/nhis-smoke-2004.dta saved
2005

IDN.000_35. |
000: Family |
     Serial |
     Number |      Freq.     Percent        Cum.
------------+-----------------------------------
         01 |     30,793       97.98       97.98
         02 |        480        1.53       99.51
         03 |         95        0.30       99.81
         04 |         37        0.12       99.93
         05 |         14        0.04       99.97
         06 |          7        0.02       99.99
         07 |          2        0.01      100.00
------------+-----------------------------------
      Total |     31,428      100.00

IDN.000_40. |
000: Person |
 Number (in |
    family) |      Freq.     Percent        Cum.
------------+-----------------------------------
         01 |     21,899       69.68       69.68
         02 |      8,078       25.70       95.38
         03 |      1,004        3.19       98.58
         04 |        267        0.85       99.43
         05 |        102        0.32       99.75
         06 |         47        0.15       99.90
         07 |         18        0.06       99.96
         08 |          8        0.03       99.98
         09 |          3        0.01       99.99
         10 |          1        0.00      100.00
         11 |          1        0.00      100.00
------------+-----------------------------------
      Total |     31,428      100.00
file ~/cedia/Projets/rise-data/temp/nhis-smoke-2005.dta saved
2006

IDN.000_35. |
000: Family |
     Serial |
     Number |      Freq.     Percent        Cum.
------------+-----------------------------------
         01 |     23,718       97.71       97.71
         02 |        447        1.84       99.55
         03 |         81        0.33       99.88
         04 |         23        0.09       99.98
         05 |          4        0.02       99.99
         06 |          1        0.00      100.00
         08 |          1        0.00      100.00
------------+-----------------------------------
      Total |     24,275      100.00

IDN.000_40. |
000: Person |
 Number (in |
    family) |      Freq.     Percent        Cum.
------------+-----------------------------------
         01 |     16,754       69.02       69.02
         02 |      6,314       26.01       95.03
         03 |        807        3.32       98.35
         04 |        245        1.01       99.36
         05 |         83        0.34       99.70
         06 |         44        0.18       99.88
         07 |         19        0.08       99.96
         08 |          6        0.02       99.99
         09 |          2        0.01      100.00
         16 |          1        0.00      100.00
------------+-----------------------------------
      Total |     24,275      100.00
file ~/cedia/Projets/rise-data/temp/nhis-smoke-2006.dta saved
2007

IDN.000_35. |
000: Family |
     Serial |
     Number |      Freq.     Percent        Cum.
------------+-----------------------------------
         01 |     22,851       97.68       97.68
         02 |        391        1.67       99.35
         03 |        103        0.44       99.79
         04 |         34        0.15       99.94
         05 |          9        0.04       99.98
         06 |          4        0.02      100.00
         07 |          1        0.00      100.00
------------+-----------------------------------
      Total |     23,393      100.00

IDN.000_40. |
000: Person |
 Number (in |
    family) |      Freq.     Percent        Cum.
------------+-----------------------------------
         01 |     16,329       69.80       69.80
         02 |      5,945       25.41       95.22
         03 |        753        3.22       98.44
         04 |        231        0.99       99.42
         05 |         96        0.41       99.83
         06 |         17        0.07       99.91
         07 |         10        0.04       99.95
         08 |          9        0.04       99.99
         09 |          2        0.01      100.00
         10 |          1        0.00      100.00
------------+-----------------------------------
      Total |     23,393      100.00
file ~/cedia/Projets/rise-data/temp/nhis-smoke-2007.dta saved
2008

IDN.000_35. |
000: Family |
     Serial |
     Number |      Freq.     Percent        Cum.
------------+-----------------------------------
         01 |     21,350       98.02       98.02
         02 |        328        1.51       99.53
         03 |         77        0.35       99.88
         04 |         17        0.08       99.96
         05 |          3        0.01       99.97
         06 |          5        0.02      100.00
         07 |          1        0.00      100.00
------------+-----------------------------------
      Total |     21,781      100.00

IDN.000_40. |
000: Person |
 Number (in |
    family) |      Freq.     Percent        Cum.
------------+-----------------------------------
         01 |     15,138       69.50       69.50
         02 |      5,592       25.67       95.17
         03 |        726        3.33       98.51
         04 |        214        0.98       99.49
         05 |         66        0.30       99.79
         06 |         27        0.12       99.92
         07 |         11        0.05       99.97
         08 |          3        0.01       99.98
         09 |          2        0.01       99.99
         11 |          2        0.01      100.00
------------+-----------------------------------
      Total |     21,781      100.00
file ~/cedia/Projets/rise-data/temp/nhis-smoke-2008.dta saved

. use $src/temp/nhis-smoke-1997.dta, clear

. forvalues j = 1998/2008 {
  2.         append using $src/temp/nhis-smoke-`j'.dta
  3. }

. recode smkstat2 (1/2 5 = 1) (3=2) (4=3) (else=.), gen(smoke3)
(295871 differences between smkstat2 and smoke3)

. recode smoke3 (1/2 = 1) (3=0) (else=.), gen(smokev)
(276256 differences between smoke3 and smokev)

. recode smoke3 (1 = 1) (2 3=0) (else=.), gen(smoken)
(276256 differences between smoke3 and smoken)

. tab nhis_yr smokev, row nofreq

           |   RECODE of smoke3
           |  (RECODE of smkstat2
           |   (Smoking Status:
           |      Recode 2))
   nhis_yr |         0          1 |     Total
-----------+----------------------+----------
      1997 |     53.02      46.98 |    100.00 
      1998 |     53.08      46.92 |    100.00 
      1999 |     53.72      46.28 |    100.00 
      2000 |     55.01      44.99 |    100.00 
      2001 |     55.32      44.68 |    100.00 
      2002 |     55.34      44.66 |    100.00 
      2003 |     56.64      43.36 |    100.00 
      2004 |     57.86      42.14 |    100.00 
      2005 |     57.29      42.71 |    100.00 
      2006 |     59.47      40.53 |    100.00 
      2007 |     59.52      40.48 |    100.00 
      2008 |     57.74      42.26 |    100.00 
-----------+----------------------+----------
     Total |     55.93      44.07 |    100.00 


. 
. keep publicid nhis_yr smoke3 smokev smoken hhx fmx fpx

. 
. save $src/temp/nhis-smoke.dta, replace
file ~/cedia/Projets/rise-data/temp/nhis-smoke.dta saved

. forvalues j = 1997/2008 {
  2.         *erase temp/nhis-smoke-`j'.dta
. }

. 
end of do-file

. do do/transfermepsnhis32.do

. * file to transfer to Stata all MEPS-NHIS link files
. 
. *global mepsdir "/Users/uqam/Documents/data/MEPS/" 
. 
. global mepsdir  "$src/raw/MEPS_NHIS"

. global mepsout "$src/data/outdata/MEPS"

. 
. * 1996 (panel 1)
. infix str dupersid 1-8 str his_id 9-20 using "$mepsdir/MEPS_1996/his_mepx.dat
> ", clear
(22,837 observations read)

. gen year = 1996

. gen nhis_yr = 1995

. gen nhyr = 95

. gen hhx = his_id

. gen str2 fmx = "01"

. gen str2 px = "01"

. egen publicid = concat(nhyr his_id)

. drop nhyr

. gen panel = 1

. save "$mepsout/his_meps_1996.dta", replace
file ~/cedia/Projets/rise-data/data/outdata/MEPS/his_meps_1996.dta saved

. 
. * 1997 (panel 2)
. infix str dupersid 1-8 str hhx 9-18 str px 19-20 linkflag 21-21 panel97 22-22
>  using "$mepsdir/MEPS_1997/nhmep97x.dat", clear
(34,551 observations read)

. gen year = 1997

. keep if panel97==2
(20,868 observations deleted)

. keep if linkflag==1
(1,368 observations deleted)

. gen nhis_yr = 1996

. gen nhyr = 96 if nhis_yr==1996

. gen str2 fmx = "01"

. egen publicid = concat(nhyr hhx px)

. gen panel = 2

. save "$mepsout/his_meps_1997.dta", replace
file ~/cedia/Projets/rise-data/data/outdata/MEPS/his_meps_1997.dta saved

. 
. * 1998 (panel 3)
. infix str dupersid 1-8 str hhx 9-18 str px 19-20 linkflag 21-21 panel98 22-22
>  using "$mepsdir/MEPS_1998/NHMEP98X.DAT", clear
(24,072 observations read)

. gen year = 1998

. keep if linkflag==1
(2,591 observations deleted)

. keep if panel98==3
(11,409 observations deleted)

. gen nhis_yr = 1997

. gen str2 fmx = "01"

. egen publicid = concat(nhis_yr hhx fmx px)

. gen panel = 3

. save "$mepsout/his_meps_1998.dta", replace
file ~/cedia/Projets/rise-data/data/outdata/MEPS/his_meps_1998.dta saved

. 
. * 1999 (panel 4)
. infix str dupersid 1-8 str hhx 9-14 str px 15-16 linkflag 17-17 panel99 18-18
>  using "$mepsdir/MEPS_1999/NHMEP99X.DAT", clear
(24,618 observations read)

. gen year = 1999

. keep if linkflag==1
(2,656 observations deleted)

. keep if panel99==4
(9,257 observations deleted)

. gen nhis_yr = 1998

. gen str2 fmx = "01"

. egen publicid = concat(nhis_yr hhx fmx px)

. gen panel = 4

. save "$mepsout/his_meps_1999.dta", replace
file ~/cedia/Projets/rise-data/data/outdata/MEPS/his_meps_1999.dta saved

. 
. * 2000 (panel 5)
. infix str dupersid 1-8 str hhx 9-14 str px 15-16 linkflag 17-17 panel00 18-18
>  using "$mepsdir/MEPS_2000/NHMEP00X.DAT", clear
(25,096 observations read)

. gen year = 2000

. keep if linkflag==1
(3,185 observations deleted)

. keep if panel00==5
(12,135 observations deleted)

. gen nhis_yr = 1999

. gen str2 fmx = "01"

. egen publicid = concat(nhis_yr hhx fmx px)

. gen panel = 5

. save "$mepsout/his_meps_2000.dta", replace
file ~/cedia/Projets/rise-data/data/outdata/MEPS/his_meps_2000.dta saved

. 
. * 2001 (panel 6)
. infix str dupersid 1-8 str hhx 9-14 str px 15-16 linkflag 17-17 panel01 18-18
>  srvy_yr 19-22 using "$mepsdir/MEPS_2001/NHMEP01X.DAT", clear
(33,556 observations read)

. gen year = 2001

. tab linkflag

   linkflag |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      3,761       11.21       11.21
          1 |     29,795       88.79      100.00
------------+-----------------------------------
      Total |     33,556      100.00

. keep if linkflag==1
(3,761 observations deleted)

. keep if panel01==6
(9,307 observations deleted)

. gen nhis_yr = srvy_yr

. gen str2 fmx = "01"

. egen publicid = concat(nhis_yr hhx fmx px)

. gen panel = 6

. save "$mepsout/his_meps_2001.dta", replace
file ~/cedia/Projets/rise-data/data/outdata/MEPS/his_meps_2001.dta saved

. 
. * 2002 (panel 7)
. infix str dupersid 1-8 str hhx 9-14 str px 15-16 linkflag 17-17 panel02 18-18
>  srvy_yr 19-22 using "$mepsdir/MEPS_2002/NHMEP02X.DAT", clear
(39,165 observations read)

. gen year = 2002

. keep if linkflag==1
(4,237 observations deleted)

. keep if panel02==7
(19,351 observations deleted)

. gen nhis_yr = srvy_yr

. gen str2 fmx = "01"

. egen publicid = concat(nhis_yr hhx fmx px)

. gen panel = 7

. save "$mepsout/his_meps_2002.dta", replace
file ~/cedia/Projets/rise-data/data/outdata/MEPS/his_meps_2002.dta saved

. 
. * 2003 (panel 8)
. infix str dupersid 1-8 str hhx 9-14 str px 15-16 linkflag 17-17 panel03 18-18
>  srvy_yr 19-22 using "$mepsdir/MEPS_2003/NHMEP03X.DAT", clear
(34,215 observations read)

. gen year = 2003

. keep if linkflag==1
(3,654 observations deleted)

. keep if panel03==8
(14,834 observations deleted)

. gen nhis_yr = srvy_yr

. gen str2 fmx = "01"

. egen publicid = concat(nhis_yr hhx fmx px)

. gen panel = 8

. save "$mepsout/his_meps_2003.dta", replace
file ~/cedia/Projets/rise-data/data/outdata/MEPS/his_meps_2003.dta saved

. 
. * 2004 (panel 9)
. infix str dupersid 1-8 str hhx 9-14 str px 15-16 linkflag 17-17 panel04 18-18
>  srvy_yr 19-22 using "$mepsdir/MEPS_2004/NHMEP04X.DAT", clear
(34,403 observations read)

. gen year = 2004

. keep if linkflag==1
(3,844 observations deleted)

. keep if panel04==9
(14,893 observations deleted)

. gen nhis_yr = srvy_yr

. gen str2 fmx = "01"

. egen publicid = concat(nhis_yr hhx fmx px)

. gen panel = 9

. save "$mepsout/his_meps_2004.dta", replace
file ~/cedia/Projets/rise-data/data/outdata/MEPS/his_meps_2004.dta saved

. 
. * 2005 (panel 10)
. infix str dupersid 1-8 str hhx 9-14 str px 15-16 linkflag 17-17 panel05 18-19
>  srvy_yr 20-23 str fmx 24-25 str fpx 26-27 using "$mepsdir/MEPS_2005/NHMEP05X
> .DAT", clear
(33,961 observations read)

. gen year = 2005

. keep if linkflag==1
(3,785 observations deleted)

. keep if panel05==10
(14,717 observations deleted)

. gen nhis_yr = srvy_yr

. egen publicid = concat(nhis_yr hhx fmx fpx)

. gen panel = 10

. save "$mepsout/his_meps_2005.dta", replace
file ~/cedia/Projets/rise-data/data/outdata/MEPS/his_meps_2005.dta saved

. 
. * 2006 (panel 11)
. infix str dupersid 1-8 str hhx 9-14 str fmx 15-16 str fpx 17-18 linkflag 19-1
> 9 panel06 20-21 srvy_yr 22-25 using "$mepsdir/MEPS_2006/NHMEP06X.DAT", clear
(34,145 observations read)

. gen year = 2006

. tab linkflag

   linkflag |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      3,753       10.99       10.99
          1 |     30,392       89.01      100.00
------------+-----------------------------------
      Total |     34,145      100.00

. tab srvy_yr

    srvy_yr |      Freq.     Percent        Cum.
------------+-----------------------------------
       2004 |     14,284       41.83       41.83
       2005 |     16,108       47.18       89.01
       9999 |      3,753       10.99      100.00
------------+-----------------------------------
      Total |     34,145      100.00

. keep if linkflag==1
(3,753 observations deleted)

. keep if panel06==11
(14,284 observations deleted)

. gen nhis_yr = srvy_yr

. egen publicid = concat(nhis_yr hhx fmx fpx)

. gen panel = 11

. save "$mepsout/his_meps_2006.dta", replace
file ~/cedia/Projets/rise-data/data/outdata/MEPS/his_meps_2006.dta saved

. 
. * 2007 (panel 12)
. infix str dupersid 1-8 str hhx 9-14 str fmx 15-16 str fpx 17-18 linkflag 19-1
> 9 panel07 20-21 srvy_yr 22-25 using "$mepsdir/MEPS_2007/NHMEP07X.DAT", clear
(30,964 observations read)

. gen year = 2007

. keep if linkflag==1
(3,539 observations deleted)

. keep if panel07==12
(15,165 observations deleted)

. gen nhis_yr = srvy_yr

. egen publicid = concat(nhis_yr hhx fmx fpx)

. gen panel = 12

. save "$mepsout/his_meps_2007.dta", replace
file ~/cedia/Projets/rise-data/data/outdata/MEPS/his_meps_2007.dta saved

. 
. * 2008 (panel 13)
. infix str dupersid 1-8 str hhx 9-14 str fmx 15-16 str fpx 17-18 linkflag 19-1
> 9 panel08 20-21 srvy_yr 22-25 using "$mepsdir/MEPS_2008/NHMEP08X.DAT", clear 
(33,066 observations read)

. gen year = 2008

. keep if linkflag==1
(3,873 observations deleted)

. keep if panel08==13
(11,429 observations deleted)

. gen nhis_yr = srvy_yr

. egen publicid = concat(nhis_yr hhx fmx fpx)

. gen panel =13

. save "$mepsout/his_meps_2008.dta", replace
file ~/cedia/Projets/rise-data/data/outdata/MEPS/his_meps_2008.dta saved

. 
. 
. append using "$mepsout/his_meps_2007.dta"

. append using "$mepsout/his_meps_2006.dta"

. append using "$mepsout/his_meps_2005.dta"

. append using "$mepsout/his_meps_2004.dta"

. append using "$mepsout/his_meps_2003.dta"

. append using "$mepsout/his_meps_2002.dta"

. append using "$mepsout/his_meps_2001.dta"

. append using "$mepsout/his_meps_2000.dta"

. append using "$mepsout/his_meps_1999.dta"

. append using "$mepsout/his_meps_1998.dta"
(note: variable hhx was str6, now str10 to accommodate using data's values)

. append using "$mepsout/his_meps_1997.dta"

. append using "$mepsout/his_meps_1996.dta"
(note: variable hhx was str10, now str12 to accommodate using data's values)

. 
. 
. sort dupersid year

. tab year

       year |      Freq.     Percent        Cum.
------------+-----------------------------------
       1996 |     22,837       11.61       11.61
       1997 |     12,315        6.26       17.87
       1998 |     10,072        5.12       22.99
       1999 |     12,705        6.46       29.44
       2000 |      9,776        4.97       34.41
       2001 |     20,488       10.41       44.82
       2002 |     15,577        7.92       52.74
       2003 |     15,727        7.99       60.73
       2004 |     15,666        7.96       68.70
       2005 |     15,459        7.86       76.55
       2006 |     16,108        8.19       84.74
       2007 |     12,260        6.23       90.97
       2008 |     17,764        9.03      100.00
------------+-----------------------------------
      Total |    196,754      100.00

. 
. * merge NHIS smoking data
. isid publicid

. 
. 
. 
. merge 1:1 publicid using $src/temp/nhis-smoke.dta

    Result                           # of obs.
    -----------------------------------------
    not matched                       449,472
        from master                   143,535  (_merge==1)
        from using                    305,937  (_merge==2)

    matched                            53,219  (_merge==3)
    -----------------------------------------

. drop if _merge ==2
(305,937 observations deleted)

. tab nhis_yr smokev

           |   RECODE of smoke3
           |  (RECODE of smkstat2
           |   (Smoking Status:
           |      Recode 2))
   nhis_yr |         0          1 |     Total
-----------+----------------------+----------
      1997 |     1,789      1,624 |     3,413 
      1998 |     2,204      1,947 |     4,151 
      1999 |     1,722      1,439 |     3,161 
      2000 |     3,587      2,999 |     6,586 
      2001 |     2,772      2,336 |     5,108 
      2002 |     2,840      2,334 |     5,174 
      2003 |     2,881      2,316 |     5,197 
      2004 |     2,969      2,214 |     5,183 
      2005 |     3,020      2,298 |     5,318 
      2006 |     2,360      1,701 |     4,061 
      2007 |     3,254      2,203 |     5,457 
-----------+----------------------+----------
     Total |    29,398     23,411 |    52,809 


. drop _merge

. save "$mepsout/his_meps_all.dta", replace
file ~/cedia/Projets/rise-data/data/outdata/MEPS/his_meps_all.dta saved

. 
. 
. 
end of do-file

. do do/extract-meps32.do

. *****************************************************
. * Estimation of production function using MEPS-NHIS *
. * Fonseca, Michaud, Kapteyn and Galama (2015)       *
. * version 32
. * Last version:June 2018
. *****************************************************
. 
. global mepsout "$src/data/outdata/MEPS"

. 
. **We merge MEPS and MEPS_NHIS
. **Using raw data - our construction of MEPS and MEPS_NHIS
. **do files to construct MEPS9608 are in mesps_selected9608.do
. **do files to construct MEPS_NHIS_all.dta are in transfermepshis.do
. 
. use "$mepsout/MEPS9608.dta", clear
(MEPS1996-2008)

. 
. * count number of interviews (drop if less than 2, balanced panel)
. bysort dupersid: gen count = _N

. keep if count<=2
(797 observations deleted)

. bysort dupersid: gen t = _n

. 
. * select variables and reshape wide
. #d ;
delimiter now ;
. keep dupersid year t count totinc hlth age obese educ male mepsexp mepsslf pe
> rwt inscov panel;

.  #d cr  
delimiter now cr
. 
. save $src/data/meps-nhis_long_extract.dta, replace
file ~/cedia/Projets/rise-data/data/meps-nhis_long_extract.dta saved

. 
. #d ;
delimiter now ;
. reshape wide year totinc hlth educ age obese male mepsexp mepsslf perwt panel
>  inscov, i(dupersid) j(t);
(note: j = 1 2)

Data                               long   ->   wide
-----------------------------------------------------------------------------
Number of obs.                   108833   ->   60174
Number of variables                  15   ->      26
j variable (2 values)                 t   ->   (dropped)
xij variables:
                                   year   ->   year1 year2
                                 totinc   ->   totinc1 totinc2
                                   hlth   ->   hlth1 hlth2
                                   educ   ->   educ1 educ2
                                    age   ->   age1 age2
                                  obese   ->   obese1 obese2
                                   male   ->   male1 male2
                                mepsexp   ->   mepsexp1 mepsexp2
                                mepsslf   ->   mepsslf1 mepsslf2
                                  perwt   ->   perwt1 perwt2
                                  panel   ->   panel1 panel2
                                 inscov   ->   inscov1 inscov2
-----------------------------------------------------------------------------

. #d cr
delimiter now cr
. 
. * keep only wave 1 characteristics 
. drop male2 obese2 educ2 age2 perwt2 inscov2

. rename male1 male

. rename age1 age

. rename obese1 obese

. rename totinc1 totinc

. rename educ1 educ

. rename year1 year

. rename panel1 panel

. rename perwt1 perwt

. rename hlth1 hlth

. rename hlth2 fhlth

. rename totinc2 ftotinc

. rename mepsexp2 fmepsexp

. rename mepsexp1 mepsexp

. rename mepsslf2 fmepsslf

. rename mepsslf1 mepsslf

. 
. rename inscov1 inscov

. 
. * procedure to obtain mortality and smoking data from NHIS
. sort dupersid year

. capture drop _merge

. di _N
60174

. des

Contains data
  obs:        60,174                          MEPS1996-2008
 vars:            20                          
 size:     6,739,488                          
-------------------------------------------------------------------------------
              storage   display    value
variable name   type    format     label      variable label
-------------------------------------------------------------------------------
dupersid        str8    %9s                   PERSON ID (DUID + PID)
age             double  %10.0g                1 age
totinc          double  %10.0g                1 totinc
perwt           double  %10.0g                1 perwt
male            float   %9.0g                 1 male
educ            double  %14.0g     educ       1 educ
obese           float   %9.0g                 1 obese
panel           float   %9.0g                 1 panel
year            float   %9.0g                 1 year
mepsexp         float   %9.0g                 1 mepsexp
mepsslf         float   %9.0g                 1 mepsslf
inscov          float   %9.0g                 1 inscov
hlth            double  %9.0g                 1 hlth
ftotinc         double  %10.0g                2 totinc
panel2          float   %9.0g                 2 panel
year2           float   %9.0g                 2 year
fmepsexp        float   %9.0g                 2 mepsexp
fmepsslf        float   %9.0g                 2 mepsslf
fhlth           double  %9.0g                 2 hlth
count           float   %9.0g                 
-------------------------------------------------------------------------------
Sorted by: dupersid  year
     Note: Dataset has changed since last saved.

. tab year

     1 year |      Freq.     Percent        Cum.
------------+-----------------------------------
       1996 |      3,514        5.84        5.84
       1997 |      4,809        7.99       13.83
       1998 |      3,257        5.41       19.24
       1999 |      3,508        5.83       25.07
       2000 |      3,783        6.29       31.36
       2001 |      4,940        8.21       39.57
       2002 |      5,409        8.99       48.56
       2003 |      4,943        8.21       56.77
       2004 |      4,863        8.08       64.86
       2005 |      4,669        7.76       72.61
       2006 |      4,860        8.08       80.69
       2007 |      4,507        7.49       88.18
       2008 |      7,112       11.82      100.00
------------+-----------------------------------
      Total |     60,174      100.00

. tab panel

    1 panel |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      6,522       10.84       10.84
          2 |      3,506        5.83       16.67
          3 |      3,084        5.13       21.79
          4 |      4,106        6.82       28.61
          5 |      3,216        5.34       33.96
          6 |      6,584       10.94       44.90
          7 |      4,700        7.81       52.71
          8 |      4,804        7.98       60.69
          9 |      4,829        8.03       68.72
         10 |      4,675        7.77       76.49
         11 |      4,910        8.16       84.65
         12 |      3,969        6.60       91.24
         13 |      5,269        8.76      100.00
------------+-----------------------------------
      Total |     60,174      100.00

. merge  1:1 dupersid panel  using "$mepsout/his_meps_all.dta"

    Result                           # of obs.
    -----------------------------------------
    not matched                       146,914
        from master                     5,167  (_merge==1)
        from using                    141,747  (_merge==2)

    matched                            55,007  (_merge==3)
    -----------------------------------------

. keep if _merge==3
(146,914 observations deleted)

. tab year smokev

           |   RECODE of smoke3
           |  (RECODE of smkstat2
           |   (Smoking Status:
           |      Recode 2))
    1 year |         0          1 |     Total
-----------+----------------------+----------
      1998 |       312        368 |       680 
      1999 |       604        845 |     1,449 
      2000 |       685        848 |     1,533 
      2001 |       807      1,064 |     1,871 
      2002 |       975      1,161 |     2,136 
      2003 |       907      1,057 |     1,964 
      2004 |       911      1,035 |     1,946 
      2005 |       863      1,000 |     1,863 
      2006 |       970      1,013 |     1,983 
      2007 |       887        976 |     1,863 
      2008 |     1,321      1,406 |     2,727 
-----------+----------------------+----------
     Total |     9,242     10,773 |    20,015 


. 
. forvalues t = 1995/2008 {
  2.         merge n:1 publicid using $src/raw/nhis/nhis_`t'_pmort.dta, update 
> gen(deathmatch`t')
  3.         tab year deathmatch`t'
  4.         drop if deathmatch`t'==2
  5.         drop deathmatch`t'
  6. }

    Result                           # of obs.
    -----------------------------------------
    not matched                       145,474
        from master                    49,007  (deathmatch1995==1)
        from using                     96,467  (deathmatch1995==2)

    matched                             6,000
        not updated                     6,000  (deathmatch1995==3)
        missing updated                     0  (deathmatch1995==4)
        nonmissing conflict                 0  (deathmatch1995==5)
    -----------------------------------------

           |    deathmatch1995
    1 year | master on  matched ( |     Total
-----------+----------------------+----------
      1996 |         0      3,283 |     3,283 
      1997 |     1,673      2,717 |     4,390 
      1998 |     2,985          0 |     2,985 
      1999 |     3,216          0 |     3,216 
      2000 |     3,439          0 |     3,439 
      2001 |     4,499          0 |     4,499 
      2002 |     4,916          0 |     4,916 
      2003 |     4,512          0 |     4,512 
      2004 |     4,418          0 |     4,418 
      2005 |     4,235          0 |     4,235 
      2006 |     4,465          0 |     4,465 
      2007 |     4,108          0 |     4,108 
      2008 |     6,541          0 |     6,541 
-----------+----------------------+----------
     Total |    49,007      6,000 |    55,007 

(96,467 observations deleted)
(label eligfmt already defined)
(label mortfmt already defined)
(label msrcendifmt already defined)
(label msrcessafmt already defined)
(label msrcecmsfmt already defined)
(label qtrfmt already defined)
(label causefmt already defined)
(label flagfmt already defined)

    Result                           # of obs.
    -----------------------------------------
    not matched                       111,961
        from master                    51,783  (deathmatch1996==1)
        from using                     60,178  (deathmatch1996==2)

    matched                             3,224
        not updated                         0  (deathmatch1996==3)
        missing updated                 3,224  (deathmatch1996==4)
        nonmissing conflict                 0  (deathmatch1996==5)
    -----------------------------------------

           |    deathmatch1996
    1 year | master on  missing u |     Total
-----------+----------------------+----------
      1996 |     3,283          0 |     3,283 
      1997 |     2,717      1,673 |     4,390 
      1998 |     1,434      1,551 |     2,985 
      1999 |     3,216          0 |     3,216 
      2000 |     3,439          0 |     3,439 
      2001 |     4,499          0 |     4,499 
      2002 |     4,916          0 |     4,916 
      2003 |     4,512          0 |     4,512 
      2004 |     4,418          0 |     4,418 
      2005 |     4,235          0 |     4,235 
      2006 |     4,465          0 |     4,465 
      2007 |     4,108          0 |     4,108 
      2008 |     6,541          0 |     6,541 
-----------+----------------------+----------
     Total |    51,783      3,224 |    55,007 

(60,178 observations deleted)
(label eligfmt already defined)
(label mortfmt already defined)
(label msrcendifmt already defined)
(label msrcessafmt already defined)
(label msrcecmsfmt already defined)
(label qtrfmt already defined)
(label causefmt already defined)
(label flagfmt already defined)

    Result                           # of obs.
    -----------------------------------------
    not matched                       152,900
        from master                    52,215  (deathmatch1997==1)
        from using                    100,685  (deathmatch1997==2)

    matched                             2,792
        not updated                         0  (deathmatch1997==3)
        missing updated                 2,792  (deathmatch1997==4)
        nonmissing conflict                 0  (deathmatch1997==5)
    -----------------------------------------

           |    deathmatch1997
    1 year | master on  missing u |     Total
-----------+----------------------+----------
      1996 |     3,283          0 |     3,283 
      1997 |     4,390          0 |     4,390 
      1998 |     1,564      1,421 |     2,985 
      1999 |     1,845      1,371 |     3,216 
      2000 |     3,439          0 |     3,439 
      2001 |     4,499          0 |     4,499 
      2002 |     4,916          0 |     4,916 
      2003 |     4,512          0 |     4,512 
      2004 |     4,418          0 |     4,418 
      2005 |     4,235          0 |     4,235 
      2006 |     4,465          0 |     4,465 
      2007 |     4,108          0 |     4,108 
      2008 |     6,541          0 |     6,541 
-----------+----------------------+----------
     Total |    52,215      2,792 |    55,007 

(100,685 observations deleted)
(label eligfmt already defined)
(label mortfmt already defined)
(label msrcendifmt already defined)
(label msrcessafmt already defined)
(label msrcecmsfmt already defined)
(label qtrfmt already defined)
(label causefmt already defined)
(label flagfmt already defined)

    Result                           # of obs.
    -----------------------------------------
    not matched                       146,334
        from master                    51,278  (deathmatch1998==1)
        from using                     95,056  (deathmatch1998==2)

    matched                             3,729
        not updated                         0  (deathmatch1998==3)
        missing updated                 3,729  (deathmatch1998==4)
        nonmissing conflict                 0  (deathmatch1998==5)
    -----------------------------------------

           |    deathmatch1998
    1 year | master on  missing u |     Total
-----------+----------------------+----------
      1996 |     3,283          0 |     3,283 
      1997 |     4,390          0 |     4,390 
      1998 |     2,985          0 |     2,985 
      1999 |     1,399      1,817 |     3,216 
      2000 |     1,527      1,912 |     3,439 
      2001 |     4,499          0 |     4,499 
      2002 |     4,916          0 |     4,916 
      2003 |     4,512          0 |     4,512 
      2004 |     4,418          0 |     4,418 
      2005 |     4,235          0 |     4,235 
      2006 |     4,465          0 |     4,465 
      2007 |     4,108          0 |     4,108 
      2008 |     6,541          0 |     6,541 
-----------+----------------------+----------
     Total |    51,278      3,729 |    55,007 

(95,056 observations deleted)
(label eligfmt already defined)
(label mortfmt already defined)
(label msrcendifmt already defined)
(label msrcessafmt already defined)
(label msrcecmsfmt already defined)
(label qtrfmt already defined)
(label causefmt already defined)
(label flagfmt already defined)

    Result                           # of obs.
    -----------------------------------------
    not matched                       146,350
        from master                    52,149  (deathmatch1999==1)
        from using                     94,201  (deathmatch1999==2)

    matched                             2,858
        not updated                         0  (deathmatch1999==3)
        missing updated                 2,858  (deathmatch1999==4)
        nonmissing conflict                 0  (deathmatch1999==5)
    -----------------------------------------

           |    deathmatch1999
    1 year | master on  missing u |     Total
-----------+----------------------+----------
      1996 |     3,283          0 |     3,283 
      1997 |     4,390          0 |     4,390 
      1998 |     2,985          0 |     2,985 
      1999 |     3,216          0 |     3,216 
      2000 |     1,945      1,494 |     3,439 
      2001 |     3,135      1,364 |     4,499 
      2002 |     4,916          0 |     4,916 
      2003 |     4,512          0 |     4,512 
      2004 |     4,418          0 |     4,418 
      2005 |     4,235          0 |     4,235 
      2006 |     4,465          0 |     4,465 
      2007 |     4,108          0 |     4,108 
      2008 |     6,541          0 |     6,541 
-----------+----------------------+----------
     Total |    52,149      2,858 |    55,007 

(94,201 observations deleted)
(label eligfmt already defined)
(label mortfmt already defined)
(label msrcendifmt already defined)
(label msrcessafmt already defined)
(label msrcecmsfmt already defined)
(label qtrfmt already defined)
(label causefmt already defined)
(label flagfmt already defined)

    Result                           # of obs.
    -----------------------------------------
    not matched                       143,725
        from master                    49,057  (deathmatch2000==1)
        from using                     94,668  (deathmatch2000==2)

    matched                             5,950
        not updated                         0  (deathmatch2000==3)
        missing updated                 5,950  (deathmatch2000==4)
        nonmissing conflict                 0  (deathmatch2000==5)
    -----------------------------------------

           |    deathmatch2000
    1 year | master on  missing u |     Total
-----------+----------------------+----------
      1996 |     3,283          0 |     3,283 
      1997 |     4,390          0 |     4,390 
      1998 |     2,985          0 |     2,985 
      1999 |     3,216          0 |     3,216 
      2000 |     3,439          0 |     3,439 
      2001 |     1,411      3,088 |     4,499 
      2002 |     2,054      2,862 |     4,916 
      2003 |     4,512          0 |     4,512 
      2004 |     4,418          0 |     4,418 
      2005 |     4,235          0 |     4,235 
      2006 |     4,465          0 |     4,465 
      2007 |     4,108          0 |     4,108 
      2008 |     6,541          0 |     6,541 
-----------+----------------------+----------
     Total |    49,057      5,950 |    55,007 

(94,668 observations deleted)
(label eligfmt already defined)
(label mortfmt already defined)
(label msrcendifmt already defined)
(label msrcessafmt already defined)
(label msrcecmsfmt already defined)
(label qtrfmt already defined)
(label causefmt already defined)
(label flagfmt already defined)

    Result                           # of obs.
    -----------------------------------------
    not matched                       147,295
        from master                    50,771  (deathmatch2001==1)
        from using                     96,524  (deathmatch2001==2)

    matched                             4,236
        not updated                         0  (deathmatch2001==3)
        missing updated                 4,236  (deathmatch2001==4)
        nonmissing conflict                 0  (deathmatch2001==5)
    -----------------------------------------

           |    deathmatch2001
    1 year | master on  missing u |     Total
-----------+----------------------+----------
      1996 |     3,283          0 |     3,283 
      1997 |     4,390          0 |     4,390 
      1998 |     2,985          0 |     2,985 
      1999 |     3,216          0 |     3,216 
      2000 |     3,439          0 |     3,439 
      2001 |     4,499          0 |     4,499 
      2002 |     2,916      2,000 |     4,916 
      2003 |     2,276      2,236 |     4,512 
      2004 |     4,418          0 |     4,418 
      2005 |     4,235          0 |     4,235 
      2006 |     4,465          0 |     4,465 
      2007 |     4,108          0 |     4,108 
      2008 |     6,541          0 |     6,541 
-----------+----------------------+----------
     Total |    50,771      4,236 |    55,007 

(96,524 observations deleted)
(label eligfmt already defined)
(label mortfmt already defined)
(label msrcendifmt already defined)
(label msrcessafmt already defined)
(label msrcecmsfmt already defined)
(label qtrfmt already defined)
(label causefmt already defined)
(label flagfmt already defined)

    Result                           # of obs.
    -----------------------------------------
    not matched                       139,773
        from master                    50,697  (deathmatch2002==1)
        from using                     89,076  (deathmatch2002==2)

    matched                             4,310
        not updated                         0  (deathmatch2002==3)
        missing updated                 4,310  (deathmatch2002==4)
        nonmissing conflict                 0  (deathmatch2002==5)
    -----------------------------------------

           |    deathmatch2002
    1 year | master on  missing u |     Total
-----------+----------------------+----------
      1996 |     3,283          0 |     3,283 
      1997 |     4,390          0 |     4,390 
      1998 |     2,985          0 |     2,985 
      1999 |     3,216          0 |     3,216 
      2000 |     3,439          0 |     3,439 
      2001 |     4,499          0 |     4,499 
      2002 |     4,916          0 |     4,916 
      2003 |     2,286      2,226 |     4,512 
      2004 |     2,334      2,084 |     4,418 
      2005 |     4,235          0 |     4,235 
      2006 |     4,465          0 |     4,465 
      2007 |     4,108          0 |     4,108 
      2008 |     6,541          0 |     6,541 
-----------+----------------------+----------
     Total |    50,697      4,310 |    55,007 

(89,076 observations deleted)
(label eligfmt already defined)
(label mortfmt already defined)
(label msrcendifmt already defined)
(label msrcessafmt already defined)
(label msrcecmsfmt already defined)
(label qtrfmt already defined)
(label causefmt already defined)
(label flagfmt already defined)

    Result                           # of obs.
    -----------------------------------------
    not matched                       138,479
        from master                    50,669  (deathmatch2003==1)
        from using                     87,810  (deathmatch2003==2)

    matched                             4,338
        not updated                         0  (deathmatch2003==3)
        missing updated                 4,338  (deathmatch2003==4)
        nonmissing conflict                 0  (deathmatch2003==5)
    -----------------------------------------

           |    deathmatch2003
    1 year | master on  missing u |     Total
-----------+----------------------+----------
      1996 |     3,283          0 |     3,283 
      1997 |     4,390          0 |     4,390 
      1998 |     2,985          0 |     2,985 
      1999 |     3,216          0 |     3,216 
      2000 |     3,439          0 |     3,439 
      2001 |     4,499          0 |     4,499 
      2002 |     4,916          0 |     4,916 
      2003 |     4,512          0 |     4,512 
      2004 |     2,136      2,282 |     4,418 
      2005 |     2,179      2,056 |     4,235 
      2006 |     4,465          0 |     4,465 
      2007 |     4,108          0 |     4,108 
      2008 |     6,541          0 |     6,541 
-----------+----------------------+----------
     Total |    50,669      4,338 |    55,007 

(87,810 observations deleted)
(label eligfmt already defined)
(label mortfmt already defined)
(label msrcendifmt already defined)
(label msrcessafmt already defined)
(label msrcecmsfmt already defined)
(label qtrfmt already defined)
(label causefmt already defined)
(label flagfmt already defined)

    Result                           # of obs.
    -----------------------------------------
    not matched                       140,931
        from master                    50,739  (deathmatch2004==1)
        from using                     90,192  (deathmatch2004==2)

    matched                             4,268
        not updated                         0  (deathmatch2004==3)
        missing updated                 4,268  (deathmatch2004==4)
        nonmissing conflict                 0  (deathmatch2004==5)
    -----------------------------------------

           |    deathmatch2004
    1 year | master on  missing u |     Total
-----------+----------------------+----------
      1996 |     3,283          0 |     3,283 
      1997 |     4,390          0 |     4,390 
      1998 |     2,985          0 |     2,985 
      1999 |     3,216          0 |     3,216 
      2000 |     3,439          0 |     3,439 
      2001 |     4,499          0 |     4,499 
      2002 |     4,916          0 |     4,916 
      2003 |     4,512          0 |     4,512 
      2004 |     4,418          0 |     4,418 
      2005 |     2,085      2,150 |     4,235 
      2006 |     2,347      2,118 |     4,465 
      2007 |     4,108          0 |     4,108 
      2008 |     6,541          0 |     6,541 
-----------+----------------------+----------
     Total |    50,739      4,268 |    55,007 

(90,192 observations deleted)
(label eligfmt already defined)
(label mortfmt already defined)
(label msrcendifmt already defined)
(label msrcessafmt already defined)
(label msrcecmsfmt already defined)
(label qtrfmt already defined)
(label causefmt already defined)
(label flagfmt already defined)

    Result                           # of obs.
    -----------------------------------------
    not matched                       144,662
        from master                    50,510  (deathmatch2005==1)
        from using                     94,152  (deathmatch2005==2)

    matched                             4,497
        not updated                         0  (deathmatch2005==3)
        missing updated                 4,497  (deathmatch2005==4)
        nonmissing conflict                 0  (deathmatch2005==5)
    -----------------------------------------

           |    deathmatch2005
    1 year | master on  missing u |     Total
-----------+----------------------+----------
      1996 |     3,283          0 |     3,283 
      1997 |     4,390          0 |     4,390 
      1998 |     2,985          0 |     2,985 
      1999 |     3,216          0 |     3,216 
      2000 |     3,439          0 |     3,439 
      2001 |     4,499          0 |     4,499 
      2002 |     4,916          0 |     4,916 
      2003 |     4,512          0 |     4,512 
      2004 |     4,418          0 |     4,418 
      2005 |     4,235          0 |     4,235 
      2006 |     2,118      2,347 |     4,465 
      2007 |     1,958      2,150 |     4,108 
      2008 |     6,541          0 |     6,541 
-----------+----------------------+----------
     Total |    50,510      4,497 |    55,007 

(94,152 observations deleted)
(label eligfmt already defined)
(label mortfmt already defined)
(label msrcendifmt already defined)
(label msrcessafmt already defined)
(label msrcecmsfmt already defined)
(label qtrfmt already defined)
(label causefmt already defined)
(label flagfmt already defined)

    Result                           # of obs.
    -----------------------------------------
    not matched                       123,489
        from master                    51,390  (deathmatch2006==1)
        from using                     72,099  (deathmatch2006==2)

    matched                             3,617
        not updated                         0  (deathmatch2006==3)
        missing updated                 3,617  (deathmatch2006==4)
        nonmissing conflict                 0  (deathmatch2006==5)
    -----------------------------------------

           |    deathmatch2006
    1 year | master on  missing u |     Total
-----------+----------------------+----------
      1996 |     3,283          0 |     3,283 
      1997 |     4,390          0 |     4,390 
      1998 |     2,985          0 |     2,985 
      1999 |     3,216          0 |     3,216 
      2000 |     3,439          0 |     3,439 
      2001 |     4,499          0 |     4,499 
      2002 |     4,916          0 |     4,916 
      2003 |     4,512          0 |     4,512 
      2004 |     4,418          0 |     4,418 
      2005 |     4,235          0 |     4,235 
      2006 |     4,465          0 |     4,465 
      2007 |     2,150      1,958 |     4,108 
      2008 |     4,882      1,659 |     6,541 
-----------+----------------------+----------
     Total |    51,390      3,617 |    55,007 

(72,099 observations deleted)
(label eligfmt already defined)
(label mortfmt already defined)
(label msrcendifmt already defined)
(label msrcessafmt already defined)
(label msrcecmsfmt already defined)
(label qtrfmt already defined)
(label causefmt already defined)
(label flagfmt already defined)

    Result                           # of obs.
    -----------------------------------------
    not matched                       121,007
        from master                    50,125  (deathmatch2007==1)
        from using                     70,882  (deathmatch2007==2)

    matched                             4,882
        not updated                         0  (deathmatch2007==3)
        missing updated                 4,882  (deathmatch2007==4)
        nonmissing conflict                 0  (deathmatch2007==5)
    -----------------------------------------

           |    deathmatch2007
    1 year | master on  missing u |     Total
-----------+----------------------+----------
      1996 |     3,283          0 |     3,283 
      1997 |     4,390          0 |     4,390 
      1998 |     2,985          0 |     2,985 
      1999 |     3,216          0 |     3,216 
      2000 |     3,439          0 |     3,439 
      2001 |     4,499          0 |     4,499 
      2002 |     4,916          0 |     4,916 
      2003 |     4,512          0 |     4,512 
      2004 |     4,418          0 |     4,418 
      2005 |     4,235          0 |     4,235 
      2006 |     4,465          0 |     4,465 
      2007 |     4,108          0 |     4,108 
      2008 |     1,659      4,882 |     6,541 
-----------+----------------------+----------
     Total |    50,125      4,882 |    55,007 

(70,882 observations deleted)
(label eligfmt already defined)
(label mortfmt already defined)
(label msrcendifmt already defined)
(label msrcessafmt already defined)
(label msrcecmsfmt already defined)
(label qtrfmt already defined)
(label causefmt already defined)
(label flagfmt already defined)

    Result                           # of obs.
    -----------------------------------------
    not matched                       129,243
        from master                    55,007  (deathmatch2008==1)
        from using                     74,236  (deathmatch2008==2)

    matched                                 0
        not updated                         0  (deathmatch2008==3)
        missing updated                     0  (deathmatch2008==4)
        nonmissing conflict                 0  (deathmatch2008==5)
    -----------------------------------------

           | deathmatch
           |    2008
    1 year | master on |     Total
-----------+-----------+----------
      1996 |     3,283 |     3,283 
      1997 |     4,390 |     4,390 
      1998 |     2,985 |     2,985 
      1999 |     3,216 |     3,216 
      2000 |     3,439 |     3,439 
      2001 |     4,499 |     4,499 
      2002 |     4,916 |     4,916 
      2003 |     4,512 |     4,512 
      2004 |     4,418 |     4,418 
      2005 |     4,235 |     4,235 
      2006 |     4,465 |     4,465 
      2007 |     4,108 |     4,108 
      2008 |     6,541 |     6,541 
-----------+-----------+----------
     Total |    55,007 |    55,007 

(74,236 observations deleted)

. di _N
55007

. * health
. * 1 = dead, 2 = poor-fair, 3 = good, 4 = vgood-excellent
. gen died = dodyear==(year+1) if dodyear!=. 
(49,431 missing values generated)

. replace died = . if dodyear<=year
(204 real changes made, 204 to missing)

. 
. replace fhlth = 1 if died==1
(621 real changes made)

. label def hlth 1 "dead" 2 "poor-fair" 3 "good" 4 "vgood-excellent"

. label values hlth hlth

. label values fhlth hlth

. 
. * merge life-table (age,sex,year from HMD)
. gen rage = age

. * gen birth year 
. gen byr = year - age

.         #d ;
delimiter now ;
.         recode byr (min/1920=1) (1921/1930=2) (1931/1935=3) 
>         (1936/1945=4) (1946/1955=5) (1956/1965=6) (1966/max=7), gen(byr_c);
(55007 differences between byr and byr_c)

.         #d cr
delimiter now cr
.         char byr_c[omit] 4

. merge m:1 male year rage using $src/raw/other/mortality.dta, gen(lifetable)

    Result                           # of obs.
    -----------------------------------------
    not matched                        20,286
        from master                    15,114  (lifetable==1)
        from using                      5,172  (lifetable==2)

    matched                            39,893  (lifetable==3)
    -----------------------------------------

. * drop if ages not present in MEPS-NHIS
. drop if lifetable==2
(5,172 observations deleted)

. 
. * destring id
. destring dupersid, replace
dupersid: all characters numeric; replaced as long

. 
. * sample selection and cleanup
. #d ;
delimiter now ;
. keep dupersid fhlth age hlth fmepsexp smoken smokev obese totinc mepsexp
>         mx male obese byr byr_c educ perwt year  mepsslf inscov;

. order dupersid fhlth age hlth fmepsexp smoken smokev obese totinc mepsexp
>         mx male obese byr byr_c educ perwt year mepsslf inscov;

. #d cr
delimiter now cr
. save $src/data/meps-nhis_wide_extract.dta, replace
file ~/cedia/Projets/rise-data/data/meps-nhis_wide_extract.dta saved

. 
. exit

end of do-file


. 
. * obtain estimates of production function

. do do/production32.do

. *****************************************************
. * Estimation of production function using MEPS-NHIS *
. * Fonseca, Michaud, Kapteyn and Galama (2018)       *
. * version 32
. * Last version: June 2018
. *****************************************************
. 
. * extract from MEPS-NHIS data
. use $src/data/meps-nhis_wide_extract.dta, clear
(MEPS1996-2008)

. 
. * first stage variable (do log(1+x) to deal with zeros)
. gen logmed  = log(1+fmepsexp)
(9,472 missing values generated)

. gen llogmed = log(1+mepsexp)
(295 missing values generated)

. gen loginc  = log(1+totinc)
(1 missing value generated)

. gen loginc2 = loginc*loginc
(1 missing value generated)

. * instrument set and regressors
. global x "age ib2.hlth obese smokev"

. global z "loginc"

. * first stage
. xi: reg logmed $x $z, robust

Linear regression                               Number of obs     =     14,346
                                                F(6, 14339)       =     632.38
                                                Prob > F          =     0.0000
                                                R-squared         =     0.1818
                                                Root MSE          =     3.0065

------------------------------------------------------------------------------
             |               Robust
      logmed |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         age |   .0837145   .0016414    51.00   0.000     .0804971    .0869319
             |
        hlth |
       good  |  -.9748045   .0782385   -12.46   0.000    -1.128162    -.821447
vgood-exc~t  |  -1.343243   .0745696   -18.01   0.000    -1.489409   -1.197077
             |
       obese |   .4673053   .0558556     8.37   0.000     .3578211    .5767895
      smokev |   -.099522   .0520291    -1.91   0.056    -.2015057    .0024617
      loginc |   .1391012    .014568     9.55   0.000      .110546    .1676564
       _cons |   1.634466   .1850629     8.83   0.000     1.271719    1.997213
------------------------------------------------------------------------------

. test $z

 ( 1)  loginc = 0

       F(  1, 14339) =   91.17
            Prob > F =    0.0000

. predict ulogmed, residuals
(40,661 missing values generated)

. gen ulogmed2 = ulogmed^2
(40,661 missing values generated)

. gen ulogmed3 = ulogmed^3
(40,661 missing values generated)

. * second-stage (mlogit with control function)ulogmed2 ulogmed3
. gen logmed2 = logmed*logmed
(9,472 missing values generated)

. mlogit fhlth ulogmed logmed logmed2  $x if fhlth!=1, base(2)

Iteration 0:   log likelihood = -13757.551  
Iteration 1:   log likelihood = -11039.384  
Iteration 2:   log likelihood = -10871.864  
Iteration 3:   log likelihood = -10407.842  
Iteration 4:   log likelihood =  -10405.57  
Iteration 5:   log likelihood = -10405.568  
Iteration 6:   log likelihood = -10405.568  

Multinomial logistic regression                 Number of obs     =     14,237
                                                LR chi2(16)       =    6703.96
                                                Prob > chi2       =     0.0000
Log likelihood = -10405.568                     Pseudo R2         =     0.2436

------------------------------------------------------------------------------
       fhlth |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
poor_fair    |  (base outcome)
-------------+----------------------------------------------------------------
good         |
     ulogmed |  -.5098863   .0902328    -5.65   0.000    -.6867393   -.3330332
      logmed |   .5660033    .094424     5.99   0.000     .3809356     .751071
     logmed2 |   -.017186   .0032046    -5.36   0.000    -.0234669   -.0109051
         age |  -.0499831   .0078086    -6.40   0.000    -.0652876   -.0346786
             |
        hlth |
       good  |   2.471937   .1097945    22.51   0.000     2.256744    2.687131
vgood-exc~t  |   3.110439   .1427836    21.78   0.000     2.830589     3.39029
             |
       obese |  -.3043479   .0788217    -3.86   0.000    -.4588356   -.1498601
      smokev |  -.1962278   .0666809    -2.94   0.003    -.3269201   -.0655356
       _cons |  -.9722696   .2980101    -3.26   0.001    -1.556359   -.3881805
-------------+----------------------------------------------------------------
vgood_exce~t |
     ulogmed |  -1.076723   .1060439   -10.15   0.000    -1.284566   -.8688812
      logmed |   1.281066   .1097609    11.67   0.000     1.065939    1.496194
     logmed2 |  -.0386663   .0034342   -11.26   0.000    -.0453973   -.0319353
         age |  -.1003976   .0090733   -11.07   0.000     -.118181   -.0826143
             |
        hlth |
       good  |   3.350822   .1333066    25.14   0.000     3.089546    3.612098
vgood-exc~t  |   5.888619   .1674917    35.16   0.000     5.560341    6.216896
             |
       obese |  -.9010811   .0863191   -10.44   0.000    -1.070263   -.7318988
      smokev |  -.3539678   .0690228    -5.13   0.000    -.4892499   -.2186856
       _cons |  -2.870523   .3475647    -8.26   0.000    -3.551737   -2.189309
------------------------------------------------------------------------------

. 
. matrix b = e(b)

. matrix bhealth = J(10,3,.)

. local i = 1

. forvalues h = 1/3 {
  2.         forvalues x=1/10 {
  3.                 matrix bhealth[`x',`h'] = b[1,`i']
  4.                 local i = `i'+1
  5.         }
  6. }

. matrix bhealth = bhealth[2..10,1..3]

. matrix list bhealth

bhealth[9,3]
             c1          c2          c3
 r2           0   .56600333   1.2810663
 r3           0  -.01718598  -.03866626
 r4           0   -.0499831  -.10039762
 r5           0           0           0
 r6           0   2.4719373   3.3508218
 r7           0   3.1104393   5.8886187
 r8           0  -.30434787  -.90108112
 r9           0  -.19622784  -.35396777
r10           0  -.97226959  -2.8705228

. 
. margins , dydx(logmed) predict(outcome(2))

Average marginal effects                        Number of obs     =     14,237
Model VCE    : OIM

Expression   : Pr(fhlth==poor_fair), predict(outcome(2))
dy/dx w.r.t. : logmed

------------------------------------------------------------------------------
             |            Delta-method
             |      dy/dx   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
      logmed |  -.0684948   .0072445    -9.45   0.000    -.0826938   -.0542957
------------------------------------------------------------------------------

. margins , dydx(logmed) predict(outcome(3))

Average marginal effects                        Number of obs     =     14,237
Model VCE    : OIM

Expression   : Pr(fhlth==good), predict(outcome(3))
dy/dx w.r.t. : logmed

------------------------------------------------------------------------------
             |            Delta-method
             |      dy/dx   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
      logmed |  -.0712437   .0137617    -5.18   0.000    -.0982161   -.0442714
------------------------------------------------------------------------------

. margins , dydx(logmed) predict(outcome(4))

Average marginal effects                        Number of obs     =     14,237
Model VCE    : OIM

Expression   : Pr(fhlth==vgood_excellent), predict(outcome(4))
dy/dx w.r.t. : logmed

------------------------------------------------------------------------------
             |            Delta-method
             |      dy/dx   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
      logmed |   .1397385   .0141299     9.89   0.000     .1120443    .1674327
------------------------------------------------------------------------------

. 
. 
. 
. 
. * predictions for transitions at different rates of spending
. preserve

. gen hlth3 = hlth==3 if hlth!=.
(370 missing values generated)

. gen hlth4 = hlth==4 if hlth!=.
(370 missing values generated)

. mlogit fhlth ulogmed logmed logmed2 age hlth3 hlth4 obese smokev if fhlth!=1,
>  base(2)

Iteration 0:   log likelihood = -13757.551  
Iteration 1:   log likelihood = -11039.384  
Iteration 2:   log likelihood = -10871.864  
Iteration 3:   log likelihood = -10407.842  
Iteration 4:   log likelihood =  -10405.57  
Iteration 5:   log likelihood = -10405.568  
Iteration 6:   log likelihood = -10405.568  

Multinomial logistic regression                 Number of obs     =     14,237
                                                LR chi2(16)       =    6703.96
                                                Prob > chi2       =     0.0000
Log likelihood = -10405.568                     Pseudo R2         =     0.2436

------------------------------------------------------------------------------
       fhlth |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
poor_fair    |  (base outcome)
-------------+----------------------------------------------------------------
good         |
     ulogmed |  -.5098863   .0902328    -5.65   0.000    -.6867393   -.3330332
      logmed |   .5660033    .094424     5.99   0.000     .3809356     .751071
     logmed2 |   -.017186   .0032046    -5.36   0.000    -.0234669   -.0109051
         age |  -.0499831   .0078086    -6.40   0.000    -.0652876   -.0346786
       hlth3 |   2.471937   .1097945    22.51   0.000     2.256744    2.687131
       hlth4 |   3.110439   .1427836    21.78   0.000     2.830589     3.39029
       obese |  -.3043479   .0788217    -3.86   0.000    -.4588356   -.1498601
      smokev |  -.1962278   .0666809    -2.94   0.003    -.3269201   -.0655356
       _cons |  -.9722696   .2980101    -3.26   0.001    -1.556359   -.3881805
-------------+----------------------------------------------------------------
vgood_exce~t |
     ulogmed |  -1.076723   .1060439   -10.15   0.000    -1.284566   -.8688812
      logmed |   1.281066   .1097609    11.67   0.000     1.065939    1.496194
     logmed2 |  -.0386663   .0034342   -11.26   0.000    -.0453973   -.0319353
         age |  -.1003976   .0090733   -11.07   0.000     -.118181   -.0826143
       hlth3 |   3.350822   .1333066    25.14   0.000     3.089546    3.612098
       hlth4 |   5.888619   .1674917    35.16   0.000     5.560341    6.216896
       obese |  -.9010811   .0863191   -10.44   0.000    -1.070263   -.7318988
      smokev |  -.3539678   .0690228    -5.13   0.000    -.4892499   -.2186856
       _cons |  -2.870523   .3475647    -8.26   0.000    -3.551737   -2.189309
------------------------------------------------------------------------------

. replace hlth3 = 0
(16,165 real changes made)

. replace hlth4 = 1
(24,134 real changes made)

. replace ulogmed = 0
(55,007 real changes made)

. predict p1_f p2_f p3_f, pr
(40656 missing values generated)

. replace logmed = 0
(44,976 real changes made)

. replace logmed2 = 0
(44,976 real changes made)

. predict p1 p2 p3, pr
(37555 missing values generated)

. tabstat p1_f p2_f p3_f p1 p2 p3 if e(sample)==1, by(age)

Summary statistics: mean
  by categories of: age (1 age)

     age |      p1_f      p2_f      p3_f        p1        p2        p3
---------+------------------------------------------------------------
      25 |  .1049218  .2461236  .6489547  .2310011  .4833318  .2856671
      26 |  .0980411  .2232914  .6786676  .2491135  .4861701  .2647163
      27 |   .095559  .2071384  .6973026  .2595289  .4864381   .254033
      28 |  .0916452  .1921885  .7161663  .2778046  .4868873  .2353081
      29 |  .1139633  .2211879  .6648488  .2920805  .4845948  .2233247
      30 |   .098801  .1946061   .706593  .3065093  .4836369  .2098539
      31 |  .1070407  .2040195  .6889397  .3155833  .4818555  .2025612
      32 |  .1135023  .2059689  .6805288  .3268311  .4785244  .1946445
      33 |  .1044596  .1884088  .7071316  .3468976  .4743414   .178761
      34 |  .1017563  .1777733  .7204704  .3575271  .4708939   .171579
      35 |  .1126513  .1896662  .6976825  .3778295  .4654649  .1567056
      36 |  .1178794  .1837886   .698332  .3953288  .4583208  .1463504
      37 |  .1046211  .1718188  .7235601  .4025302  .4551083  .1423615
      38 |  .1337766  .1991629  .6670605  .4223314  .4473799  .1302887
      39 |  .1118298  .1682723  .7198979  .4374137  .4407847  .1218015
      40 |  .1176543  .1785646  .7037811  .4494306   .434726  .1158434
      41 |  .1129249  .1685301   .718545  .4671923  .4256534  .1071543
      42 |  .1308708  .1736068  .6955224  .4780894  .4195505    .10236
      43 |  .1210108  .1627253  .7162638  .5010637  .4076881  .0912482
      44 |  .1346776  .1722568  .6930656  .5103363  .4020446  .0876191
      45 |  .1073213  .1485346  .7441441  .5277568  .3920201  .0802232
      46 |  .1139663  .1602364  .7257973  .5405067  .3840756  .0754176
      47 |  .0998911  .1489614  .7511475  .5603602  .3717937  .0678461
      48 |  .1179448  .1560169  .7260383  .5727751  .3636867  .0635381
      49 |  .1113052  .1484041  .7402907  .5877215  .3535905   .058688
      50 |  .1122771  .1495269   .738196  .6031459  .3431868  .0536673
      51 |   .094502  .1371015  .7683965   .615338  .3345992  .0500629
      52 |  .1359632  .1512687  .7127682  .6320429  .3225254  .0454317
      53 |  .1040603  .1522305  .7437092  .6411733  .3157821  .0430446
      54 |  .1036543  .1503588   .745987   .652002  .3077072  .0402908
      55 |  .1091783  .1499469  .7408748  .6705946  .2942381  .0351674
      56 |  .0943178  .1487432   .756939  .6821826  .2851249  .0326925
      57 |  .1005046  .1418435   .757652  .6903283  .2784541  .0312176
      58 |  .0693443  .1381232  .7925324  .7061839  .2660486  .0277675
      59 |  .0638229  .1455979  .7905792  .7212034   .254186  .0246107
      60 |  .0960795  .1519114  .7520091   .730743  .2463974  .0228595
      61 |   .081778  .1514802  .7667418  .7391849  .2393542  .0214609
      62 |   .081559  .1515449  .7668962  .7457399  .2339315  .0203286
      63 |  .0940825  .1608503  .7450672   .757749  .2239708  .0182802
      64 |  .0837353  .1611551  .7551096  .7700298  .2136352   .016335
      65 |   .069982  .1574485  .7725694  .7747917  .2094561  .0157522
      66 |  .0605688  .1577184  .7817128  .7874179  .1987199  .0138622
      67 |  .0658418    .16066  .7734982  .7939254  .1930599  .0130146
      68 |  .0576857   .169155  .7731594  .7983666  .1891974   .012436
      69 |  .0872394  .1842423  .7285183  .8136204  .1759226   .010457
      70 |  .0558895  .1761674   .767943  .8165047  .1732832  .0102121
      71 |  .0743215  .1803776  .7453009  .8283982  .1627337  .0088682
      72 |  .0844055  .1846653  .7309292  .8311774  .1603041  .0085185
      73 |  .0788235  .1855812  .7355953  .8396562  .1526587  .0076851
      74 |  .0795661  .2039333  .7165006  .8462394  .1467176   .007043
      75 |  .0851651  .2026892  .7121457  .8510991  .1422688  .0066321
      76 |  .0933778  .2046651  .7019571  .8598136  .1343337  .0058527
      77 |  .0867319  .2054483  .7078197  .8667132  .1280443  .0052426
      78 |  .0986646  .2135828  .6877526  .8691438  .1257631  .0050931
      79 |  .0875086  .2198415  .6926498  .8769636  .1185844   .004452
      80 |  .0850835  .2271842  .6877324  .8802741  .1155154  .0042105
      81 |  .1207877  .2231664  .6560459  .8874343    .10888  .0036857
      82 |  .0744276  .2297807  .6957917  .8928011  .1038452  .0033537
      83 |  .0673933  .2392508  .6933559  .8960461  .1008011  .0031528
      84 |  .1066798  .2341709  .6591493  .8968171  .1000563  .0031265
---------+------------------------------------------------------------
   Total |  .1016899   .173677  .7246331  .5667675  .3448503  .0883822
----------------------------------------------------------------------

. restore

. 
. * computing corrected standard errors using bootstrap
. gen hlth3 = hlth==3 if hlth!=.
(370 missing values generated)

. gen hlth4 = hlth==4 if hlth!=.
(370 missing values generated)

. 
. global x "age hlth3 hlth4 obese smokev"

. global z "loginc"

. capture program drop controlfunc

. program controlfunc, eclass
  1.   version 10.1
  2.   tempname b
  3.   reg logmed $x $z, robust
  4.   capture drop ulogmed
  5.   predict ulogmed, residuals
  6.   mlogit fhlth ulogmed logmed logmed2  $x if fhlth!=1, base(2)
  7.   matrix `b' = e(b)
  8.   ereturn post `b' 
  9. end

. preserve

.         bootstrap _b, reps(100) seed(10101) nodots nowarn: controlfunc

Bootstrap results                               Number of obs     =     55,007
                                                Replications      =        100

------------------------------------------------------------------------------
             |   Observed   Bootstrap                         Normal-based
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
good         |
     ulogmed |  -.5098863   .1181935    -4.31   0.000    -.7415412   -.2782313
      logmed |   .5660033   .1247184     4.54   0.000     .3215597    .8104469
     logmed2 |   -.017186   .0037433    -4.59   0.000    -.0245227   -.0098493
         age |  -.0499831   .0103364    -4.84   0.000     -.070242   -.0297242
       hlth3 |   2.471937   .1461791    16.91   0.000     2.185431    2.758443
       hlth4 |   3.110439   .1694192    18.36   0.000     2.778384    3.442495
       obese |  -.3043479   .0940397    -3.24   0.001    -.4886623   -.1200335
      smokev |  -.1962278   .0757602    -2.59   0.010     -.344715   -.0477407
       _cons |  -.9722696   .3574286    -2.72   0.007    -1.672817   -.2717224
-------------+----------------------------------------------------------------
vgood-exce~t |
     ulogmed |  -1.076723   .1701144    -6.33   0.000    -1.410142   -.7433053
      logmed |   1.281066   .1721441     7.44   0.000       .94367    1.618463
     logmed2 |  -.0386663   .0039558    -9.77   0.000    -.0464195   -.0309131
         age |  -.1003976   .0146707    -6.84   0.000    -.1291517   -.0716435
       hlth3 |   3.350822   .2115629    15.84   0.000     2.936166    3.765477
       hlth4 |   5.888619   .2478974    23.75   0.000     5.402749    6.374489
       obese |  -.9010811   .1202884    -7.49   0.000    -1.136842   -.6653201
      smokev |  -.3539678   .0925301    -3.83   0.000    -.5353235   -.1726121
       _cons |  -2.870523   .5217589    -5.50   0.000    -3.893151   -1.847894
------------------------------------------------------------------------------

. restore

. 
. **** Model for mortality *********
. gen dead = fhlth==1 if missing(fhlth)==0
(8,948 missing values generated)

. global xd "age ib2.hlth"

. cloglog dead $xd

Iteration 0:   log likelihood = -2333.3218  
Iteration 1:   log likelihood =  -2332.806  
Iteration 2:   log likelihood = -2332.8057  
Iteration 3:   log likelihood = -2332.8057  

Complementary log-log regression                Number of obs     =     45,895
                                                Zero outcomes     =     45,362
                                                Nonzero outcomes  =        533

                                                LR chi2(3)        =    1143.83
Log likelihood = -2332.8057                     Prob > chi2       =     0.0000

------------------------------------------------------------------------------
        dead |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         age |   .0744077   .0034384    21.64   0.000     .0676686    .0811468
             |
        hlth |
       good  |  -1.257179   .1062247   -11.84   0.000    -1.465375   -1.048982
vgood-exc~t  |  -1.890594   .1179531   -16.03   0.000    -2.121778   -1.659411
             |
       _cons |  -7.691214   .2423588   -31.73   0.000    -8.166229     -7.2162
------------------------------------------------------------------------------

. matrix bdead = e(b)'

. predict pdead, pr
(370 missing values generated)

. 
. global x "age ib2.hlth obese smokev"

. * effect medical spending on mortality
. preserve

.         local j = 1

.         set more off

.         cloglog dead $xd

Iteration 0:   log likelihood = -2333.3218  
Iteration 1:   log likelihood =  -2332.806  
Iteration 2:   log likelihood = -2332.8057  
Iteration 3:   log likelihood = -2332.8057  

Complementary log-log regression                Number of obs     =     45,895
                                                Zero outcomes     =     45,362
                                                Nonzero outcomes  =        533

                                                LR chi2(3)        =    1143.83
Log likelihood = -2332.8057                     Prob > chi2       =     0.0000

------------------------------------------------------------------------------
        dead |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         age |   .0744077   .0034384    21.64   0.000     .0676686    .0811468
             |
        hlth |
       good  |  -1.257179   .1062247   -11.84   0.000    -1.465375   -1.048982
vgood-exc~t  |  -1.890594   .1179531   -16.03   0.000    -2.121778   -1.659411
             |
       _cons |  -7.691214   .2423588   -31.73   0.000    -8.166229     -7.2162
------------------------------------------------------------------------------

.         margins hlth if age>=65, post

Predictive margins                              Number of obs     =      7,489
Model VCE    : OIM

Expression   : Pr(dead), predict()

------------------------------------------------------------------------------
             |            Delta-method
             |     Margin   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        hlth |
  poor-fair  |   .1029295   .0058416    17.62   0.000     .0914803    .1143788
       good  |   .0306303   .0028423    10.78   0.000     .0250595    .0362011
vgood-exc~t  |   .0163973   .0017828     9.20   0.000     .0129031    .0198915
------------------------------------------------------------------------------

.         matrix pd = e(b)'

.         matrix list pd

pd[3,1]
               y1
2.hlth  .10292954
3.hlth  .03063033
4.hlth   .0163973

.         matrix result = J(13,3,0)

.         mlogit fhlth ulogmed logmed logmed2  $x if fhlth!=1, base(2)

Iteration 0:   log likelihood = -13757.551  
Iteration 1:   log likelihood = -11039.384  
Iteration 2:   log likelihood = -10871.864  
Iteration 3:   log likelihood = -10407.842  
Iteration 4:   log likelihood =  -10405.57  
Iteration 5:   log likelihood = -10405.568  
Iteration 6:   log likelihood = -10405.568  

Multinomial logistic regression                 Number of obs     =     14,237
                                                LR chi2(16)       =    6703.96
                                                Prob > chi2       =     0.0000
Log likelihood = -10405.568                     Pseudo R2         =     0.2436

------------------------------------------------------------------------------
       fhlth |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
poor_fair    |  (base outcome)
-------------+----------------------------------------------------------------
good         |
     ulogmed |  -.5098863   .0902328    -5.65   0.000    -.6867393   -.3330332
      logmed |   .5660033    .094424     5.99   0.000     .3809356     .751071
     logmed2 |   -.017186   .0032046    -5.36   0.000    -.0234669   -.0109051
         age |  -.0499831   .0078086    -6.40   0.000    -.0652876   -.0346786
             |
        hlth |
       good  |   2.471937   .1097945    22.51   0.000     2.256744    2.687131
vgood-exc~t  |   3.110439   .1427836    21.78   0.000     2.830589     3.39029
             |
       obese |  -.3043479   .0788217    -3.86   0.000    -.4588356   -.1498601
      smokev |  -.1962278   .0666809    -2.94   0.003    -.3269201   -.0655356
       _cons |  -.9722696   .2980101    -3.26   0.001    -1.556359   -.3881805
-------------+----------------------------------------------------------------
vgood_exce~t |
     ulogmed |  -1.076723   .1060439   -10.15   0.000    -1.284566   -.8688812
      logmed |   1.281066   .1097609    11.67   0.000     1.065939    1.496194
     logmed2 |  -.0386663   .0034342   -11.26   0.000    -.0453973   -.0319353
         age |  -.1003976   .0090733   -11.07   0.000     -.118181   -.0826143
             |
        hlth |
       good  |   3.350822   .1333066    25.14   0.000     3.089546    3.612098
vgood-exc~t  |   5.888619   .1674917    35.16   0.000     5.560341    6.216896
             |
       obese |  -.9010811   .0863191   -10.44   0.000    -1.070263   -.7318988
      smokev |  -.3539678   .0690228    -5.13   0.000    -.4892499   -.2186856
       _cons |  -2.870523   .3475647    -8.26   0.000    -3.551737   -2.189309
------------------------------------------------------------------------------

.                 foreach med of numlist 0 10 100 250 500 750 1000 2500 5000 75
> 00 10000 15000 20000 {
  2.                         local logmed = log(1+`med')
  3.                         local logmed2 = log(1+`med')^2
  4.                         
.                         matrix ph = J(3,3,.)
  5.                         di `med'                        
  6.                         foreach h of numlist 2/4 {
  7.                                 qui margins hlth if age>=65, at(logmed=`lo
> gmed' logmed2=`logmed2') predict(outcome(`h')) 
  8.                                 local h1 = `h'-1
  9.                                 matrix ph[1,`h1'] = r(b)'
 10.                         }               
 11.                         matrix list  ph
 12.                         matrix y = ph*pd
 13.                         matrix result[`j',1]  = y'
 14.                         local j = `j'+1
 15.                 }
0

ph[3,3]
           c1         c2         c3
r1  .97296929  .02255844  .00447226
r2  .86894603  .11198228  .01907169
r3  .79712253  .15171131  .05116616
10

ph[3,3]
           c1         c2         c3
r1  .93237164  .04433575  .02329262
r2  .71218055  .23776798  .05005146
r3  .55775812  .30033257   .1419093
100

ph[3,3]
           c1         c2         c3
r1  .87671827  .07794932  .04533242
r2  .50591189  .38497952  .10910859
r3  .29762409  .35431356  .34806236
250

ph[3,3]
           c1         c2         c3
r1  .84470615  .09929533  .05599852
r2  .41965404  .42985138  .15049458
r3  .21210339  .33437563  .45352098
500

ph[3,3]
           c1         c2         c3
r1  .81591176  .11781706  .06627118
r2  .35849063   .4522578  .18925157
r3  .16028456  .30812345    .531592
750

ph[3,3]
           c1         c2         c3
r1  .79726537   .1292428  .07349182
r2  .32517096  .46028966  .21453938
r3  .13514116  .29020149  .57465735
1000

ph[3,3]
           c1         c2         c3
r1  .78327728  .13748436  .07923836
r2  .30280691  .46373105  .23346204
r3  .11947701   .2768928  .60363019
2500

ph[3,3]
           c1         c2         c3
r1  .73509562  .16360356  .10130081
r2  .23926847  .46316286  .29756868
r3  .08021775  .23410908  .68567317
5000

ph[3,3]
           c1         c2         c3
r1  .69591549  .18222708  .12185742
r2  .19920615  .45295146  .34784239
r3  .05938456   .2038019  .73681354
7500

ph[3,3]
           c1         c2         c3
r1  .67238995  .19229416  .13531589
r2  .17887891  .44405053  .37707056
r3  .04995305  .18754482  .76250213
10000

ph[3,3]
           c1         c2         c3
r1  .65559354  .19897567   .1454308
r2   .1657782  .43674568  .39747612
r3  .04427689  .17676828  .77895483
15000

ph[3,3]
           c1         c2         c3
r1  .63196516  .20766739  .16036744
r2   .1490749  .42540361  .42552149
r3  .03749461  .16269367  .79981172
20000

ph[3,3]
           c1         c2         c3
r1  .61535355  .21328596  .17136049
r2  .13840125  .41682153  .44477722
r3  .03342659  .15350298  .81307043

.         matrix list result

result[13,3]
            c1         c2         c3
 r1  .10091159    .093183  .08753341
 r2  .09770854  .08140804    .068936
 r3  .09337115  .06565442  .04719434
 r4  .09090489  .05882899  .03951026
 r5  .08867687   .0538553  .03465262
 r6  .08722598  .05108639  .03222182
 r7  .08613286  .04920016  .03067694
 r8  .08233535  .04369395  .02667081
 r9  .07921007  .04008193   .0244367
r10  .07731764  .03819628  .02338918
r11  .07595931  .03695868  .02274463
r12   .0740384  .03535187  .02195742
r13  .07268093  .03430611  .02147459

.         gen med = .
(55,007 missing values generated)

.         replace med = 0 in 1
(1 real change made)

.         replace med = 10 in 2
(1 real change made)

.         replace med = 100 in 3
(1 real change made)

.         replace med = 250 in 4
(1 real change made)

.         replace med = 500 in 5
(1 real change made)

.         replace med = 750 in 6
(1 real change made)

.         replace med = 1000 in 7
(1 real change made)

.         replace med = 2500 in 8
(1 real change made)

.         replace med = 5000 in 9
(1 real change made)

.         replace med = 7500 in 10
(1 real change made)

.         replace med = 10000 in 11
(1 real change made)

.         replace med = 15000 in 12
(1 real change made)

.         replace med = 20000 in 13
(1 real change made)

.         svmat result

.         keep result* med

.         #d ;
delimiter now ;
.                 twoway 
>                         (line result1 med if med>=500)
>                         (line result2 med if med>=500)
>                         (line result3 med if med>=500)
>                         ,
>                         xtitle("medical expenditures")
>                         ytitle("")
>                         title("mean mortality rate")
>                         subtitle("by current health status and medical expend
> itures")
>                         $fig
>                         ylabel(,labsize(small))
>                         xlabel(1000 2500 5000 7500 10000 15000 20000, labsize
> (small))
>                         legend(label(1 "poor-fair") label(2 "good") label(3 "
> vgood-excellent")  
>                         size(small) rows(2));

.                                 #d cr
delimiter now cr
.         graph export figures/mortality-effect.eps, as(eps) replace
(file figures/mortality-effect.eps written in EPS format)

. restore

. 
. 
. 
. * save productivity parameters
. preserve

.         svmat bhealth

.         keep bhealth*

.         keep if _n<=2
(55,005 observations deleted)

.         outsheet using params/input/production-theta.csv, replace comma nonam
> es nolabel 

. restore 

. 
. 
. * save parameters other than productivity
. preserve

.         svmat bhealth

.         keep bhealth*

.         keep if bhealth1!=.
(54,998 observations deleted)

.         drop if _n<=2
(2 observations deleted)

.         outsheet using params/input/production-health.csv, replace comma nona
> mes nolabel        

. restore 

. 
. * save death coefficients
. preserve

.         svmat bdead

.         keep bdead*

.         keep if bdead1!=.
(55,002 observations deleted)

.         outsheet using params/input/production-death.csv, replace comma nonam
> es nolabel 

. restore 

. 
. merge n:1 age using $src/raw/other/mortality-ssa-cohort.dta

    Result                           # of obs.
    -----------------------------------------
    not matched                            26
        from master                         0  (_merge==1)
        from using                         26  (_merge==2)

    matched                            55,007  (_merge==3)
    -----------------------------------------

. 
. egen mpdead = mean(pdead), by(age)
(26 missing values generated)

. gen pi = (pmx/mpdead)
(26 missing values generated)

. tabstat pmx mpdead pi, by(age)

Summary statistics: mean
  by categories of: age (1 age)

     age |       pmx    mpdead        pi
---------+------------------------------
      25 |    .00185    .00066  2.803225
      26 |    .00187  .0007254  2.577805
      27 |    .00189  .0007937  2.381402
      28 |    .00198  .0008636  2.292629
      29 |    .00206  .0009036  2.279823
      30 |    .00209  .0010192  2.050589
      31 |    .00212  .0010811  1.960943
      32 |    .00222  .0012002  1.849627
      33 |     .0023  .0012947   1.77643
      34 |    .00232  .0014357  1.615983
      35 |    .00237  .0015012  1.578763
      36 |    .00239  .0016371  1.459889
      37 |    .00258  .0018646  1.383705
      38 |    .00272  .0020104  1.352943
      39 |    .00282  .0021547  1.308739
      40 |    .00302  .0023956  1.260623
      41 |    .00321   .002617  1.226594
      42 |    .00329  .0029185   1.12729
      43 |    .00354  .0032862  1.077228
      44 |    .00388  .0035746  1.085437
      45 |    .00424  .0038184  1.110417
      46 |    .00456  .0042281  1.078492
      47 |    .00496  .0044933  1.103874
      48 |    .00543  .0056846  .9552054
      49 |    .00587  .0055722  1.053439
      50 |    .00625  .0060558  1.032068
      51 |    .00663   .006536  1.014374
      52 |    .00716  .0074978  .9549444
      53 |    .00791   .008122  .9738978
      54 |    .00851  .0085795   .991904
      55 |    .00909  .0098671  .9212387
      56 |    .00962  .0101122  .9513223
      57 |    .01026  .0122496  .8375818
      58 |    .01099   .012681   .866649
      59 |     .0119  .0136412   .872357
      60 |    .01268  .0147731  .8583179
      61 |    .01358  .0165186  .8221054
      62 |    .01468  .0174083  .8432754
      63 |    .01589  .0176606  .8997421
      64 |    .01718  .0211072  .8139417
      65 |    .01862  .0220775  .8433912
      66 |    .02021  .0246252  .8207049
      67 |    .02191  .0244548  .8959396
      68 |    .02371   .025876  .9162931
      69 |    .02564  .0303092   .845948
      70 |    .02785  .0330055  .8437999
      71 |     .0303  .0371475  .8156676
      72 |    .03281  .0394138  .8324495
      73 |    .03533   .039832  .8869754
      74 |    .03799  .0417153  .9106961
      75 |    .04108  .0520297  .7895493
      76 |    .04469  .0524044  .8527917
      77 |    .04872  .0589644  .8262612
      78 |    .05317  .0644181  .8253886
      79 |    .05813   .068329  .8507372
      80 |    .06369  .0709939  .8971198
      81 |    .07003  .0838402  .8352795
      82 |    .07739  .0853592  .9066389
      83 |    .08598  .0918476  .9361159
      84 |    .09574  .0986913  .9700959
      85 |    .10653         .         .
      86 |    .11818         .         .
      87 |    .13057         .         .
      88 |    .14363         .         .
      89 |    .15737         .         .
      90 |    .17185         .         .
      91 |    .18711         .         .
      92 |    .20325         .         .
      93 |    .22031         .         .
      94 |    .23835         .         .
      95 |    .25608         .         .
      96 |    .27319         .         .
      97 |    .28936         .         .
      98 |    .30428         .         .
      99 |    .31763         .         .
     100 |    .33157         .         .
     101 |    .34613         .         .
     102 |    .36134         .         .
     103 |    .37722         .         .
     104 |    .39382         .         .
     105 |    .41115         .         .
     106 |    .42925         .         .
     107 |    .44816         .         .
     108 |    .46792         .         .
     109 |    .48855         .         .
     110 |    .51011         .         .
---------+------------------------------
   Total |  .0108927  .0116273  1.290115
----------------------------------------

. 
. preserve

. * estimate a log linear model with spline at 60, good fit for smooth and extr
> apo
. keep pi age dead mx pmx

. collapse pi dead mx pmx, by(age)

. gen logpi = log(pi)
(26 missing values generated)

. gen age60m = min(age,60)

. gen age60p = max(age-60,0)

. reg logpi age60m age60p

      Source |       SS           df       MS      Number of obs   =        60
-------------+----------------------------------   F(2, 57)        =    397.56
       Model |  6.42958804         2  3.21479402   Prob > F        =    0.0000
    Residual |  .460917997        57  .008086281   R-squared       =    0.9331
-------------+----------------------------------   Adj R-squared   =    0.9308
       Total |  6.89050604        59  .116788238   Root MSE        =    .08992

------------------------------------------------------------------------------
       logpi |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
      age60m |  -.0302741   .0012264   -24.69   0.000    -.0327299   -.0278183
      age60p |   .0070312   .0019155     3.67   0.001     .0031955     .010867
       _cons |   1.561889   .0567616    27.52   0.000     1.448225    1.675552
------------------------------------------------------------------------------

. matrix pimat = e(b)'

. predict plogpi
(option xb assumed; fitted values)

. gen ppi = exp(plogpi)

. tabstat ppi, by(age)

Summary for variables: ppi
     by categories of: age (1 age)

     age |      mean
---------+----------
      25 |  2.236777
      26 |  2.170075
      27 |  2.105363
      28 |   2.04258
      29 |  1.981669
      30 |  1.922575
      31 |  1.865243
      32 |  1.809621
      33 |  1.755657
      34 |  1.703303
      35 |   1.65251
      36 |  1.603231
      37 |  1.555422
      38 |  1.509039
      39 |  1.464038
      40 |   1.42038
      41 |  1.378024
      42 |  1.336931
      43 |  1.297063
      44 |  1.258384
      45 |  1.220858
      46 |  1.184452
      47 |  1.149131
      48 |  1.114863
      49 |  1.081618
      50 |  1.049363
      51 |  1.018071
      52 |  .9877115
      53 |  .9582575
      54 |  .9296819
      55 |  .9019583
      56 |  .8750616
      57 |  .8489668
      58 |  .8236503
      59 |  .7990887
      60 |  .7752596
      61 |  .7807298
      62 |  .7862386
      63 |  .7917863
      64 |  .7973732
      65 |  .8029994
      66 |  .8086654
      67 |  .8143713
      68 |  .8201176
      69 |  .8259043
      70 |  .8317319
      71 |  .8376006
      72 |  .8435107
      73 |  .8494626
      74 |  .8554564
      75 |  .8614925
      76 |  .8675712
      77 |  .8736928
      78 |  .8798575
      79 |  .8860658
      80 |  .8923179
      81 |  .8986141
      82 |  .9049547
      83 |  .9113401
      84 |  .9177705
      85 |  .9242463
      86 |  .9307678
      87 |  .9373353
      88 |  .9439492
      89 |  .9506097
      90 |  .9573172
      91 |   .964072
      92 |  .9708745
      93 |   .977725
      94 |  .9846238
      95 |  .9915714
      96 |  .9985679
      97 |  1.005614
      98 |  1.012709
      99 |  1.019855
     100 |  1.027051
     101 |  1.034298
     102 |  1.041596
     103 |  1.048946
     104 |  1.056347
     105 |  1.063801
     106 |  1.071307
     107 |  1.078866
     108 |  1.086478
     109 |  1.094145
     110 |  1.101865
---------+----------
   Total |  1.120931
--------------------

. 
. * graph of mortality compared to period life-table in MEPS
. #d ;
delimiter now ;
. twoway (line mx age if age<84, sort lpattern(solid)) (line pmx age if age<84,
> sort lpattern(dash))
> (line dead age if age<84,sort lpattern(dot))
>         , 
>         xtitle("age of respondent")
>         ytitle("") $fig
>         xlabel(25(5)85, labsize(small))
>         title("one-year mortality rate")
>         legend(label(1 "period mx") label(2 "cohort mx") label(3 "MEPS-NHIS m
> x"));

. #d cr
delimiter now cr
. graph export figures/mortality-comparison.eps, as(eps) replace
(file figures/mortality-comparison.eps written in EPS format)

. 
. * intrapolation of adjustment factor
. twoway (line ppi age, sort) (line pi age, sort)

.         svmat pimat

.         keep pimat

.         outsheet using params/input/adjustdead.csv, replace comma nonames nol
> abel

. restore

. 
. * data on obesity and smoking
. preserve

.         gen age2 = age*age

.         char byr_c[omit] 4

.         xi: reg obese age i.byr_c
i.byr_c           _Ibyr_c_1-7         (naturally coded; _Ibyr_c_4 omitted)

      Source |       SS           df       MS      Number of obs   =    39,923
-------------+----------------------------------   F(7, 39915)     =     33.04
       Model |  46.2140356         7  6.60200508   Prob > F        =    0.0000
    Residual |  7975.57766    39,915  .199814046   R-squared       =    0.0058
-------------+----------------------------------   Adj R-squared   =    0.0056
       Total |   8021.7917    39,922  .200936619   Root MSE        =    .44701

------------------------------------------------------------------------------
       obese |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         age |   .0039836   .0005588     7.13   0.000     .0028884    .0050788
   _Ibyr_c_1 |  -.2434806    .029623    -8.22   0.000    -.3015424   -.1854187
   _Ibyr_c_2 |   -.145706   .0135342   -10.77   0.000    -.1722332   -.1191787
   _Ibyr_c_3 |  -.0680167   .0130166    -5.23   0.000    -.0935296   -.0425038
   _Ibyr_c_5 |   .0599457   .0097044     6.18   0.000     .0409248    .0789667
   _Ibyr_c_6 |   .0855374   .0133891     6.39   0.000     .0592944    .1117804
   _Ibyr_c_7 |   .1050995   .0190031     5.53   0.000     .0678531     .142346
       _cons |   .0351188   .0358581     0.98   0.327     -.035164    .1054016
------------------------------------------------------------------------------

.         matrix b = e(b)

.         matrix bcons = b[1,"_cons"]

.         matrix bage = b[1,"age"]

.         gen pobese = bage[1,1]*age + bcons[1,1] 

.         xi: reg smokev age i.byr_c
i.byr_c           _Ibyr_c_1-7         (naturally coded; _Ibyr_c_4 omitted)

      Source |       SS           df       MS      Number of obs   =    20,015
-------------+----------------------------------   F(7, 20007)     =    127.97
       Model |  213.188248         7   30.455464   Prob > F        =    0.0000
    Residual |   4761.2842    20,007  .237980917   R-squared       =    0.0429
-------------+----------------------------------   Adj R-squared   =    0.0425
       Total |  4974.47245    20,014  .248549638   Root MSE        =    .48783

------------------------------------------------------------------------------
      smokev |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         age |   .0024578   .0008318     2.95   0.003     .0008275    .0040882
   _Ibyr_c_1 |  -.1008451   .0357521    -2.82   0.005    -.1709221   -.0307681
   _Ibyr_c_2 |  -.0059109   .0194399    -0.30   0.761    -.0440148    .0321929
   _Ibyr_c_3 |  -.0093276    .018868    -0.49   0.621    -.0463104    .0276551
   _Ibyr_c_5 |  -.0498326   .0147057    -3.39   0.001    -.0786569   -.0210083
   _Ibyr_c_6 |  -.1267351   .0202562    -6.26   0.000    -.1664389   -.0870313
   _Ibyr_c_7 |  -.1747157   .0281921    -6.20   0.000    -.2299745   -.1194568
       _cons |   .5094983   .0530637     9.60   0.000     .4054891    .6135075
------------------------------------------------------------------------------

.         matrix b = e(b)

.         matrix bcons = b[1,"_cons"]

.         matrix bage = b[1,"age"]

.         gen psmoke = bage[1,1]*age + bcons[1,1]         

.         collapse psmoke pobese smokev obese, by(age)    

.         local newobs = _N + 25

.         set obs `newobs'
number of observations (_N) was 86, now 111

.         replace age = age[_n-1]+1 if age[_n]==.
(25 real changes made)

.         replace psmoke = psmoke[_n-1] if psmoke==.
(25 real changes made)

.         replace pobese = pobese[_n-1] if pobese==.              
(25 real changes made)

.         #d ;
delimiter now ;
.         twoway (scatter obese age ) (line pobese age ), name(obese) $fig;

.                 graph export figures/risk-obese.eps, as(eps) replace;
(file figures/risk-obese.eps written in EPS format)

.         twoway (scatter smokev age ) (line psmoke age), name(smoke) $fig;

.         graph export figures/risk-smoke.eps, as(eps) replace;
(file figures/risk-smoke.eps written in EPS format)

.         #d cr           
delimiter now cr
.         
.         keep psmoke pobese

.         order psmoke pobese

.         outsheet using params/input/risk.csv, replace comma nonames nolabel

. restore

. 
. exit

end of do-file


. 
. * obtain auxiliary parameters and initial sample

. do do/auxiliary32.do

. ***********************************************************
. * Estimation of Auxiliary Processes
. * Fonseca, Michaud, Kapteyn and Galama (2015)
. * version 29: june 2015
. * creates parameter files:
. * - params/in/earnings.csv
. * - params/in/otherinc.csv
. * - params/in/initsample.csv
. ***********************************************************
. 
. ***************************************************
. * Step 1: Earnings process PSID                   *
. ***************************************************
. 
. * minimum distance function for (b = (rho, sige))               
. mata 
------------------------------------------------- mata (type end to exit) -----
:   void mdfunc(todo, b, mCovData, func, g, H)
>   {
>         // map parameters
>         T = cols(mCovData)
>         rho= tanh(b[1,1])
>         sige = exp(b[1,2])
>         sigv = exp(b[1,3])
>         // Get "True" Covariance Matrix
>         mCovTrue = J(T,T,.)
>         for (r = 1; r<=T; ++r) {
>                 for (c=1; c<=T; ++c) {
>                         mCovTrue[r,c] = (r==c)*sigv + (rho^abs(r-c))*sige/(1-
> rho^2)
> 
>                 }
>         } 
>         d = vech(mCovData :- mCovTrue)          
>         func = d'*d
>   }
note: argument todo unused
note: argument g unused
note: argument H unused

: end
-------------------------------------------------------------------------------

. 
. preserve

.                 use $src/data/psid_extract.dta, clear
(Fonseca, Michaud, Kapteyn and Galama (2017) - PSID extract, ver32)

.                 * sample selection
.                 *keep if rwork==1
.                 keep if logriearn!=.
(11,695 observations deleted)

.                 keep if rage>=25&rage<=65
(3,409 observations deleted)

.                 keep if year<=1997
(12,629 observations deleted)

.                 gen rage2 = rage^2

.                 sort hhidpn year

.                 * declare as panel
.                 bysort hhidpn: gen t = _n

.                 bysort hhidpn: gen T = _N 

.                 bysort hhidpn: gen last = t==T

.                 tsset hhidpn t
       panel variable:  hhidpn (unbalanced)
        time variable:  t, 1 to 14
                delta:  1 unit

.                 xtdes

  hhidpn:  4001, 4003, ..., 6478046                          n =       4100
       t:  1, 2, ..., 14                                     T =         14
           Delta(t) = 1 unit
           Span(t)  = 14 periods
           (hhidpn*t uniquely identifies each observation)

Distribution of T_i:   min      5%     25%       50%       75%     95%     max
                         1       1       4         8        13      14      14

     Freq.  Percent    Cum. |  Pattern
 ---------------------------+----------------
      866     21.12   21.12 |  11111111111111
      395      9.63   30.76 |  1.............
      377      9.20   39.95 |  1111..........
      314      7.66   47.61 |  11............
      294      7.17   54.78 |  111...........
      273      6.66   61.44 |  1111111111111.
      241      5.88   67.32 |  11111.........
      229      5.59   72.90 |  111111111.....
      214      5.22   78.12 |  1111111111....
      897     21.88  100.00 | (other patterns)
 ---------------------------+----------------
     4100    100.00         |  XXXXXXXXXXXXXX

.                 tab T

          T |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        395        1.22        1.22
          2 |        628        1.94        3.15
          3 |        882        2.72        5.87
          4 |      1,508        4.65       10.52
          5 |      1,205        3.71       14.23
          6 |      1,140        3.51       17.75
          7 |      1,169        3.60       21.35
          8 |      1,336        4.12       25.47
          9 |      2,061        6.35       31.82
         10 |      2,140        6.60       38.42
         11 |      1,848        5.70       44.11
         12 |      2,460        7.58       51.69
         13 |      3,549       10.94       62.63
         14 |     12,124       37.37      100.00
------------+-----------------------------------
      Total |     32,445      100.00

.                 table rage rshlt3, content(mean riearn)

-------------------------------------------------
age of    |
individua |         health status (3 cat)        
l         |         bad         good    excellent
----------+--------------------------------------
       25 |  28875.7704  26628.17448  31463.65458
       26 | 25865.10878  28365.21944  33060.63166
       27 | 22923.00396  33521.55664  36562.12501
       28 |  23878.3884  33554.18679  38955.49552
       29 |  26830.7798  38951.59297  41761.49127
       30 | 30609.07666  40490.91298  43833.42929
       31 | 31931.28618  40236.75441  46276.22402
       32 | 33838.62425  42982.83867  48312.76285
       33 | 33564.68233  42733.99917  50661.40016
       34 | 43332.90883  44570.83946  52402.83098
       35 | 32235.70338  46317.20758  54270.39716
       36 | 32893.48663  46831.49476  56175.62547
       37 | 37496.21736  48104.88421  58350.38775
       38 |  33280.6771    44425.075  60600.56177
       39 | 41179.97625  45467.29359  60289.83955
       40 | 35263.04072  48431.68352  61966.82867
       41 |  37329.9979  45857.69033  63353.72463
       42 | 41487.99969   46463.7738    66254.984
       43 | 39236.81674   50399.4586  65014.00275
       44 | 39944.83727  50866.30874  68161.54663
       45 | 36399.86907  50112.21137  66691.96164
       46 | 39452.62168   52796.8695  69105.02101
       47 | 35897.01927  51865.41734  68793.37999
       48 | 43377.87995  52998.18145  71757.88002
       49 | 50067.08119  50743.22602  70196.84588
       50 | 40553.25402  53192.86218   68272.4561
       51 | 38701.60455  52996.07345   67764.2844
       52 |  39020.5645  55404.48109  69752.09547
       53 | 40414.99324  51490.97145  72288.89073
       54 | 38856.26269  51254.84853   63949.1722
       55 | 41754.39162  52857.38383  65257.00377
       56 | 41715.47175  50990.28961  65821.31168
       57 | 35443.80493   49087.7767   66704.7575
       58 | 41241.89926  51599.40991  70002.14268
       59 | 38805.15138  48677.67454   70859.7486
       60 | 43754.03184  47051.71887  67360.46195
       61 | 36478.57422  51748.71186  61307.54466
       62 | 43842.87015  47249.70146  62749.88727
       63 | 37235.38688  47675.77339  58618.63225
       64 | 49502.46458  42565.82274  62119.50678
       65 | 60312.03386  42359.56901  52948.95327
-------------------------------------------------

.                 keep if T>=3
(1,023 observations deleted)

.                 * deterministic component of earnings           
.                 xtreg logriearn rage rage2, robust fe

Fixed-effects (within) regression               Number of obs     =     31,422
Group variable: hhidpn                          Number of groups  =      3,391

R-sq:                                           Obs per group:
     within  = 0.0623                                         min =          3
     between = 0.0631                                         avg =        9.3
     overall = 0.0594                                         max =         14

                                                F(2,3390)         =     284.92
corr(u_i, Xb)  = 0.0009                         Prob > F          =     0.0000

                             (Std. Err. adjusted for 3,391 clusters in hhidpn)
------------------------------------------------------------------------------
             |               Robust
   logriearn |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        rage |   .1231835   .0056149    21.94   0.000     .1121746    .1341924
       rage2 |  -.0013562   .0000684   -19.82   0.000    -.0014904    -.001222
       _cons |   8.049788   .1125996    71.49   0.000     7.829018    8.270557
-------------+----------------------------------------------------------------
     sigma_u |  .54814854
     sigma_e |  .36371006
         rho |  .69431669   (fraction of variance due to u_i)
------------------------------------------------------------------------------

.                 matrix b = e(b)

.                 predict ue, ue  

.                 predict e, e

.                 * get average fixed effect for those born 1935-45
.                 predict u, u

.                 qui sum u if rbyr_c==3

.                 local mu = r(mean)

.                 matrix b[1,3] = b[1,3] + `mu'           

.                 * smearing for retransformation
.                         gen plogriearn = b[1,3] + b[1,1]*rage + b[1,2]*rage2

.                         gen priearn = exp(plogriearn) 

.                         sum riearn [aw=wgid_cs]

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
      riearn |  20,093  750743.193    54392.12   37698.53   5011.201   349697.9

.                         local mriearn = r(mean)

.                         sum priearn [aw=wgid_cs] 

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
     priearn |  20,093  750743.193    45833.02   6813.706   30333.86   53369.64

.                         local mpriearn = r(mean)

.                         local smear = log(`mriearn'/`mpriearn')

.                         matrix b[1,3] = b[1,3] + `smear'

.                         replace priearn = exp(`smear')*priearn
(31,422 real changes made)

.                         matrix list b   

b[1,3]
          rage       rage2       _cons
y1   .12318351  -.00135621   8.2592765

.                         sum priearn riearn

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
     priearn |     31,422    54232.97    8011.131   35998.56   63336.17
      riearn |     31,422    53193.09    37056.46   5011.201   349697.9

.                 * collect residuals     for minimum distance (estimation of c
> ovariance)
.                 di _N
31422

.                 forvalues t = 1/12 {
  2.                         by hhidpn: gen ue_`t' = ue[`t'] 
  3.                 }
(882 missing values generated)
(2,390 missing values generated)
(3,595 missing values generated)
(4,735 missing values generated)
(5,904 missing values generated)
(7,240 missing values generated)
(9,301 missing values generated)
(11,441 missing values generated)
(13,289 missing values generated)

.                 keep if last==1
(28,031 observations deleted)

.                 di _N
3391

.                 corr ue_1-ue_12, cov
(obs=1,344)

             |     ue_1     ue_2     ue_3     ue_4     ue_5     ue_6     ue_7
-------------+---------------------------------------------------------------
        ue_1 |  .300266
        ue_2 |  .227204  .288474
        ue_3 |  .200633  .224178  .289167
        ue_4 |  .197532  .210094  .234698  .307253
        ue_5 |  .192412  .207742  .212706  .250131  .301739
        ue_6 |  .190145  .201556   .20501  .236742  .255431  .325945
        ue_7 |  .179402  .198387  .197894  .228263  .245778  .268689  .325182
        ue_8 |   .18166  .195802  .199891  .226091  .240666  .259358    .2727
        ue_9 |  .169952  .187513  .193615  .217092  .224493  .235356   .25274
       ue_10 |  .160804  .178298  .183843  .202189  .213811  .226044   .23679
       ue_11 |  .168687  .186201  .191252  .211675  .219168  .233293  .242583
       ue_12 |  .162163  .181815  .177642   .19556  .204945  .215603  .230421

             |     ue_8     ue_9    ue_10    ue_11    ue_12
-------------+---------------------------------------------
        ue_8 |  .344866
        ue_9 |  .279394   .34487
       ue_10 |  .263304  .270584  .372359
       ue_11 |  .265744  .274109  .285938  .383326
       ue_12 |  .250442  .253812   .26343   .29706  .398524


.                 matrix mCov = r(C)

.                 * optimization for estimating covariance
.                 mata {
>                         // covariance matrix from data
>                         mCovData = st_matrix("mCov")
>                         D = optimize_init()
>                         optimize_init_which(D , "min")
>                         optimize_init_evaluator(D, &mdfunc())
>                         optimize_init_evaluatortype(D, "d0")
>                         optimize_init_technique(D, "bfgs")
>                         optimize_init_argument(D, 1, mCovData)  
>                         // Starting values
>                         b0 = (0.9,log(0.03),log(0.08))
>                         optimize_init_params(D,b0)
>                         // Optimize
>                         b = optimize(D)
>                         Vb = optimize_result_V(D)
>                         //Retrieve parameters
>                         b[1,1] = tanh(b[1,1])
>                         b[1,2] = exp(b[1,2])
>                         b[1,3] = exp(b[1,3])
>                         st_matrix("cb",b)
> 
>                 }
Iteration 0:   f(p) =  3.1337276  
Iteration 1:   f(p) =  .79520994  
Iteration 2:   f(p) =  .79520994  (backed up)
Iteration 3:   f(p) =  .04877527  
Iteration 4:   f(p) =  .03974616  
Iteration 5:   f(p) =   .0397171  
Iteration 6:   f(p) =  .03953168  
Iteration 7:   f(p) =  .03952687  
Iteration 8:   f(p) =  .03952685  
Iteration 9:   f(p) =  .03952685  
Iteration 10:  f(p) =  .03952685  
Iteration 11:  f(p) =  .03952682  
Iteration 12:  f(p) =  .03952375  
Iteration 13:  f(p) =  .03948776  
Iteration 14:  f(p) =  .03940136  
Iteration 15:  f(p) =  .03939185  
Iteration 16:  f(p) =  .03939181  

.         
.                 * prepare for posting
.                 matrix b = (b,cb)'

.                 matrix rownames b = age age2 constant rho sige sigv

.         restore

. 
. di "parameters of earnings process"
parameters of earnings process

. 
. matrix list b

b[6,1]
                  y1
     age   .12318351
    age2  -.00135621
constant   8.2592765
     rho    .9536541
    sige    .0243195
    sigv    .0632374

. 
. 
. * prepare graph of average earnings profiles with 95% band
. preserve

.         graph drop _all

.         use $src/data/psid_extract.dta, clear
(Fonseca, Michaud, Kapteyn and Galama (2017) - PSID extract, ver32)

.         keep if logriearn!=.
(11,695 observations deleted)

.         keep if rage>=25&rage<=65
(3,409 observations deleted)

.         keep if year<=1997
(12,629 observations deleted)

.         gen priearn = exp(b[1,1]*rage + b[2,1]*rage^2 + b[3,1]) 

.         scalar varu = b[5,1]/(1-b[4,1]^2)

.         di "stationary variance is ", varu
stationary variance is  .26859364

.         gen up_priearn = priearn*exp(sqrt(varu)*2) 

.         gen low_priearn = priearn*exp(-sqrt(varu)*2) 

.         sum priearn low_* up_*

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
     priearn |     32,445    54003.14    8171.537   35998.55   63336.17
 low_priearn |     32,445     19154.2    2898.336   12768.21    22464.5
  up_priearn |     32,445    152255.9    23038.75   101493.9   178569.3

.         
.         collapse (mean) priearn up_priearn low_priearn, by(rage)

.         replace priearn = priearn * 1e-3
(41 real changes made)

.         replace up_priearn = up_priearn * 1e-3
(41 real changes made)

.         replace low_priearn = low_priearn * 1e-3
(41 real changes made)

.         keep if rage<=70
(0 observations deleted)

.         #d ;
delimiter now ;
.         twoway  (line up_priearn rage, lpattern(dash))
>                    (line priearn rage, lpattern(solid))
>                    (line low_priearn rage, lpattern(dash)),
>                    legend(label(1 "+2se") label(2 "mean") label(3 "-2ses") ro
> ws(1) size(small))
>                    xtitle("age of household head") $fig
>                    ytitle("earnings (000)")
>                    xlabel(25(5)70)
>                    ylabel(0(25)200, labsize(small))
>                    name(earnings)
>                    ;

.         #d cr
delimiter now cr
. 
.         graph export figures/earnings.eps, as(eps) replace
(file figures/earnings.eps written in EPS format)

. restore

. 
. * transfer parameters to ascii to be read in fortran
. svmat b

. keep b1

. keep if b1!=.
(55,027 observations deleted)

. outsheet using params/input/earnings.csv, replace comma nonames nolabel

. 
. 
. **************************************
. * Step 2: Spouse earnings + pensions *
. * regression by age, education       *
. * and earnings       (PSID)          *
. **************************************
. preserve

.         graph drop _all

.         use $src/data/psid_extract.dta, clear
(Fonseca, Michaud, Kapteyn and Galama (2017) - PSID extract, ver32)

.         keep if rage>=25 & rage<=84
(2,917 observations deleted)

.         gen rage2 = rage*rage

.         * own income
.         gen own = hissben + riearn      
(269 missing values generated)

.         replace own = . if own>=250000
(526 real changes made, 526 to missing)

.         replace otherinc = . if otherinc>=250000
(55 real changes made, 55 to missing)

.         gen prbyr_c = rbyr_c

.         * instrument
.         ivregress 2sls otherinc (own = rskill) rage rage2 ib3.prbyr_c

Instrumental variables (2SLS) regression          Number of obs   =     53,905
                                                  Wald chi2(8)    =    4252.27
                                                  Prob > chi2     =     0.0000
                                                  R-squared       =          .
                                                  Root MSE        =      23373

------------------------------------------------------------------------------
    otherinc |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         own |   .3254251   .0103301    31.50   0.000     .3051785    .3456716
        rage |   1012.596   73.50822    13.78   0.000     868.5229     1156.67
       rage2 |  -8.667953   .7388425   -11.73   0.000    -10.11606   -7.219848
             |
     prbyr_c |
          1  |   -4242.96   668.3382    -6.35   0.000    -5552.879   -2933.041
          2  |  -1730.389   467.9504    -3.70   0.000    -2647.555   -813.2226
          4  |   1409.253   365.0549     3.86   0.000     693.7588    2124.748
          5  |   3171.313   451.8997     7.02   0.000     2285.605     4057.02
          6  |   5440.042   582.3726     9.34   0.000     4298.612    6581.471
             |
       _cons |  -24887.67    1726.74   -14.41   0.000    -28272.02   -21503.33
------------------------------------------------------------------------------
Instrumented:  own
Instruments:   rage rage2 1.prbyr_c 2.prbyr_c 4.prbyr_c 5.prbyr_c 6.prbyr_c
               rskill

.         replace prbyr_c = 3
(49,506 real changes made)

.         matrix beta = e(b)

.         matrix beta = (beta[1,1],beta[1,2], beta[1,3], beta[1,10])'     

.                 gen potherinc = beta[4,1] + beta[1,1]*own + beta[2,1]*rage + 
> beta[3,1]*rage2
(795 missing values generated)

.                 collapse (mean) potherinc (p5) potherinc_5=potherinc (p95) po
> therinc_95=potherinc, by(rage)

.                 replace  potherinc_5 = max(potherinc_5,0)
(9 real changes made)

.                 replace potherinc_95 = potherinc_95 * 1.e-3
(60 real changes made)

.                 replace potherinc = potherinc * 1.e-3
(60 real changes made)

.                 replace potherinc_5 = potherinc_5 * 1.e-3
(51 real changes made)

.                 #d ;
delimiter now ;
.                 twoway  (line potherinc_95 rage if rage<=85, lpattern(dash))
>                    (line potherinc rage if rage<=85, lpattern(solid))
>                    (line potherinc_5 rage if rage<=85, lpattern(dash)),
>                    legend(label(1 "95th pct") label(2 "mean") label(3 "5 pct"
> ) rows(1) size(small))
>                    xtitle("age of household head") $fig
>                    xlabel(25(5)85)
>                    ytitle("other income (000)") 
>                    ylabel(0(10)50, labsize(small))
>                    name(otherinc)
>                    ;

.                 #d cr
delimiter now cr
.         graph export figures/otherincome.eps, as(eps) replace
(file figures/otherincome.eps written in EPS format)

.         svmat beta

.         keep if beta1!=.
(56 observations deleted)

.         keep beta1

.         list

     +-----------+
     |     beta1 |
     |-----------|
  1. |  .3254251 |
  2. |  1012.596 |
  3. | -8.667953 |
  4. | -24887.67 |
     +-----------+

.         outsheet using params/input/otherinc.csv, replace comma nonames nolab
> el

. restore

. 
. **************************************
. * Step 3: fraction with spouse *
. * regression by age, education       *
. * and earnings       (PSID)          *
. **************************************
. preserve

.         graph drop _all

.         use $src/data/psid_extract.dta, clear
(Fonseca, Michaud, Kapteyn and Galama (2017) - PSID extract, ver32)

.         keep if rage>=25 & rage<=100
(2,250 observations deleted)

.         * only use data prior to age 55, will impute from reg to older ages
.         gen rage2 = rage*rage

.         gen rage3 = rage*rage*rage

.         gen rage4 = rage*rage*rage*rage

.         gen rage5 = rage4*rage

.         gen prbyr_c = rbyr_c

.         * regression
.         regress spouse rage rage2 rage3 rage4 rage5 ib3.prbyr_c

      Source |       SS           df       MS      Number of obs   =    57,922
-------------+----------------------------------   F(10, 57911)    =    181.45
       Model |  232.132063        10  23.2132063   Prob > F        =    0.0000
    Residual |  7408.66599    57,911   .12793193   R-squared       =    0.0304
-------------+----------------------------------   Adj R-squared   =    0.0302
       Total |  7640.79806    57,921  .131917578   Root MSE        =    .35768

------------------------------------------------------------------------------
      spouse |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        rage |   .3897523   .0431753     9.03   0.000     .3051285    .4743762
       rage2 |   -.013504   .0017145    -7.88   0.000    -.0168645   -.0101435
       rage3 |   .0002262   .0000327     6.92   0.000     .0001622    .0002903
       rage4 |  -1.83e-06   3.00e-07    -6.10   0.000    -2.41e-06   -1.24e-06
       rage5 |   5.61e-09   1.06e-09     5.30   0.000     3.53e-09    7.69e-09
             |
     prbyr_c |
          1  |   .0471441   .0103614     4.55   0.000     .0268357    .0674524
          2  |   .0579218   .0074937     7.73   0.000      .043234    .0726095
          4  |  -.0114944   .0057369    -2.00   0.045    -.0227387   -.0002502
          5  |  -.0180268   .0069541    -2.59   0.010    -.0316569   -.0043968
          6  |  -.0500692   .0085776    -5.84   0.000    -.0668813   -.0332571
             |
       _cons |  -3.473717   .4170338    -8.33   0.000    -4.291105   -2.656329
------------------------------------------------------------------------------

.         replace prbyr_c = 3
(50,173 real changes made)

.         matrix s = e(b)

.         matrix beta = (s[1,1],s[1,2], s[1,3], s[1,4], s[1,5], s[1,12])

.                 #d ;
delimiter now ;
.                 gen pspouse = beta[1,6] + beta[1,1]*rage + beta[1,2]*rage2 + 
> beta[1,3]*rage3 
>                         + beta[1,4]*rage4 + beta[1,5]*rage5;

.                 #d cr
delimiter now cr
.                 collapse (mean) pspouse, by(rage)

.                 #d ;
delimiter now ;
.                 twoway  
>                    (line pspouse rage if rage<=100, lpattern(solid)),
>                    legend(label(1 "mean") rows(1) size(small))
>                    xtitle("age of household head")
>                    xlabel(25(5)85) $fig
>                    title("fraction with spouse") 
>                    ylabel(0(0.1)1, labsize(small))
>                    name(spouse)
>                    ;

.                 #d cr
delimiter now cr
.         graph export figures/spouse.eps, as(eps) replace
(file figures/spouse.eps written in EPS format)

.         matrix beta = beta'

.         svmat beta

.         keep if beta1!=.
(68 observations deleted)

.         keep beta1

.         list

     +-----------+
     |     beta1 |
     |-----------|
  1. |  .3897523 |
  2. |  -.013504 |
  3. |  .0002262 |
  4. | -1.83e-06 |
  5. |  5.61e-09 |
     |-----------|
  6. | -3.473717 |
     +-----------+

.         outsheet using params/input/spouse.csv, replace comma nonames nolabel

. restore

. 
. **************************************
. * Step 3: Insurance status 
. * in HRS (for cohorts borh 1935-1945)
. * assume coverage constant with age
. **************************************
. preserve

.         use $src/raw/hrs/rndhrsg_all.dta, clear

.         *borh 1935-1945
.         keep if rabyear>=1935&rabyear<=1945
(86,841 observations deleted)

.         * 50 to 55 years old
.         keep if ragey_b>=50&ragey_b<=55
(36,785 observations deleted)

.         * keep males
.         keep if ragender==1
(7,919 observations deleted)

.         
.         * get insurance status  
.         egen insured = anymatch(rcovr rcovs), values(1)

.         replace insured = 2 if insured==1&rcovrt==1
(2,053 real changes made)

.         label def insured 0 "no coverage" 1 "tied coverage" 2 "retiree covera
> ge"

.         label values insured insured

.         replace insured = . if rhigov==1
(622 real changes made, 622 to missing)

.         
.         * get DB pension
.         egen dbpen = anymatch(rptyp*), values(1)

.         
.         gen rskill=1 if (raeduc==4|raeduc==5)
(3,044 missing values generated)

.         replace rskill=0 if (raeduc==1|raeduc==2|raeduc==3)
(3,034 real changes made)

. 
.         * how many have db (for referee)
.         tabstat dbpen [aw=rwtresp], by(insured)

Summary for variables: dbpen
     by categories of: insured (rcovr rcovs == 1)

         insured |      mean
-----------------+----------
     no coverage |  .0374827
   tied coverage |  .2908699
retiree coverage |  .5222616
-----------------+----------
           Total |  .3306568
----------------------------

.         
.         * obtaining the fractions of each type
.         tab insured [aw=rwtresp], nofreq matcell(data)

.         matrix list data

data[3,1]
           c1
r1  943.15865
r2  1787.5324
r3  1814.3089

.         scalar total = data[1,1]+data[2,1]+data[3,1]

.         matrix data[1,1] = data[1,1]/total

.         matrix data[2,1] = data[2,1]/total

.         matrix data[3,1] = data[3,1]/total

.                 
.         matrix data[2,1] = data[2,1] + data[1,1]

.         matrix data[3,1] = 1

.         
.         * data for using in initial conditions
.         matrix rownames data = no tied retiree

.         matrix list data

data[3,1]
                c1
     no  .20751566
   tied  .60081212
retiree          1

. restore

. 
. 
. **********************************************
. * Step 5: Initial Distribution of 
. * (health,educ,assets,earn,
. * aime,insurance), PSID
. **********************************************
. preserve

.         use $src/data/psid_extract.dta, clear
(Fonseca, Michaud, Kapteyn and Galama (2017) - PSID extract, ver32)

.         * use age 24 to 28 to boost initial sample
.         keep if rage>=24&rage<=28
(53,839 observations deleted)

.         * variables
.         keep logriearn ass rshlt3

.         * rescale rshlt
.         replace rshlt3 = rshlt3 + 1     
(6,339 real changes made)

.         * make sure none missing
.         reg logriearn ass rshlt3

      Source |       SS           df       MS      Number of obs   =     2,598
-------------+----------------------------------   F(2, 2595)      =     90.04
       Model |  54.3230387         2  27.1615193   Prob > F        =    0.0000
    Residual |  782.821356     2,595  .301665263   R-squared       =    0.0649
-------------+----------------------------------   Adj R-squared   =    0.0642
       Total |  837.144395     2,597  .322350556   Root MSE        =    .54924

------------------------------------------------------------------------------
   logriearn |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         ass |   1.03e-06   9.81e-08    10.49   0.000     8.36e-07    1.22e-06
      rshlt3 |    .171012   .0216783     7.89   0.000     .1285035    .2135204
       _cons |   9.615858   .0820834   117.15   0.000     9.454902    9.776813
------------------------------------------------------------------------------

.         gen miss = e(sample)==0

.         drop if miss==1
(3,741 observations deleted)

.         * dummy education var 
.         gen educ = 1    

.         
.         * assets (only positive)
.         replace ass = 0 if ass<=0
(508 real changes made)

.         
.         * draw insurance status using HRS computations
.         gen u = uniform()

.         gen insured = .
(2,598 missing values generated)

.         replace insured = 1 if u<=data[1,1]&insured==.
(525 real changes made)

.         replace insured = 2 if u>data[1,1]&u<=data[2,1]&insured==.
(1,053 real changes made)

.         replace insured = 3 if u>data[2,1]&u<=data[3,1]&insured==.
(1,020 real changes made)

.         drop u miss

.         tab insured     

    insured |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        525       20.21       20.21
          2 |      1,053       40.53       60.74
          3 |      1,020       39.26      100.00
------------+-----------------------------------
      Total |      2,598      100.00

.         tab insured if insured!=1

    insured |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |      1,053       50.80       50.80
          3 |      1,020       49.20      100.00
------------+-----------------------------------
      Total |      2,073      100.00

.         * replicate twice and sample with replacement 10000 for initial sampl
> e  
.         expand 10
(23,382 observations created)

.         bsample 10000

.         * order for reading in fortran
.         tabstat logriearn, by(rshlt3)

Summary for variables: logriearn
     by categories of: rshlt3 (health status (3 cat))

   rshlt3 |      mean
----------+----------
     good |  9.950215
excellent |  10.15468
        4 |  10.34365
----------+----------
    Total |  10.29796
---------------------

.         order logriearn educ insured ass rshlt3

.         * save file
.         save $src/data/initsample.dta, replace
file ~/cedia/Projets/rise-data/data/initsample.dta saved

.         * transfer dataset to ascii (to be read in Fortran)
.         outsheet using params/input/initsample.csv, replace comma nonames nol
> abel

. restore

. 
. **********************************
. * Step 6: Insurance co-payments
. * from MEPS
. **********************************
. preserve

.         use $src/data/meps-nhis_wide_extract.dta, clear
(MEPS1996-2008)

.         keep if age>=25&age<=84
(0 observations deleted)

.         keep if male==1
(0 observations deleted)

.         replace mepsexp = . if mepsexp>100000
(0 real changes made)

.         * how much paid out-of-pocket
.         gen copay = mepsslf/mepsexp
(12,740 missing values generated)

.         replace copay = 1 if copay>1&copay!=.   
(0 real changes made)

.         label def ins 1 "private" 2 "public" 3 "none"

.         label values inscov ins

.         matrix results = J(4,1,.)

.         sum copay [aw=perwt] if age<65&inscov==1, d

                            copay
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%     .0007762              0
10%      .029654              0       Obs              26,364
25%     .1110184              0       Sum of Wgt.   318124901

50%     .2564323                      Mean           .3455745
                        Largest       Std. Dev.       .298114
75%     .5018227              1
90%     .8745762              1       Variance        .088872
95%            1              1       Skewness       .9124054
99%            1              1       Kurtosis       2.753393

.         matrix results[1,1] = r(p50)

.         sum copay [aw=perwt] if age<65&inscov==2, d

                            copay
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%            0              0
10%            0              0       Obs               3,031
25%     .0115259              0       Sum of Wgt.  25710750.1

50%     .0802282                      Mean           .2304414
                        Largest       Std. Dev.      .3023895
75%     .3404711              1
90%     .7720588              1       Variance       .0914394
95%     .9757314              1       Skewness       1.382989
99%            1              1       Kurtosis       3.654412

.         matrix results[2,1] = r(p50)

.         sum copay [aw=perwt] if age<65&inscov==3, d

                            copay
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%            0              0
10%     .0594406              0       Obs               4,476
25%     .4396166              0       Sum of Wgt.  42645338.1

50%            1                      Mean           .7378131
                        Largest       Std. Dev.      .3691511
75%            1              1
90%            1              1       Variance       .1362725
95%            1              1       Skewness      -.9998679
99%            1              1       Kurtosis       2.322752

.         matrix results[3,1] = r(p50)

.         sum copay [aw=perwt] if age>=65&inscov==2, d

                            copay
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%     .0035545              0
10%     .0140845              0       Obs               3,361
25%     .0672748              0       Sum of Wgt.  31801086.4

50%     .2145737                      Mean             .31463
                        Largest       Std. Dev.      .2981224
75%     .4939976              1
90%     .8322034              1       Variance        .088877
95%     .9500713              1       Skewness       .9296602
99%            1              1       Kurtosis       2.686365

.         matrix results[4,1] = r(p50)

.         svmat results

.         keep results1

.         keep if results1!=.
(55,003 observations deleted)

.         list

     +----------+
     | results1 |
     |----------|
  1. | .2564323 |
  2. | .0802282 |
  3. |        1 |
  4. | .2145737 |
     +----------+

.         outsheet using params/input/coinsurance.csv, replace comma nonames no
> label      

. restore

. 
. exit

end of do-file


. 
. * obtain estimates for AIME

. do do/aime32.do

. * AIME replacement rates (as in French)
. insheet par using params/input/earnings.csv, clear
(1 var, 6 obs)

. 
. * send pars to matrices
. mkmat par, matrix(par)

. matrix par = par'

. matrix colnames par = age age2 one rho sige sigv

. matrix list par

par[1,6]
           age       age2        one        rho       sige       sigv
par   .1231835  -.0013562  8.2592764  .95365411   .0243195   .0632374

. 
. * make space for panel
. set obs 5000
number of observations (_N) was 6, now 5,000

. 
. * horizon T
. global T = 2010

. 
. * age at start
. gen age = 20

. gen age2 = age*age

. 
. * growth rate in economy
. global g = 0.0

. 
. * initial eps
. gen eps = rnormal(0,par[1,5]/(1-par[1,4]^2)) 

. 
. forvalues t=1960/$T {
  2.         qui gen earn`t' = .
  3.                 qui replace eps = par[1,4]*eps + sqrt(par[1,5])*rnormal() 
  4.                 qui replace earn`t' = exp(par[1,1]*age + par[1,2]*age2 + p
> ar[1,3] + eps)
  5.                 qui replace earn`t' = min(earn`t',98500)
  6.         qui replace age = age+1
  7.         qui replace age2 = age*age
  8. }

. 
. gen dearn = earn2004 - earn2003

. 
. // Compute highest 35 years at each year
. mata: 
------------------------------------------------- mata (type end to exit) -----
:         st_view(W=.,.,tokens("earn*"))

:         N = rows(W);

:         T = cols(W);

:         TrueA = J(N,T,.);

:         ApprA = J(N,T,.);

:         alpha = J(N,T,0);

:         W = W:/12;

:         for (i=1;i<=N;i++) {
>                 for (t=1;t<=T;t++) {
>                         if (t<35) {
>                                 cap = t
>                                 TrueA[i,t] = sum(W[i,1::t])/35;
>                         }
>                         else {
>                         
>                                 if (W[i,t]>min(W[i,1::t-1])) {
>                                         //(W[i,t],min(W[i,1::t-1]))
>                                 }       
>                                 cap = 35
>                                 x = sort(W[i,1::t]',-1);
>                                 //x
>                                 TrueA[i,t] = sum(x[1::cap])/35;
>                                                 
>                         }               
>                 
>                         
>                         if (t==1) {
>                                 ApprA[i,t] = W[i,t]/35;
>                         }
>                         else {
>                                 ApprA[i,t] = (1+$g):*ApprA[i,t-1] + (W[i,t] -
>  (1+$g):*ApprA[i,t-1])/35;
>                         }
>                         if (t>1) {
>                                 if (TrueA[i,t]<=TrueA[i,t-1]) { 
>                                         alpha[i,t] = 1 
>                                 }
>                         }
> 
>                 }
>                         
>         }

:         mTrueA = mean(TrueA)

:         mApprA = mean(ApprA)    

:         alpha = mean(alpha[1::N,36::51])

:         (alpha')
            1
     +---------+
   1 |  .0278  |
   2 |  .0552  |
   3 |  .0828  |
   4 |  .1222  |
   5 |  .1568  |
   6 |  .2022  |
   7 |  .2512  |
   8 |  .3118  |
   9 |  .3682  |
  10 |   .443  |
  11 |  .5046  |
  12 |  .5746  |
  13 |   .628  |
  14 |  .6776  |
  15 |  .7304  |
  16 |  .7824  |
     +---------+

:         st_matrix("rep",(alpha'))

: 
: end
-------------------------------------------------------------------------------

. 
. preserve

.         svmat rep

.         keep rep1

.         order rep1

.         keep if _n<=16
(4,984 observations deleted)

.         outsheet using params/input/rep.csv, replace comma nonames nolabel

. restore

. 
. gen id = _n

. reshape long earn@, i(id) j(year)
(note: j = 1960 1961 1962 1963 1964 1965 1966 1967 1968 1969 1970 1971 1972 197
> 3 1974 1975 1976 1977 1978 1979 1980 1981 1982 1983 1984 1985 1986 1987 1988 
> 1989 1990 1991 1992 1993 1994 1995 1996 1997 1998 1999 2000 2001 2002 2003 20
> 04 2005 2006 2007 2008 2009 2010)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                     5000   ->  255000
Number of variables                  57   ->       8
j variable (51 values)                    ->   year
xij variables:
         earn1960 earn1961 ... earn2010   ->   earn
-----------------------------------------------------------------------------

. drop age

. 
. gen age = year - 1940

. 
. table age, content(mean earn)

----------------------
      age | mean(earn)
----------+-----------
       20 |    27369.8
       21 |    29433.7
       22 |   31573.46
       23 |   33732.61
       24 |   35956.58
       25 |   38265.75
       26 |   40810.95
       27 |   42957.06
       28 |   45199.27
       29 |   47359.42
       30 |   49326.82
       31 |    51390.3
       32 |   53318.44
       33 |   54979.29
       34 |   56471.08
       35 |   57624.63
       36 |   58994.73
       37 |   60283.06
       38 |    61159.5
       39 |   62125.11
       40 |   63078.14
       41 |   63577.95
       42 |    64209.5
       43 |   64802.41
       44 |    64920.6
       45 |   65035.85
       46 |   65112.58
       47 |   64777.19
       48 |   64415.39
       49 |   63889.59
       50 |   63184.99
       51 |   62533.24
       52 |   61790.22
       53 |    61178.7
       54 |   60111.05
       55 |   58968.19
       56 |   57838.59
       57 |      56528
       58 |    55056.5
       59 |   53579.73
       60 |   51803.23
       61 |   50043.61
       62 |   48022.26
       63 |   46127.42
       64 |   44174.27
       65 |   42118.64
       66 |   40053.75
       67 |   37992.16
       68 |    35857.2
       69 |   33873.88
       70 |   31802.88
----------------------

. 
. exit

end of do-file


. 
. * obtain moments

. do do/moments32.do

. *************************************************
. * Moments used in Estimation (and others)           *
. * Fonseca, Michaud, Kapteyn and Galama (2018)   *
. * Version 32
. * june 2017
. *************************************************
. 
. 
. ***********************************
. * Step 1 PSID
. ***********************************
. 
. preserve 

.         use $src/data/psid_extract.dta, clear
(Fonseca, Michaud, Kapteyn and Galama (2017) - PSID extract, ver32)

.         * sample cuts
.         keep if rage>=35&rage<=84
(18,203 observations deleted)

.         replace ass = 0 if ass<0
(822 real changes made)

.         drop if rshlt3==.
(0 observations deleted)

.         drop if missing(hhidpn)
(0 observations deleted)

. 
.         char rbyr_c[omit] 3

.         char rage[omit] 35

.         * wealth
.         gen pass = .
(41,975 missing values generated)

.         xi: xtreg ass i.rage , fe
i.rage            _Irage_35-84        (naturally coded; _Irage_35 omitted)

Fixed-effects (within) regression               Number of obs     =     17,880
Group variable: hhidpn                          Number of groups  =      4,707

R-sq:                                           Obs per group:
     within  = 0.1018                                         min =          1
     between = 0.0418                                         avg =        3.8
     overall = 0.0585                                         max =          7

                                                F(49,13124)       =      30.37
corr(u_i, Xb)  = -0.1642                        Prob > F          =     0.0000

------------------------------------------------------------------------------
         ass |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   _Irage_36 |   36451.06   14102.42     2.58   0.010     8808.264    64093.85
   _Irage_37 |    36099.6   13061.09     2.76   0.006     10497.97    61701.23
   _Irage_38 |   51264.14   14093.19     3.64   0.000     23639.45    78888.84
   _Irage_39 |   68716.93   13689.27     5.02   0.000     41883.97    95549.88
   _Irage_40 |    85887.9   13028.77     6.59   0.000     60349.62    111426.2
   _Irage_41 |   91734.33   13810.77     6.64   0.000     64663.23    118805.4
   _Irage_42 |   94440.47   13555.98     6.97   0.000     67868.79    121012.1
   _Irage_43 |   110549.8    14178.3     7.80   0.000     82758.24    138341.3
   _Irage_44 |   126047.8    13789.1     9.14   0.000     99019.18    153076.5
   _Irage_45 |   145962.5   13662.41    10.68   0.000     119182.2    172742.8
   _Irage_46 |     157769   13907.08    11.34   0.000     130509.1    185028.9
   _Irage_47 |   170946.7   13926.36    12.28   0.000       143649    198244.4
   _Irage_48 |   169342.1   14327.14    11.82   0.000     141258.8    197425.4
   _Irage_49 |   194346.8   14465.57    13.44   0.000     165992.2    222701.4
   _Irage_50 |   193740.9    14276.4    13.57   0.000     165757.1    221724.7
   _Irage_51 |   219002.2   14772.18    14.83   0.000     190046.6    247957.8
   _Irage_52 |     228485   14596.85    15.65   0.000       199873    257096.9
   _Irage_53 |   260362.9    15341.5    16.97   0.000     230291.3    290434.5
   _Irage_54 |   247180.6   15205.76    16.26   0.000     217375.1    276986.1
   _Irage_55 |   283114.5   15657.17    18.08   0.000     252424.2    313804.8
   _Irage_56 |   260400.8    15706.8    16.58   0.000     229613.2    291188.4
   _Irage_57 |   301984.2   16004.03    18.87   0.000       270614    333354.5
   _Irage_58 |   291965.5   16540.12    17.65   0.000     259544.4    324386.5
   _Irage_59 |   334879.9   17433.42    19.21   0.000     300707.9    369051.9
   _Irage_60 |   343241.4   17776.48    19.31   0.000       308397    378085.9
   _Irage_61 |   321696.1   18350.56    17.53   0.000     285726.3    357665.8
   _Irage_62 |   345076.9   18577.46    18.58   0.000     308662.4    381491.4
   _Irage_63 |   348104.6      18724    18.59   0.000     311402.9    384806.4
   _Irage_64 |   346565.9   19732.78    17.56   0.000     307886.8      385245
   _Irage_65 |   362015.9    19917.2    18.18   0.000     322975.3    401056.5
   _Irage_66 |   385310.2   20355.23    18.93   0.000       345411    425209.4
   _Irage_67 |   396745.1   19356.04    20.50   0.000     358804.5    434685.8
   _Irage_68 |   386127.9    20730.9    18.63   0.000     345492.4    426763.5
   _Irage_69 |     426240   20649.04    20.64   0.000     385764.9    466715.1
   _Irage_70 |   413091.7   21856.69    18.90   0.000     370249.4      455934
   _Irage_71 |   388670.9   21155.39    18.37   0.000     347203.2    430138.5
   _Irage_72 |   389162.5   21206.88    18.35   0.000     347593.9      430731
   _Irage_73 |   435642.3   21446.03    20.31   0.000     393604.9    477679.6
   _Irage_74 |   409477.5   23676.68    17.29   0.000     363067.8    455887.3
   _Irage_75 |   392927.5    22228.3    17.68   0.000     349356.8    436498.2
   _Irage_76 |   419237.3    23971.7    17.49   0.000     372249.3    466225.3
   _Irage_77 |   405100.6   22655.76    17.88   0.000       360692    449509.1
   _Irage_78 |   427452.8   25382.23    16.84   0.000       377700    477205.7
   _Irage_79 |     395122   26066.79    15.16   0.000     344027.3    446216.7
   _Irage_80 |   375522.9   28392.26    13.23   0.000     319869.9    431175.8
   _Irage_81 |   393384.8   29231.86    13.46   0.000     336086.1    450683.5
   _Irage_82 |   397918.4   30616.04    13.00   0.000     337906.6    457930.3
   _Irage_83 |   391055.3    33042.6    11.83   0.000       326287    455823.6
   _Irage_84 |   413802.9   35451.12    11.67   0.000     344313.5    483292.2
       _cons |   52835.96    10767.3     4.91   0.000      31730.5    73941.43
-------------+----------------------------------------------------------------
     sigma_u |  291858.01
     sigma_e |  193547.15
         rho |  .69455307   (fraction of variance due to u_i)
------------------------------------------------------------------------------
F test that all u_i=0: F(4706, 13124) = 7.86                 Prob > F = 0.0000

.         gen insamp = e(sample)

.         matrix beta = e(b)'

.         predict u if insamp, ue
(24,095 missing values generated)

.         qui sum u [aw=wgid_cs] if rbyr_c==3&insamp

.         local mu = r(mean)

.         * compute adjusted prediction
.         matrix bcons = beta["_cons",1]

.         qui sum u [aw=wgid_cs] if insamp

.         qui replace pass = bcons[1,1] + (u - r(mean)) + `mu'  if rage==35&ins
> amp

. 
.         forvalues t = 36(1)84 {
  2.                         matrix bage = beta["_Irage_`t'",1]
  3.                         qui replace pass = (u - r(mean)) +  bage[1,1] + bc
> ons[1,1] + `mu'  if rage==`t'&insamp
  4.         }

.         drop insamp u

.         
.         * pass is the adjusted wealth variable
. 
.         * work
.         replace rwork = . if rage>69
(4,879 real changes made, 4,879 to missing)

.         gen pwork = .
(41,975 missing values generated)

.         foreach h of numlist 1/3 {
  2.                 qui xi: reg rwork i.rage i.rbyr_c [aw=wgid_cs] if rshlt3==
> `h'
  3.                 gen insamp = e(sample)
  4.                 predict u if rshlt3==`h'&insamp, res
  5.                 matrix beta = e(b)'
  6.             matrix bcons = beta["_cons",1]
  7.             replace pwork = u + bcons[1,1] if rage==35&rshlt3==`h'&insamp
  8.                 forvalues t = 36(1)69 {
  9.                         matrix bage = beta["_Irage_`t'",1]
 10.                         qui replace pwork = u + bage[1,1] + bcons[1,1] if 
> rage==`t'&rshlt3==`h'&insamp
 11.                 }       
 12.                 drop u  
 13.                 drop insamp
 14.         }
(38,545 missing values generated)
(64 real changes made)
(35,285 missing values generated)
(203 real changes made)
(27,764 missing values generated)
(670 real changes made)

.         * pwork has the adjusted data for work
. 
.         * very good health
.         gen vgood = rshlt3==3 

.         reg vgood i.rage ib3.rbyr_c [aw=wgid_cs]
(sum of wgt is   1.0554e+06)

      Source |       SS           df       MS      Number of obs   =    28,592
-------------+----------------------------------   F(54, 28537)    =     45.23
       Model |  556.107666        54  10.2982901   Prob > F        =    0.0000
    Residual |  6497.66414    28,537  .227692614   R-squared       =    0.0788
-------------+----------------------------------   Adj R-squared   =    0.0771
       Total |  7053.77181    28,591  .246713015   Root MSE        =    .47717

------------------------------------------------------------------------------
       vgood |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        rage |
         36  |  -.0034612   .0220477    -0.16   0.875    -.0466758    .0397534
         37  |  -.0122963   .0219309    -0.56   0.575    -.0552819    .0306893
         38  |  -.0325662   .0221527    -1.47   0.142    -.0759865    .0108541
         39  |  -.0225996   .0221655    -1.02   0.308     -.066045    .0208457
         40  |  -.0511703   .0223991    -2.28   0.022    -.0950735    -.007267
         41  |  -.0569498   .0223706    -2.55   0.011    -.1007972   -.0131024
         42  |   -.073269   .0225368    -3.25   0.001    -.1174423   -.0290958
         43  |   -.091765   .0228036    -4.02   0.000    -.1364611   -.0470688
         44  |  -.0822561   .0227801    -3.61   0.000    -.1269062    -.037606
         45  |  -.1118466   .0232059    -4.82   0.000    -.1573313   -.0663618
         46  |  -.1201039   .0232689    -5.16   0.000     -.165712   -.0744958
         47  |  -.1298405   .0238547    -5.44   0.000    -.1765968   -.0830842
         48  |  -.1304611   .0240276    -5.43   0.000    -.1775563    -.083366
         49  |  -.1330704   .0244896    -5.43   0.000    -.1810711   -.0850696
         50  |  -.1491747   .0246967    -6.04   0.000    -.1975814    -.100768
         51  |  -.1628058   .0254472    -6.40   0.000    -.2126834   -.1129281
         52  |  -.2059074   .0256658    -8.02   0.000    -.2562136   -.1556013
         53  |  -.1879937   .0260145    -7.23   0.000    -.2389833   -.1370042
         54  |  -.2147344   .0264336    -8.12   0.000    -.2665454   -.1629233
         55  |  -.2235059   .0267533    -8.35   0.000    -.2759436   -.1710682
         56  |  -.1931425   .0267881    -7.21   0.000    -.2456484   -.1406367
         57  |  -.1915863   .0268549    -7.13   0.000    -.2442232   -.1389494
         58  |  -.2390205   .0272873    -8.76   0.000    -.2925049   -.1855362
         59  |   -.242948   .0281447    -8.63   0.000    -.2981129    -.187783
         60  |  -.2484061   .0284725    -8.72   0.000    -.3042136   -.1925986
         61  |   -.268346   .0290717    -9.23   0.000     -.325328   -.2113641
         62  |  -.3077499   .0292578   -10.52   0.000    -.3650967   -.2504032
         63  |  -.2956949    .029265   -10.10   0.000    -.3530556   -.2383341
         64  |  -.2520999   .0296957    -8.49   0.000    -.3103048    -.193895
         65  |  -.3079115   .0301768   -10.20   0.000    -.3670595   -.2487636
         66  |   -.255273   .0306668    -8.32   0.000    -.3153814   -.1951646
         67  |  -.3186004    .030353   -10.50   0.000    -.3780937   -.2591071
         68  |  -.3195683   .0312813   -10.22   0.000    -.3808811   -.2582555
         69  |  -.3107993   .0313348    -9.92   0.000    -.3722169   -.2493817
         70  |  -.2979855   .0327147    -9.11   0.000     -.362108   -.2338631
         71  |  -.3217489   .0332615    -9.67   0.000    -.3869429   -.2565549
         72  |   -.312476   .0337593    -9.26   0.000    -.3786458   -.2463062
         73  |  -.3046992   .0342876    -8.89   0.000    -.3719045   -.2374939
         74  |  -.3342895   .0358117    -9.33   0.000    -.4044822   -.2640968
         75  |  -.3402111     .03488    -9.75   0.000    -.4085776   -.2718447
         76  |  -.3695768   .0362772   -10.19   0.000    -.4406818   -.2984718
         77  |  -.3874883   .0365519   -10.60   0.000    -.4591319   -.3158448
         78  |  -.3355705   .0386201    -8.69   0.000    -.4112677   -.2598732
         79  |  -.3698396   .0398636    -9.28   0.000    -.4479742    -.291705
         80  |  -.3854352   .0416917    -9.24   0.000    -.4671528   -.3037176
         81  |  -.3649225    .042861    -8.51   0.000    -.4489321   -.2809129
         82  |  -.4109557   .0436564    -9.41   0.000    -.4965242   -.3253872
         83  |  -.4030462   .0453457    -8.89   0.000    -.4919258   -.3141665
         84  |  -.3599316   .0488224    -7.37   0.000    -.4556257   -.2642375
             |
      rbyr_c |
          1  |  -.1144083   .0155928    -7.34   0.000    -.1449709   -.0838457
          2  |  -.0107976   .0115254    -0.94   0.349     -.033388    .0117927
          4  |  -.0047367   .0093413    -0.51   0.612    -.0230461    .0135727
          5  |  -.0436863   .0125434    -3.48   0.000     -.068272   -.0191007
          6  |   -.078863   .0244532    -3.23   0.001    -.1267925   -.0309335
             |
       _cons |   .7586441   .0189346    40.07   0.000     .7215315    .7957568
------------------------------------------------------------------------------

.         gen insamp = e(sample)

.         predict u if insamp, res
(13,383 missing values generated)

.         matrix beta = e(b)'

.         gen pvgood = .
(41,975 missing values generated)

.     matrix bcons = beta["_cons",1] 

.     replace pvgood = bcons[1,1] + u if rage==35&insamp
(937 real changes made)

.         forvalues t = 36(1)84 {
  2.                 matrix bage = beta["`t'.rage",1]
  3.                 qui replace pvgood = bage[1,1] + bcons[1,1] + u if rage==`
> t'&insamp
  4.         }       

.         drop insamp u

.         * pvgood has the adjusted data for vgood
. 
.         * poor health
.         gen vpoor = rshlt3==1 

.         reg vpoor i.rage ib3.rbyr_c [aw=wgid_cs]
(sum of wgt is   1.0554e+06)

      Source |       SS           df       MS      Number of obs   =    28,592
-------------+----------------------------------   F(54, 28537)    =     46.01
       Model |  318.148657        54   5.8916418   Prob > F        =    0.0000
    Residual |  3654.44024    28,537   .12805972   R-squared       =    0.0801
-------------+----------------------------------   Adj R-squared   =    0.0783
       Total |  3972.58889    28,591  .138945434   Root MSE        =    .35785

------------------------------------------------------------------------------
       vpoor |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        rage |
         36  |  -.0140883   .0165347    -0.85   0.394     -.046497    .0183205
         37  |   .0023379   .0164471     0.14   0.887    -.0298991    .0345749
         38  |   .0005568   .0166134     0.03   0.973    -.0320063    .0331198
         39  |   .0019773    .016623     0.12   0.905    -.0306045    .0345591
         40  |    .022226   .0167982     1.32   0.186    -.0106992    .0551512
         41  |   .0187873   .0167768     1.12   0.263    -.0140961    .0516706
         42  |    .029236   .0169015     1.73   0.084    -.0038917    .0623636
         43  |   .0284013   .0171015     1.66   0.097    -.0051186    .0619211
         44  |   .0263504   .0170839     1.54   0.123    -.0071349    .0598357
         45  |   .0381114   .0174033     2.19   0.029     .0040001    .0722226
         46  |   .0390605   .0174505     2.24   0.025     .0048567    .0732643
         47  |   .0532332   .0178898     2.98   0.003     .0181684    .0882981
         48  |   .0573737   .0180194     3.18   0.001     .0220547    .0926926
         49  |   .0706986   .0183659     3.85   0.000     .0347005    .1066967
         50  |   .0674125   .0185213     3.64   0.000     .0311099    .1037151
         51  |   .0743461   .0190841     3.90   0.000     .0369404    .1117518
         52  |   .1071709    .019248     5.57   0.000     .0694438    .1448979
         53  |   .0717844   .0195095     3.68   0.000     .0335448     .110024
         54  |   .1036082   .0198238     5.23   0.000     .0647526    .1424638
         55  |   .1167369   .0200636     5.82   0.000     .0774113    .1560625
         56  |   .1018721   .0200897     5.07   0.000     .0624953    .1412488
         57  |   .1077722   .0201398     5.35   0.000     .0682972    .1472471
         58  |    .119492   .0204641     5.84   0.000     .0793814    .1596025
         59  |   .1215907   .0211071     5.76   0.000     .0802198    .1629616
         60  |   .1123033   .0213529     5.26   0.000     .0704506    .1541561
         61  |   .1482438   .0218023     6.80   0.000     .1055102    .1909773
         62  |   .1305657   .0219419     5.95   0.000     .0875585    .1735728
         63  |   .1506619   .0219472     6.86   0.000     .1076443    .1936795
         64  |   .1321476   .0222702     5.93   0.000     .0884969    .1757983
         65  |   .1373472   .0226311     6.07   0.000     .0929892    .1817051
         66  |     .12663   .0229985     5.51   0.000     .0815518    .1717082
         67  |   .1415103   .0227632     6.22   0.000     .0968934    .1861272
         68  |   .1453585   .0234594     6.20   0.000      .099377      .19134
         69  |   .1542792   .0234995     6.57   0.000     .1082191    .2003393
         70  |   .1548603   .0245344     6.31   0.000     .1067718    .2029489
         71  |    .164274   .0249444     6.59   0.000     .1153818    .2131662
         72  |   .1686355   .0253177     6.66   0.000     .1190116    .2182595
         73  |   .1931253   .0257139     7.51   0.000     .1427247    .2435258
         74  |   .1881873    .026857     7.01   0.000     .1355464    .2408283
         75  |   .2215187   .0261582     8.47   0.000     .1702474    .2727901
         76  |    .257306    .027206     9.46   0.000     .2039809    .3106311
         77  |   .2903449   .0274121    10.59   0.000     .2366159    .3440739
         78  |    .253242   .0289631     8.74   0.000     .1964729    .3100111
         79  |   .2653219   .0298957     8.87   0.000     .2067249    .3239189
         80  |    .272688   .0312666     8.72   0.000     .2114039     .333972
         81  |   .2706709   .0321436     8.42   0.000      .207668    .3336738
         82  |   .3081684     .03274     9.41   0.000     .2439964    .3723405
         83  |     .30752   .0340069     9.04   0.000     .2408648    .3741752
         84  |   .3107917   .0366143     8.49   0.000      .239026    .3825574
             |
      rbyr_c |
          1  |   .1088109   .0116938     9.31   0.000     .0858905    .1317313
          2  |    .034646   .0086435     4.01   0.000     .0177044    .0515876
          4  |   .0127861   .0070055     1.83   0.068     -.000945    .0265172
          5  |   .0184175   .0094069     1.96   0.050    -.0000204    .0368555
          6  |   .0259022   .0183387     1.41   0.158    -.0100425    .0618469
             |
       _cons |   .0484765      .0142     3.41   0.001      .020644    .0763091
------------------------------------------------------------------------------

.         gen insamp = e(sample)

.         predict u if insamp, res
(13,383 missing values generated)

.         matrix beta = e(b)'

.         gen ppoor = .
(41,975 missing values generated)

.     matrix bcons = beta["_cons",1] 

.     replace ppoor = bcons[1,1] + u if rage==35&insamp
(937 real changes made)

.         forvalues t = 36(1)84 {
  2.                 matrix bage = beta["`t'.rage",1]
  3.                 qui replace ppoor = bage[1,1] + bcons[1,1] + u if rage==`t
> '&insamp
  4.         }       

.         drop insamp u

. 
.         *keep if inlist(rage,35,40,45,50,55,60,65,70,75,80,84)
.         tsset hhidpn year
       panel variable:  hhidpn (unbalanced)
        time variable:  year, 1984 to 2005, but with gaps
                delta:  1 unit

.         xtdes

  hhidpn:  4001, 4003, ..., 3511001                          n =       4904
    year:  1984, 1985, ..., 2005                             T =         18
           Delta(year) = 1 unit
           Span(year)  = 22 periods
           (hhidpn*year uniquely identifies each observation)

Distribution of T_i:   min      5%     25%       50%       75%     95%     max
                         1       1       3         7        14      18      18

     Freq.  Percent    Cum. |  Pattern
 ---------------------------+------------------------
      786     16.03   16.03 |  11111111111111.1.1.1.1
      254      5.18   21.21 |  .....................1
      250      5.10   26.31 |  ...................1.1
      231      4.71   31.02 |  .............1.1.1.1.1
      216      4.40   35.42 |  ...............1.1.1.1
      177      3.61   39.03 |  ..........1111.1.1.1.1
      172      3.51   42.54 |  .................1.1.1
       91      1.86   44.39 |  ...........111.1.1.1.1
       87      1.77   46.17 |  ........111111.1.1.1.1
     2640     53.83  100.00 | (other patterns)
 ---------------------------+------------------------
     4904    100.00         |  XXXXXXXXXXXXXX.X.X.X.X

.         sum ppoor pvgood pwork pass

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       ppoor |     28,592      .14412    .3738403  -.1088109          1
      pvgood |     28,592    .5745179    .4916445  -2.80e-08   1.114408
       pwork |     24,331    .8590313     .360081  -.0541876   1.092079
        pass |     17,880    250685.2      334547  -6148.969    1993553

.         gen psid = 1

.         keep hhidpn rage ppoor pvgood pwork pass rshlt3 wgid_cs psid

. 
.         save $src/temp/psid_adjusted.dta, replace
file ~/cedia/Projets/rise-data/temp/psid_adjusted.dta saved

. 
. restore

. 
. 
. preserve

.         set more off

.         use $src/data/meps-nhis_long_extract.dta, clear
(MEPS1996-2008)

.         destring dupersid, replace
dupersid: all characters numeric; replaced as long

.         rename dupersid hhidpn

.         drop if missing(hhidpn)
(0 observations deleted)

.         sort hhidpn year

.         gen rbyr = year - age

.         keep if age>=35
(25,157 observations deleted)

.         #d ;
delimiter now ;
.         recode rbyr (min/1925=1) (1925/1935=2) 
>         (1936/1945=3) (1946/1955=4) (1956/1965=5) (1966/max=6), gen(rbyr_c);
(83676 differences between rbyr and rbyr_c)

.         #d cr
delimiter now cr
.         char rbyr_c[omit] 3

.         char age[omit] 35

.         tab rbyr_c , gen(rbyr_c)

  RECODE of |
       rbyr |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      4,598        5.50        5.50
          2 |      9,511       11.37       16.86
          3 |     14,124       16.88       33.74
          4 |     22,931       27.40       61.15
          5 |     25,064       29.95       91.10
          6 |      7,448        8.90      100.00
------------+-----------------------------------
      Total |     83,676      100.00

.         drop if hlth==.
(647 observations deleted)

.         reg mepsexp i.age ib3.rbyr_c

      Source |       SS           df       MS      Number of obs   =    82,575
-------------+----------------------------------   F(54, 82520)    =    121.55
       Model |  7.3387e+11        54  1.3590e+10   Prob > F        =    0.0000
    Residual |  9.2265e+12    82,520   111808831   R-squared       =    0.0737
-------------+----------------------------------   Adj R-squared   =    0.0731
       Total |  9.9603e+12    82,574   120623119   Root MSE        =     10574

------------------------------------------------------------------------------
     mepsexp |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         age |
         36  |   224.4027   293.4845     0.76   0.445    -350.8248    799.6302
         37  |   654.1414   292.5494     2.24   0.025     80.74681    1227.536
         38  |   380.1228   294.1179     1.29   0.196    -196.3462    956.5917
         39  |   597.3001    297.137     2.01   0.044     14.91371    1179.686
         40  |   781.6534   300.5646     2.60   0.009     192.5489    1370.758
         41  |   1083.513   303.6266     3.57   0.000     488.4069    1678.619
         42  |   1293.413   306.0496     4.23   0.000     693.5583    1893.268
         43  |    1375.01   309.9093     4.44   0.000     767.5901     1982.43
         44  |    1283.65   311.8218     4.12   0.000     672.4812    1894.818
         45  |   1635.869   317.0653     5.16   0.000     1014.424    2257.315
         46  |   1986.532   319.8884     6.21   0.000     1359.553    2613.511
         47  |   2347.906   321.9262     7.29   0.000     1716.933    2978.879
         48  |   2785.392    326.443     8.53   0.000     2145.566    3425.218
         49  |   2793.057   332.4239     8.40   0.000     2141.509    3444.606
         50  |   2847.926   335.5592     8.49   0.000     2190.232     3505.62
         51  |   3479.612   341.5351    10.19   0.000     2810.206    4149.019
         52  |   3773.055    349.409    10.80   0.000     3088.216    4457.894
         53  |   3980.852    357.931    11.12   0.000      3279.31    4682.394
         54  |   4020.834   359.9516    11.17   0.000     3315.332    4726.337
         55  |   4904.376   365.2933    13.43   0.000     4188.403    5620.348
         56  |   5071.538   370.3629    13.69   0.000     4345.629    5797.446
         57  |   5405.139   376.7919    14.35   0.000     4666.629    6143.648
         58  |    6091.06   386.1631    15.77   0.000     5334.183    6847.937
         59  |   6937.969   396.4915    17.50   0.000     6160.849     7715.09
         60  |   6579.903    404.826    16.25   0.000     5786.446    7373.359
         61  |   6497.661   414.0814    15.69   0.000     5686.064    7309.257
         62  |   7201.975   420.2398    17.14   0.000     6378.308    8025.642
         63  |   8545.956   437.0022    19.56   0.000     7689.435    9402.477
         64  |   9414.146   441.0389    21.35   0.000     8549.713    10278.58
         65  |   8881.817   444.3527    19.99   0.000     8010.889    9752.745
         66  |   9281.152    454.742    20.41   0.000     8389.861    10172.44
         67  |   9909.288   465.6738    21.28   0.000     8996.571    10822.01
         68  |    10094.8   472.7827    21.35   0.000     9168.145    11021.45
         69  |   9835.119   481.8514    20.41   0.000     8890.694    10779.54
         70  |   10770.51   496.1774    21.71   0.000     9798.004    11743.01
         71  |   11517.79    506.906    22.72   0.000     10524.26    12511.33
         72  |   11830.19   512.7421    23.07   0.000     10825.22    12835.16
         73  |   13327.12   525.5484    25.36   0.000     12297.05    14357.19
         74  |   11880.28   533.0087    22.29   0.000     10835.59    12924.98
         75  |   12916.78   542.4045    23.81   0.000     11853.67    13979.89
         76  |   14415.69   551.7124    26.13   0.000     13334.33    15497.04
         77  |   13657.41   561.4989    24.32   0.000     12556.88    14757.95
         78  |   13911.41    576.908    24.11   0.000     12780.67    15042.14
         79  |   13573.92   604.3262    22.46   0.000     12389.45     14758.4
         80  |   14052.22   624.6818    22.50   0.000     12827.85     15276.6
         81  |    13920.2   663.2218    20.99   0.000     12620.29    15220.11
         82  |   15351.83   696.0154    22.06   0.000     13987.64    16716.01
         83  |   14361.22   708.4245    20.27   0.000     12972.72    15749.73
         84  |   13699.08   703.9822    19.46   0.000     12319.28    15078.88
             |
      rbyr_c |
          1  |  -2513.847    340.693    -7.38   0.000    -3181.602   -1846.091
          2  |   -1684.14   217.2306    -7.75   0.000     -2109.91    -1258.37
          4  |   1350.376   172.1586     7.84   0.000     1012.946    1687.805
          5  |   1727.488   223.8338     7.72   0.000     1288.776    2166.201
          6  |   1911.941   278.0238     6.88   0.000     1367.016    2456.866
             |
       _cons |  -251.6985   322.9214    -0.78   0.436    -884.6221    381.2251
------------------------------------------------------------------------------

.         gen insamp = e(sample)

.         predict u if insamp, res
(454 missing values generated)

.         matrix beta = e(b)'                     

.         gen pmed = .
(83,029 missing values generated)

.         matrix bcons = beta["_cons",1] 

.         replace pmed = u + bcons[1,1] if age==35&insamp
(2,611 real changes made)

.         forvalues t = 36(1)84 {
  2.                 matrix bage = beta["`t'.age",1]
  3.                 qui replace pmed = u + bage[1,1] + bcons[1,1] if age==`t'&
> insamp
  4.         }

.         drop insamp u

.         rename age rage

.         rename hlth rshlt3

.         replace rshlt3 = rshlt3 - 1
(83,029 real changes made)

.         rename perwt wgid_cs

.         gen meps = 1

.         keep hhidpn rage pmed rshlt3 wgid_cs meps

.         save $src/temp/meps_adjusted.dta, replace
file ~/cedia/Projets/rise-data/temp/meps_adjusted.dta saved

. restore

. 
. 
. use $src/temp/psid_adjusted.dta, clear
(Fonseca, Michaud, Kapteyn and Galama (2017) - PSID extract, ver32)

. append using $src/temp/meps_adjusted.dta
(note: variable rage was int, now double to accommodate using data's values)
(note: variable wgid_cs was float, now double to accommodate using data's
       values)
(note: variable rshlt3 was float, now double to accommodate using data's
       values)

. replace meps = 0 if meps==.
(41,975 real changes made)

. replace psid = 0 if psid==.
(83,029 real changes made)

. gen age = rage

. merge n:1 age using $src/raw/other/mortality-ssa-cohort.dta

    Result                           # of obs.
    -----------------------------------------
    not matched                            36
        from master                         0  (_merge==1)
        from using                         36  (_merge==2)

    matched                           125,004  (_merge==3)
    -----------------------------------------

. keep if _merge==3
(36 observations deleted)

. keep if age>=25&age<=84
(0 observations deleted)

. gen pdead = (uniform()<pmx)

. drop pmx age

. egen id = group(hhidpn psid meps)

. drop _merge

. sort id rage

. by id: gen t = _n

. tsset id t
       panel variable:  id (unbalanced)
        time variable:  t, 1 to 18
                delta:  1 unit

. xtsum id

Variable         |      Mean   Std. Dev.       Min        Max |    Observations
-----------------+--------------------------------------------+----------------
id       overall |  19040.93   15674.82          1      50755 |     N =  125004
         between |             14651.85          1      50755 |     n =   50755
         within  |                    0   19040.93   19040.93 | T-bar = 2.46289

. global nobs = r(n)

. save $src/data/data_adjusted.dta, replace
file ~/cedia/Projets/rise-data/data/data_adjusted.dta saved

. 
. 
. use $src/data/data_adjusted.dta, clear
(Fonseca, Michaud, Kapteyn and Galama (2017) - PSID extract, ver32)

. 
. local nages = 84 - 35 + 1

. local nwork = 69 - 35 + 1

. local i = 1

. * work in poor health
. forvalues j = 1/`nwork' {
  2.         local a = 35 + `j' - 1
  3.         gen mom_`i' = pwork  * (rage==`a'&rshlt3==1&psid==1)
  4.         gen in_`i' = (rage==`a'&rshlt3==1&psid==1&mom_`i'!=.)
  5.         replace mom_`i' = 0 if in_`i'==0
  6.         local i = `i' + 1
  7. }
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)

. 
. * work in good health
. forvalues j = 1/`nwork' {
  2.         local a = 35 + `j' - 1
  3.         gen mom_`i' = pwork * (rage==`a'&rshlt3==2&psid==1) 
  4.         gen in_`i' = (rage==`a'&rshlt3==2&psid==1&mom_`i'!=.)
  5.         replace mom_`i' = 0 if in_`i'==0 
  6.         local i = `i' + 1
  7. }
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)

. 
. * work in very good health
. forvalues j = 1/`nwork' {
  2.         local a = 35 + `j' - 1
  3.         gen mom_`i' = pwork * (rage==`a'&rshlt3==3&psid==1) 
  4.         gen in_`i' = (rage==`a'&rshlt3==3&psid==1&mom_`i'!=.)
  5.         replace mom_`i' = 0 if in_`i'==0
  6.         local i = `i' + 1
  7. }
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)
(100,673 missing values generated)
(100,673 real changes made)

. 
. * medical spending
. forvalues j = 1/`nages' {
  2.         local a = 35 + `j' - 1
  3.         gen mom_`i' = pmed * (rage==`a' & meps==1) 
  4.         gen in_`i' = (rage==`a' & meps==1 & mom_`i'!=.)
  5.         replace mom_`i' = 0 if in_`i'==0
  6.         local i = `i' + 1
  7. }
(42,429 missing values generated)
(42,429 real changes made)
(42,429 missing values generated)
(42,429 real changes made)
(42,429 missing values generated)
(42,429 real changes made)
(42,429 missing values generated)
(42,429 real changes made)
(42,429 missing values generated)
(42,429 real changes made)
(42,429 missing values generated)
(42,429 real changes made)
(42,429 missing values generated)
(42,429 real changes made)
(42,429 missing values generated)
(42,429 real changes made)
(42,429 missing values generated)
(42,429 real changes made)
(42,429 missing values generated)
(42,429 real changes made)
(42,429 missing values generated)
(42,429 real changes made)
(42,429 missing values generated)
(42,429 real changes made)
(42,429 missing values generated)
(42,429 real changes made)
(42,429 missing values generated)
(42,429 real changes made)
(42,429 missing values generated)
(42,429 real changes made)
(42,429 missing values generated)
(42,429 real changes made)
(42,429 missing values generated)
(42,429 real changes made)
(42,429 missing values generated)
(42,429 real changes made)
(42,429 missing values generated)
(42,429 real changes made)
(42,429 missing values generated)
(42,429 real changes made)
(42,429 missing values generated)
(42,429 real changes made)
(42,429 missing values generated)
(42,429 real changes made)
(42,429 missing values generated)
(42,429 real changes made)
(42,429 missing values generated)
(42,429 real changes made)
(42,429 missing values generated)
(42,429 real changes made)
(42,429 missing values generated)
(42,429 real changes made)
(42,429 missing values generated)
(42,429 real changes made)
(42,429 missing values generated)
(42,429 real changes made)
(42,429 missing values generated)
(42,429 real changes made)
(42,429 missing values generated)
(42,429 real changes made)
(42,429 missing values generated)
(42,429 real changes made)
(42,429 missing values generated)
(42,429 real changes made)
(42,429 missing values generated)
(42,429 real changes made)
(42,429 missing values generated)
(42,429 real changes made)
(42,429 missing values generated)
(42,429 real changes made)
(42,429 missing values generated)
(42,429 real changes made)
(42,429 missing values generated)
(42,429 real changes made)
(42,429 missing values generated)
(42,429 real changes made)
(42,429 missing values generated)
(42,429 real changes made)
(42,429 missing values generated)
(42,429 real changes made)
(42,429 missing values generated)
(42,429 real changes made)
(42,429 missing values generated)
(42,429 real changes made)
(42,429 missing values generated)
(42,429 real changes made)
(42,429 missing values generated)
(42,429 real changes made)
(42,429 missing values generated)
(42,429 real changes made)
(42,429 missing values generated)
(42,429 real changes made)
(42,429 missing values generated)
(42,429 real changes made)
(42,429 missing values generated)
(42,429 real changes made)
(42,429 missing values generated)
(42,429 real changes made)
(42,429 missing values generated)
(42,429 real changes made)

. 
. * mortality
. forvalues j = 1/`nages' {
  2.         local a = 35 + `j' - 1
  3.         gen mom_`i' = pdead * (rage==`a') 
  4.         gen in_`i' = (rage==`a' & mom_`i'!=.)
  5.         replace mom_`i' = 0 if in_`i'==0
  6.         local i = `i' + 1
  7. }
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)

. 
. * poor
. forvalues j = 1/`nages' {
  2.         local a = 35 + `j' - 1
  3. *       gen mom_`i' = ppoor * (rage==`a') 
. *       gen in_`i' = (rage==`a' & psid==1 & mom_`i'!=.)
. *       replace mom_`i' = 0 if in_`i'==0
. *       local i = `i' + 1
. }

. 
. 
. * vgood
. forvalues j = 1/`nages' {
  2.         local a = 35 + `j' - 1
  3. *       gen mom_`i' = pvgood * (rage==`a') 
. *       gen in_`i' = (rage==`a' & psid==1 & mom_`i'!=.)
. *       replace mom_`i' = 0 if in_`i'==0        
. *       local i = `i' + 1
. }

. 
. * wealth
. forvalues j = 1/`nages' {
  2.         local a = 35 + `j' - 1
  3.         gen mom_`i' = pass * (rage==`a' & psid==1) 
  4.         gen in_`i' = (rage==`a' & psid==1 & mom_`i'!=.) 
  5.         replace mom_`i' = 0 if in_`i'==0
  6.         local i = `i' + 1
  7. }
(107,124 missing values generated)
(107,124 real changes made)
(107,124 missing values generated)
(107,124 real changes made)
(107,124 missing values generated)
(107,124 real changes made)
(107,124 missing values generated)
(107,124 real changes made)
(107,124 missing values generated)
(107,124 real changes made)
(107,124 missing values generated)
(107,124 real changes made)
(107,124 missing values generated)
(107,124 real changes made)
(107,124 missing values generated)
(107,124 real changes made)
(107,124 missing values generated)
(107,124 real changes made)
(107,124 missing values generated)
(107,124 real changes made)
(107,124 missing values generated)
(107,124 real changes made)
(107,124 missing values generated)
(107,124 real changes made)
(107,124 missing values generated)
(107,124 real changes made)
(107,124 missing values generated)
(107,124 real changes made)
(107,124 missing values generated)
(107,124 real changes made)
(107,124 missing values generated)
(107,124 real changes made)
(107,124 missing values generated)
(107,124 real changes made)
(107,124 missing values generated)
(107,124 real changes made)
(107,124 missing values generated)
(107,124 real changes made)
(107,124 missing values generated)
(107,124 real changes made)
(107,124 missing values generated)
(107,124 real changes made)
(107,124 missing values generated)
(107,124 real changes made)
(107,124 missing values generated)
(107,124 real changes made)
(107,124 missing values generated)
(107,124 real changes made)
(107,124 missing values generated)
(107,124 real changes made)
(107,124 missing values generated)
(107,124 real changes made)
(107,124 missing values generated)
(107,124 real changes made)
(107,124 missing values generated)
(107,124 real changes made)
(107,124 missing values generated)
(107,124 real changes made)
(107,124 missing values generated)
(107,124 real changes made)
(107,124 missing values generated)
(107,124 real changes made)
(107,124 missing values generated)
(107,124 real changes made)
(107,124 missing values generated)
(107,124 real changes made)
(107,124 missing values generated)
(107,124 real changes made)
(107,124 missing values generated)
(107,124 real changes made)
(107,124 missing values generated)
(107,124 real changes made)
(107,124 missing values generated)
(107,124 real changes made)
(107,124 missing values generated)
(107,124 real changes made)
(107,124 missing values generated)
(107,124 real changes made)
(107,124 missing values generated)
(107,124 real changes made)
(107,124 missing values generated)
(107,124 real changes made)
(107,124 missing values generated)
(107,124 real changes made)
(107,124 missing values generated)
(107,124 real changes made)
(107,124 missing values generated)
(107,124 real changes made)
(107,124 missing values generated)
(107,124 real changes made)
(107,124 missing values generated)
(107,124 real changes made)
(107,124 missing values generated)
(107,124 real changes made)
(107,124 missing values generated)
(107,124 real changes made)
(107,124 missing values generated)
(107,124 real changes made)
(107,124 missing values generated)
(107,124 real changes made)

. 
. keep mom_* in_*

. order mom_* in_*

. 
. *forvalues i = 1/300 {
. *       sum mom_`i' if in_`i'==1
. *}
. 
. 
. 
. preserve

.         keep mom_*

.         sum mom_*

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       mom_1 |    125,004     .000467    .0217669  -.0273335   1.064656
       mom_2 |    125,004    .0002857    .0169341  -.0273335   1.064656
       mom_3 |    125,004    .0004889    .0222116  -.0273335   1.064656
       mom_4 |    125,004    .0003898    .0197511  -.0273335   1.064656
       mom_5 |    125,004    .0004106    .0202622  -.0273335   1.064656
-------------+---------------------------------------------------------
       mom_6 |    125,004    .0005444    .0233631  -.0273335   1.053332
       mom_7 |    125,004     .000539    .0232575  -.0273335   1.053332
       mom_8 |    125,004    .0005675    .0237984  -.0273335   1.053332
       mom_9 |    125,004    .0005314     .023086  -.0273335   1.053332
      mom_10 |    125,004    .0005104    .0225441  -.0273335   1.053332
-------------+---------------------------------------------------------
      mom_11 |    125,004    .0004968    .0222945  -.0273335   1.053332
      mom_12 |    125,004    .0004999    .0223433  -.0273335   1.053332
      mom_13 |    125,004     .000478     .021843  -.0273335   1.053332
      mom_14 |    125,004    .0005053    .0224154  -.0273335   1.053332
      mom_15 |    125,004    .0005847    .0241171  -.0541876   1.053332
-------------+---------------------------------------------------------
      mom_16 |    125,004    .0005683    .0236876  -.0541875          1
      mom_17 |    125,004    .0005761    .0238029  -.0541876          1
      mom_18 |    125,004    .0006098    .0244138  -.0541876          1
      mom_19 |    125,004    .0004153    .0201949  -.0541876          1
      mom_20 |    125,004    .0005071    .0223709  -.0541876          1
-------------+---------------------------------------------------------
      mom_21 |    125,004    .0005426    .0231303  -.0541875          1
      mom_22 |    125,004    .0004803    .0217452  -.0541876          1
      mom_23 |    125,004    .0004836    .0218644  -.0541876          1
      mom_24 |    125,004    .0004434    .0210562  -.0541876          1
      mom_25 |    125,004    .0005162    .0226125  -.0541876          1
-------------+---------------------------------------------------------
      mom_26 |    125,004    .0004633    .0215339  -.0541876          1
      mom_27 |    125,004    .0005855    .0240779  -.0541876          1
      mom_28 |    125,004     .000505     .022407  -.0541876          1
      mom_29 |    125,004    .0005319    .0230798  -.0541876          1
      mom_30 |    125,004    .0003696    .0193947  -.0541876          1
-------------+---------------------------------------------------------
      mom_31 |    125,004    .0003249    .0182195  -.0541876          1
      mom_32 |    125,004    .0001981    .0146236  -.0541876          1
      mom_33 |    125,004    .0002391     .015883  -.0541876          1
      mom_34 |    125,004    .0002097    .0147855  -.0541876          1
      mom_35 |    125,004    .0001906    .0143228  -.0541876          1
-------------+---------------------------------------------------------
      mom_36 |    125,004    .0015696    .0398763  -.0122064   1.028638
      mom_37 |    125,004    .0016811    .0413165  -.0122064   1.028638
      mom_38 |    125,004    .0016394    .0407875          0   1.028638
      mom_39 |    125,004    .0017808    .0425453  -.0122064   1.028638
      mom_40 |    125,004    .0016317    .0407289          0   1.028638
-------------+---------------------------------------------------------
      mom_41 |    125,004     .001692    .0414806          0   1.028638
      mom_42 |    125,004    .0017385    .0420474          0   1.028638
      mom_43 |    125,004    .0017022    .0415469          0   1.028638
      mom_44 |    125,004    .0017488     .042088  -1.96e-08   1.028638
      mom_45 |    125,004    .0016507    .0409061  -7.32e-09   1.028638
-------------+---------------------------------------------------------
      mom_46 |    125,004    .0016581    .0409763  -2.98e-08   1.028638
      mom_47 |    125,004    .0016662    .0410373          0   1.028638
      mom_48 |    125,004     .001556    .0396255  -2.26e-08   1.028638
      mom_49 |    125,004    .0016506    .0408013          0   1.028638
      mom_50 |    125,004    .0013823    .0373171          0   1.028638
-------------+---------------------------------------------------------
      mom_51 |    125,004    .0014947    .0387827          0   1.017056
      mom_52 |    125,004     .001362     .036989          0   1.017056
      mom_53 |    125,004    .0013773    .0371978  -1.85e-08   1.017056
      mom_54 |    125,004    .0014183    .0377608  -9.48e-09   1.017056
      mom_55 |    125,004    .0013446    .0367414          0   1.017056
-------------+---------------------------------------------------------
      mom_56 |    125,004     .001184    .0344639  -2.19e-09   1.017056
      mom_57 |    125,004    .0012158    .0349462          0   1.017056
      mom_58 |    125,004     .001119    .0335223  -2.62e-08   1.017056
      mom_59 |    125,004    .0012304    .0351198          0   1.017056
      mom_60 |    125,004    .0011158    .0334328  -.0227211   1.017056
-------------+---------------------------------------------------------
      mom_61 |    125,004    .0011367    .0337022  -.0227211   1.005438
      mom_62 |    125,004    .0010865    .0329093   -.022721   1.005438
      mom_63 |    125,004     .001093    .0330005  -.0227211   1.005438
      mom_64 |    125,004    .0010523    .0324116  -.0227211   1.005438
      mom_65 |    125,004    .0007296    .0269558   -.022721   1.005438
-------------+---------------------------------------------------------
      mom_66 |    125,004    .0007053    .0265319   -.022721   1.005438
      mom_67 |    125,004    .0005746    .0239776  -.0227211   1.005438
      mom_68 |    125,004    .0005719    .0239831  -.0227211   1.005438
      mom_69 |    125,004     .000442    .0211192  -.0227211   1.005438
      mom_70 |    125,004    .0003945    .0200012  -.0227211   1.005438
-------------+---------------------------------------------------------
      mom_71 |    125,004    .0053101     .073496          0    1.03498
      mom_72 |    125,004     .005466    .0745197          0    1.03498
      mom_73 |    125,004    .0054189    .0741447          0    1.03498
      mom_74 |    125,004    .0051971    .0725616          0    1.03498
      mom_75 |    125,004    .0053543     .073598          0    1.03498
-------------+---------------------------------------------------------
      mom_76 |    125,004    .0049357    .0705692  -1.33e-08   1.034055
      mom_77 |    125,004    .0049459     .070613          0   1.034055
      mom_78 |    125,004    .0047096    .0688952  -3.93e-09   1.034055
      mom_79 |    125,004    .0044973    .0673326  -1.93e-09   1.034055
      mom_80 |    125,004     .004443    .0668612  -1.29e-08   1.034055
-------------+---------------------------------------------------------
      mom_81 |    125,004     .004026    .0636322          0   1.034055
      mom_82 |    125,004    .0039968    .0633651          0   1.034055
      mom_83 |    125,004    .0035831    .0599795          0   1.034055
      mom_84 |    125,004    .0036087    .0601584          0   1.034055
      mom_85 |    125,004    .0033895    .0582936  -2.59e-08   1.034055
-------------+---------------------------------------------------------
      mom_86 |    125,004    .0032636    .0571671  -6.49e-09    1.01073
      mom_87 |    125,004    .0029102    .0539925          0    1.01073
      mom_88 |    125,004    .0026852    .0518682          0    1.01073
      mom_89 |    125,004    .0025506    .0505707  -4.70e-09    1.01073
      mom_90 |    125,004    .0023969    .0490237          0    1.01073
-------------+---------------------------------------------------------
      mom_91 |    125,004    .0022541     .047556  -1.20e-09    1.01073
      mom_92 |    125,004    .0024709    .0497843          0    1.01073
      mom_93 |    125,004    .0024576    .0496738  -1.50e-08    1.01073
      mom_94 |    125,004    .0022318    .0473354  -1.21e-09    1.01073
      mom_95 |    125,004    .0019565    .0443892  -1.79e-08   1.092079
-------------+---------------------------------------------------------
      mom_96 |    125,004    .0018778    .0436118  -2.86e-08   1.092079
      mom_97 |    125,004     .001643    .0407972          0   1.092079
      mom_98 |    125,004     .001539    .0396113          0   1.092079
      mom_99 |    125,004    .0014483    .0383709  -1.36e-08   1.092079
     mom_100 |    125,004    .0013153     .036582          0   1.092079
-------------+---------------------------------------------------------
     mom_101 |    125,004    .0009646    .0312018          0   1.092079
     mom_102 |    125,004    .0009751    .0312469          0   1.092079
     mom_103 |    125,004    .0007736    .0277597  -1.04e-08   1.092078
     mom_104 |    125,004    .0005859     .023772          0   1.092079
     mom_105 |    125,004    .0005652    .0233201          0   1.092079
-------------+---------------------------------------------------------
     mom_106 |    125,004    -5.25731     689.983  -1911.941   86140.63
     mom_107 |    125,004   -.5666425    763.3018  -1911.941    85470.5
     mom_108 |    125,004    8.573371    995.9003  -1911.941    98234.4
     mom_109 |    125,004    2.738946    760.2273  -1911.941   75297.34
     mom_110 |    125,004     7.36246    926.4681  -1911.941   88015.91
-------------+---------------------------------------------------------
     mom_111 |    125,004    11.17957    935.5781  -1911.941   92052.41
     mom_112 |    125,004     17.7071    1074.399  -1911.941    95170.4
     mom_113 |    125,004    22.68366    1108.432  -1911.941   96529.81
     mom_114 |    125,004    24.67612    1068.046  -1727.488   95631.13
     mom_115 |    125,004    22.35548    1008.055  -1727.488   89323.82
-------------+---------------------------------------------------------
     mom_116 |    125,004    28.18082    1149.224  -1727.488   92696.63
     mom_117 |    125,004    34.72332    1240.155  -1727.488   98341.48
     mom_118 |    125,004    42.44265     1245.62  -1727.488   97924.09
     mom_119 |    125,004    50.34795    1383.463  -1727.488   96072.41
     mom_120 |    125,004    48.69087    1320.952  -1727.488   95874.73
-------------+---------------------------------------------------------
     mom_121 |    125,004    49.45136    1277.829  -1727.488   98443.12
     mom_122 |    125,004    60.11475    1482.928  -1727.488   96028.16
     mom_123 |    125,004    63.38238    1422.542  -1727.488   96532.25
     mom_124 |    125,004    63.96039    1423.046  -1350.376   98285.73
     mom_125 |    125,004    63.56067    1389.302  -1350.375   92517.82
-------------+---------------------------------------------------------
     mom_126 |    125,004    74.21713    1547.595  -1350.376   97083.23
     mom_127 |    125,004      73.452    1514.395  -1350.375   94948.96
     mom_128 |    125,004    75.32027    1508.762  -1350.376   98109.84
     mom_129 |    125,004    80.02005    1583.976  -1350.376   95401.01
     mom_130 |    125,004    84.88618    1651.052  -1350.376   99414.92
-------------+---------------------------------------------------------
     mom_131 |    125,004    76.23976    1559.184  -1350.375   94486.49
     mom_132 |    125,004    72.35091    1373.402  -1350.376   93972.29
     mom_133 |    125,004    80.78743    1542.016  -1350.376   94534.52
     mom_134 |    125,004     87.1201      1681.7          0   99549.73
     mom_135 |    125,004    93.60057    1782.303          0   96716.05
-------------+---------------------------------------------------------
     mom_136 |    125,004    87.05785    1597.226          0      97164
     mom_137 |    125,004    85.30754    1596.561          0   99423.58
     mom_138 |    125,004    85.98843     1643.45  -.0002161   97906.64
     mom_139 |    125,004    84.56918    1664.304          0   101121.1
     mom_140 |    125,004     78.6582    1437.253          0   92324.05
-------------+---------------------------------------------------------
     mom_141 |    125,004     81.7075    1575.322  -6.41e-06    98750.8
     mom_142 |    125,004    85.61958    1614.362          0   97085.15
     mom_143 |    125,004    88.64208    1601.641  -.0003493   96659.35
     mom_144 |    125,004    95.29063    1776.664          0   99332.99
     mom_145 |    125,004    80.65329    1522.603          0     100186
-------------+---------------------------------------------------------
     mom_146 |    125,004    82.87762    1580.096          0    99475.5
     mom_147 |    125,004    89.62685     1783.71          0   98837.14
     mom_148 |    125,004    81.50414    1605.752          0   100865.3
     mom_149 |    125,004    76.38264    1594.021          0   99627.09
     mom_150 |    125,004    64.37094    1363.723          0   97976.55
-------------+---------------------------------------------------------
     mom_151 |    125,004    61.71397    1413.606          0    97788.3
     mom_152 |    125,004    50.84521    1273.548          0   102015.3
     mom_153 |    125,004    48.80205    1298.268          0   100709.5
     mom_154 |    125,004    44.69754    1169.949          0   96514.71
     mom_155 |    125,004    43.56813    1171.078          0   91370.41
-------------+---------------------------------------------------------
     mom_156 |    125,004     .000104    .0101974          0          1
     mom_157 |    125,004     .000096    .0097974          0          1
     mom_158 |    125,004     .000072    .0084849          0          1
     mom_159 |    125,004     .000056     .007483          0          1
     mom_160 |    125,004      .00008    .0089438          0          1
-------------+---------------------------------------------------------
     mom_161 |    125,004     .000104    .0101974          0          1
     mom_162 |    125,004     .000136     .011661          0          1
     mom_163 |    125,004     .000096    .0097974          0          1
     mom_164 |    125,004     .000112    .0105823          0          1
     mom_165 |    125,004     .000208    .0144205          0          1
-------------+---------------------------------------------------------
     mom_166 |    125,004     .000152    .0123277          0          1
     mom_167 |    125,004     .000136     .011661          0          1
     mom_168 |    125,004     .000176    .0132652          0          1
     mom_169 |    125,004      .00008    .0089438          0          1
     mom_170 |    125,004     .000168    .0129602          0          1
-------------+---------------------------------------------------------
     mom_171 |    125,004       .0002    .0141406          0          1
     mom_172 |    125,004     .000232    .0152296          0          1
     mom_173 |    125,004     .000184    .0135632          0          1
     mom_174 |    125,004     .000224    .0149648          0          1
     mom_175 |    125,004     .000184    .0135632          0          1
-------------+---------------------------------------------------------
     mom_176 |    125,004     .000176    .0132652          0          1
     mom_177 |    125,004     .000168    .0129602          0          1
     mom_178 |    125,004     .000184    .0135632          0          1
     mom_179 |    125,004     .000336     .018327          0          1
     mom_180 |    125,004     .000296    .0172019          0          1
-------------+---------------------------------------------------------
     mom_181 |    125,004     .000256    .0159978          0          1
     mom_182 |    125,004      .00028    .0167307          0          1
     mom_183 |    125,004     .000168    .0129602          0          1
     mom_184 |    125,004     .000288    .0169679          0          1
     mom_185 |    125,004     .000216    .0146952          0          1
-------------+---------------------------------------------------------
     mom_186 |    125,004     .000336     .018327          0          1
     mom_187 |    125,004     .000352    .0187581          0          1
     mom_188 |    125,004     .000248    .0157459          0          1
     mom_189 |    125,004     .000304    .0174327          0          1
     mom_190 |    125,004      .00028    .0167307          0          1
-------------+---------------------------------------------------------
     mom_191 |    125,004     .000336     .018327          0          1
     mom_192 |    125,004     .000352    .0187581          0          1
     mom_193 |    125,004     .000312    .0176606          0          1
     mom_194 |    125,004     .000312    .0176606          0          1
     mom_195 |    125,004     .000432    .0207799          0          1
-------------+---------------------------------------------------------
     mom_196 |    125,004      .00036      .01897          0          1
     mom_197 |    125,004     .000424    .0205866          0          1
     mom_198 |    125,004     .000376    .0193868          0          1
     mom_199 |    125,004      .00044    .0209713          0          1
     mom_200 |    125,004     .000312    .0176606          0          1
-------------+---------------------------------------------------------
     mom_201 |    125,004     .000432    .0207799          0          1
     mom_202 |    125,004      .00036      .01897          0          1
     mom_203 |    125,004     .000408    .0201946          0          1
     mom_204 |    125,004     .000272      .01649          0          1
     mom_205 |    125,004     .000472    .0217202          0          1
-------------+---------------------------------------------------------
     mom_206 |    125,004    546.5477    15729.51  -6148.955    1535286
     mom_207 |    125,004    779.7276    22014.55  -6148.958    1878418
     mom_208 |    125,004    678.0709    16944.53  -6148.955    1417523
     mom_209 |    125,004    832.6757    21065.57  -6148.951    1713279
     mom_210 |    125,004    796.4176    20783.62  -6148.953    1992065
-------------+---------------------------------------------------------
     mom_211 |    125,004    869.7703    21800.12  -6148.951    1868394
     mom_212 |    125,004    921.0771    22618.96   -6148.96    1815070
     mom_213 |    125,004     903.912    22099.02  -6148.957    1738078
     mom_214 |    125,004    978.5726    24360.11  -6148.954    1961319
     mom_215 |    125,004    979.0129    24140.91  -6148.956    1835403
-------------+---------------------------------------------------------
     mom_216 |    125,004    971.6368    23215.08  -6148.958    1624803
     mom_217 |    125,004    1166.282     28721.7  -6148.951    1984345
     mom_218 |    125,004    1128.434    27830.13  -6148.948    1977161
     mom_219 |    125,004     1178.85    28024.01  -6148.956    1970572
     mom_220 |    125,004    996.7615    25979.78  -6148.953    1976626
-------------+---------------------------------------------------------
     mom_221 |    125,004    1019.458    25640.02   -6148.96    1629752
     mom_222 |    125,004    1059.978    27574.48   -6148.94    1899601
     mom_223 |    125,004     1179.43    29126.94  -6148.954    1855414
     mom_224 |    125,004    1078.409     29254.9  -6148.947    1980847
     mom_225 |    125,004    996.2505    25715.84  -6148.962    1827752
-------------+---------------------------------------------------------
     mom_226 |    125,004    962.8913    27257.84  -6148.969    1909702
     mom_227 |    125,004    945.7599    25187.73   -6148.95    1872403
     mom_228 |    125,004    1027.823     28392.5  -6148.966    1957109
     mom_229 |    125,004    935.7017     27464.9  -6148.939    1929934
     mom_230 |    125,004    762.1273    23327.88   -6148.96    1861938
-------------+---------------------------------------------------------
     mom_231 |    125,004    804.4427    25256.25  -6148.967    1974986
     mom_232 |    125,004     675.897     22316.9  -6148.965    1782264
     mom_233 |    125,004     679.501    23367.52  -6148.945    1993553
     mom_234 |    125,004    646.5477    21029.93  -6148.944    1567927
     mom_235 |    125,004    593.2185    22059.71  -6148.948    1876413
-------------+---------------------------------------------------------
     mom_236 |    125,004    604.0234    21747.59  -6148.948    1924329
     mom_237 |    125,004    644.6613    23816.33  -6148.947    1971287
     mom_238 |    125,004    694.6768    24080.54  -6148.943    1895903
     mom_239 |    125,004    518.3267    19810.21  -6148.968    1810990
     mom_240 |    125,004    619.7919    23645.47  -6148.964    1943576
-------------+---------------------------------------------------------
     mom_241 |    125,004     524.549    21626.96  -6148.957    1969963
     mom_242 |    125,004    499.1095     18526.6  -6148.955    1866349
     mom_243 |    125,004    540.8681    19927.76  -6148.947    1875343
     mom_244 |    125,004    593.3399    22384.17  -6148.952    1895021
     mom_245 |    125,004     419.493    18068.88  -6148.942    1664543
-------------+---------------------------------------------------------
     mom_246 |    125,004    522.9794    20087.64  -6148.957    1965598
     mom_247 |    125,004    417.3826    17900.41  -6148.951    1868309
     mom_248 |    125,004    471.3599    19047.37  -6148.941    1892816
     mom_249 |    125,004    382.1065    17815.37  -6148.955    1983673
     mom_250 |    125,004    297.9159    15521.56  -6148.964    1968637
-------------+---------------------------------------------------------
     mom_251 |    125,004    259.5921    13333.09  -6148.964    1674885
     mom_252 |    125,004    249.4779     13964.2  -6148.956    1934114
     mom_253 |    125,004    205.5597    11501.42  -6148.952    1716024
     mom_254 |    125,004    150.2258    9999.381  -6148.958    1887440
     mom_255 |    125,004    146.2447    9412.781  -6148.965    1169731

.         outsheet using params/input/data_adjusted.csv, replace comma nonames 
> nolabel

. restore

. 
. preserve

.         keep in_*

.         sum in_*

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
        in_1 |    125,004     .000512    .0226214          0          1
        in_2 |    125,004       .0004    .0199958          0          1
        in_3 |    125,004     .000576    .0239928          0          1
        in_4 |    125,004     .000488    .0220851          0          1
        in_5 |    125,004     .000512    .0226214          0          1
-------------+---------------------------------------------------------
        in_6 |    125,004     .000624    .0249719          0          1
        in_7 |    125,004     .000632    .0251314          0          1
        in_8 |    125,004     .000672    .0259139          0          1
        in_9 |    125,004     .000672    .0259139          0          1
       in_10 |    125,004     .000664    .0257593          0          1
-------------+---------------------------------------------------------
       in_11 |    125,004      .00068    .0260676          0          1
       in_12 |    125,004      .00064    .0252898          0          1
       in_13 |    125,004     .000672    .0259139          0          1
       in_14 |    125,004      .00068    .0260676          0          1
       in_15 |    125,004      .00076    .0275573          0          1
-------------+---------------------------------------------------------
       in_16 |    125,004     .000784    .0279887          0          1
       in_17 |    125,004     .000776    .0278456          0          1
       in_18 |    125,004      .00088    .0296514          0          1
       in_19 |    125,004     .000688    .0262204          0          1
       in_20 |    125,004     .000816    .0285537          0          1
-------------+---------------------------------------------------------
       in_21 |    125,004     .000904    .0300526          0          1
       in_22 |    125,004     .000816    .0285537          0          1
       in_23 |    125,004     .000904    .0300526          0          1
       in_24 |    125,004     .000904    .0300526          0          1
       in_25 |    125,004     .000904    .0300526          0          1
-------------+---------------------------------------------------------
       in_26 |    125,004     .000864    .0293808          0          1
       in_27 |    125,004     .001016    .0318582          0          1
       in_28 |    125,004     .000968    .0310973          0          1
       in_29 |    125,004      .00108    .0328452          0          1
       in_30 |    125,004     .001008    .0317326          0          1
-------------+---------------------------------------------------------
       in_31 |    125,004        .001    .0316066          0          1
       in_32 |    125,004      .00092    .0303172          0          1
       in_33 |    125,004        .001    .0316066          0          1
       in_34 |    125,004     .000984     .031353          0          1
       in_35 |    125,004      .00104    .0322319          0          1
-------------+---------------------------------------------------------
       in_36 |    125,004    .0016239    .0402657          0          1
       in_37 |    125,004    .0017759    .0421047          0          1
       in_38 |    125,004    .0017119    .0413404          0          1
       in_39 |    125,004    .0018719    .0432256          0          1
       in_40 |    125,004    .0016719    .0408554          0          1
-------------+---------------------------------------------------------
       in_41 |    125,004    .0017759    .0421047          0          1
       in_42 |    125,004    .0017759    .0421047          0          1
       in_43 |    125,004    .0017759    .0421047          0          1
       in_44 |    125,004    .0018239    .0426688          0          1
       in_45 |    125,004    .0017199    .0414367          0          1
-------------+---------------------------------------------------------
       in_46 |    125,004    .0017199    .0414367          0          1
       in_47 |    125,004    .0018239    .0426688          0          1
       in_48 |    125,004    .0016559    .0406598          0          1
       in_49 |    125,004    .0016959    .0411471          0          1
       in_50 |    125,004     .001464    .0382338          0          1
-------------+---------------------------------------------------------
       in_51 |    125,004    .0015999    .0399675          0          1
       in_52 |    125,004      .00148    .0384418          0          1
       in_53 |    125,004     .001504    .0387518          0          1
       in_54 |    125,004     .001536    .0391613          0          1
       in_55 |    125,004      .00144    .0379195          0          1
-------------+---------------------------------------------------------
       in_56 |    125,004     .001344    .0366355          0          1
       in_57 |    125,004     .001328    .0364171          0          1
       in_58 |    125,004     .001312    .0361973          0          1
       in_59 |    125,004       .0014    .0373899          0          1
       in_60 |    125,004     .001344    .0366355          0          1
-------------+---------------------------------------------------------
       in_61 |    125,004       .0014    .0373899          0          1
       in_62 |    125,004     .001296    .0359762          0          1
       in_63 |    125,004     .001456    .0381293          0          1
       in_64 |    125,004     .001384     .037176          0          1
       in_65 |    125,004     .001264    .0355299          0          1
-------------+---------------------------------------------------------
       in_66 |    125,004     .001352    .0367442          0          1
       in_67 |    125,004     .001192    .0345044          0          1
       in_68 |    125,004     .001456    .0381293          0          1
       in_69 |    125,004     .001312    .0361973          0          1
       in_70 |    125,004     .001232    .0350778          0          1
-------------+---------------------------------------------------------
       in_71 |    125,004    .0053598    .0730147          0          1
       in_72 |    125,004    .0055038    .0739836          0          1
       in_73 |    125,004    .0055118    .0740371          0          1
       in_74 |    125,004    .0052638    .0723614          0          1
       in_75 |    125,004    .0054478    .0736084          0          1
-------------+---------------------------------------------------------
       in_76 |    125,004    .0050878    .0711477          0          1
       in_77 |    125,004    .0050798     .071092          0          1
       in_78 |    125,004    .0047998    .0691147          0          1
       in_79 |    125,004    .0045519     .067314          0          1
       in_80 |    125,004    .0046079    .0677249          0          1
-------------+---------------------------------------------------------
       in_81 |    125,004    .0041119    .0639921          0          1
       in_82 |    125,004    .0040799    .0637437          0          1
       in_83 |    125,004    .0037519    .0611378          0          1
       in_84 |    125,004    .0036879    .0606161          0          1
       in_85 |    125,004    .0034559    .0586854          0          1
-------------+---------------------------------------------------------
       in_86 |    125,004    .0033359     .057661          0          1
       in_87 |    125,004    .0029839    .0545438          0          1
       in_88 |    125,004    .0028079    .0529155          0          1
       in_89 |    125,004    .0027039     .051929          0          1
       in_90 |    125,004    .0024959     .049897          0          1
-------------+---------------------------------------------------------
       in_91 |    125,004    .0024239    .0491738          0          1
       in_92 |    125,004    .0026159    .0510793          0          1
       in_93 |    125,004    .0025839    .0507667          0          1
       in_94 |    125,004    .0023919     .048849          0          1
       in_95 |    125,004    .0021999     .046852          0          1
-------------+---------------------------------------------------------
       in_96 |    125,004    .0021039    .0458206          0          1
       in_97 |    125,004    .0019359    .0439569          0          1
       in_98 |    125,004    .0017519    .0418197          0          1
       in_99 |    125,004    .0017839    .0421992          0          1
      in_100 |    125,004    .0018159    .0425753          0          1
-------------+---------------------------------------------------------
      in_101 |    125,004    .0015919    .0398676          0          1
      in_102 |    125,004    .0016479    .0405616          0          1
      in_103 |    125,004     .001496    .0386488          0          1
      in_104 |    125,004     .001328    .0364171          0          1
      in_105 |    125,004     .001384     .037176          0          1
-------------+---------------------------------------------------------
      in_106 |    125,004    .0208873    .1430077          0          1
      in_107 |    125,004    .0207593    .1425782          0          1
      in_108 |    125,004    .0213033    .1443941          0          1
      in_109 |    125,004    .0213273    .1444736          0          1
      in_110 |    125,004    .0213033    .1443941          0          1
-------------+---------------------------------------------------------
      in_111 |    125,004    .0210953    .1437027          0          1
      in_112 |    125,004    .0212873     .144341          0          1
      in_113 |    125,004    .0217753    .1459497          0          1
      in_114 |    125,004    .0219673    .1465773          0          1
      in_115 |    125,004    .0216633    .1455822          0          1
-------------+---------------------------------------------------------
      in_116 |    125,004    .0203593    .1412268          0          1
      in_117 |    125,004    .0200154    .1400532          0          1
      in_118 |    125,004    .0202474    .1408459          0          1
      in_119 |    125,004    .0198714    .1395588          0          1
      in_120 |    125,004    .0191594    .1370856          0          1
-------------+---------------------------------------------------------
      in_121 |    125,004    .0190474    .1366921          0          1
      in_122 |    125,004    .0186234    .1351914          0          1
      in_123 |    125,004    .0179994    .1329496          0          1
      in_124 |    125,004    .0171515    .1298361          0          1
      in_125 |    125,004    .0168635    .1287603          0          1
-------------+---------------------------------------------------------
      in_126 |    125,004    .0159515    .1252883          0          1
      in_127 |    125,004    .0152395    .1225047          0          1
      in_128 |    125,004    .0146155    .1200085          0          1
      in_129 |    125,004    .0137036    .1162578          0          1
      in_130 |    125,004    .0126956    .1119577          0          1
-------------+---------------------------------------------------------
      in_131 |    125,004    .0120476    .1090989          0          1
      in_132 |    125,004    .0115836    .1070025          0          1
      in_133 |    125,004    .0116236    .1071849          0          1
      in_134 |    125,004    .0105037    .1019481          0          1
      in_135 |    125,004    .0102157    .1005554          0          1
-------------+---------------------------------------------------------
      in_136 |    125,004    .0100877      .09993          0          1
      in_137 |    125,004    .0094477    .0967394          0          1
      in_138 |    125,004    .0089037    .0939389          0          1
      in_139 |    125,004    .0085917    .0922929          0          1
      in_140 |    125,004    .0082077    .0902244          0          1
-------------+---------------------------------------------------------
      in_141 |    125,004    .0077678    .0877922          0          1
      in_142 |    125,004    .0075998     .086845          0          1
      in_143 |    125,004    .0076558    .0871619          0          1
      in_144 |    125,004    .0072878    .0850571          0          1
      in_145 |    125,004    .0069358    .0829923          0          1
-------------+---------------------------------------------------------
      in_146 |    125,004    .0065438    .0806289          0          1
      in_147 |    125,004    .0063278    .0792957          0          1
      in_148 |    125,004    .0060798     .077736          0          1
      in_149 |    125,004    .0055918    .0745694          0          1
      in_150 |    125,004    .0048318    .0693436          0          1
-------------+---------------------------------------------------------
      in_151 |    125,004    .0044719    .0667225          0          1
      in_152 |    125,004    .0037199    .0608775          0          1
      in_153 |    125,004    .0032319    .0567581          0          1
      in_154 |    125,004    .0031679    .0561951          0          1
      in_155 |    125,004    .0032399     .056828          0          1
-------------+---------------------------------------------------------
      in_156 |    125,004    .0345749    .1827012          0          1
      in_157 |    125,004    .0345749    .1827012          0          1
      in_158 |    125,004    .0351669    .1842022          0          1
      in_159 |    125,004    .0351029    .1840406          0          1
      in_160 |    125,004    .0348149    .1833114          0          1
-------------+---------------------------------------------------------
      in_161 |    125,004    .0345109    .1825381          0          1
      in_162 |    125,004    .0341989    .1817405          0          1
      in_163 |    125,004    .0344389    .1823544          0          1
      in_164 |    125,004    .0341029    .1814943          0          1
      in_165 |    125,004    .0335749     .180133          0          1
-------------+---------------------------------------------------------
      in_166 |    125,004     .031367    .1743082          0          1
      in_167 |    125,004     .030831    .1728604          0          1
      in_168 |    125,004     .030175    .1710694          0          1
      in_169 |    125,004    .0296471    .1696123          0          1
      in_170 |    125,004    .0282311    .1656331          0          1
-------------+---------------------------------------------------------
      in_171 |    125,004    .0277831    .1643515          0          1
      in_172 |    125,004    .0267431    .1613324          0          1
      in_173 |    125,004    .0257112    .1582729          0          1
      in_174 |    125,004    .0242392    .1537917          0          1
      in_175 |    125,004    .0236552    .1519732          0          1
-------------+---------------------------------------------------------
      in_176 |    125,004    .0224313    .1480821          0          1
      in_177 |    125,004    .0217273    .1457923          0          1
      in_178 |    125,004    .0208793    .1429809          0          1
      in_179 |    125,004    .0196714    .1388689          0          1
      in_180 |    125,004    .0181914    .1336437          0          1
-------------+---------------------------------------------------------
      in_181 |    125,004    .0173834    .1306958          0          1
      in_182 |    125,004    .0167755    .1284297          0          1
      in_183 |    125,004    .0166955    .1281283          0          1
      in_184 |    125,004    .0155595     .123764          0          1
      in_185 |    125,004    .0151275    .1220606          0          1
-------------+---------------------------------------------------------
      in_186 |    125,004    .0147755    .1206538          0          1
      in_187 |    125,004    .0139196    .1171576          0          1
      in_188 |    125,004    .0135436    .1155865          0          1
      in_189 |    125,004    .0128716    .1127209          0          1
      in_190 |    125,004    .0124876    .1110485          0          1
-------------+---------------------------------------------------------
      in_191 |    125,004    .0116156    .1071485          0          1
      in_192 |    125,004    .0114316    .1063064          0          1
      in_193 |    125,004    .0112796    .1056054          0          1
      in_194 |    125,004    .0108317    .1035105          0          1
      in_195 |    125,004    .0100237    .0996157          0          1
-------------+---------------------------------------------------------
      in_196 |    125,004    .0099197    .0991028          0          1
      in_197 |    125,004    .0092717    .0958426          0          1
      in_198 |    125,004    .0089597    .0942311          0          1
      in_199 |    125,004    .0080477    .0893479          0          1
      in_200 |    125,004    .0071278     .084125          0          1
-------------+---------------------------------------------------------
      in_201 |    125,004    .0064398    .0799898          0          1
      in_202 |    125,004    .0055278    .0741438          0          1
      in_203 |    125,004    .0048718    .0696286          0          1
      in_204 |    125,004    .0046479    .0680168          0          1
      in_205 |    125,004    .0045199     .067078          0          1
-------------+---------------------------------------------------------
      in_206 |    125,004    .0051278    .0714254          0          1
      in_207 |    125,004    .0055198    .0740905          0          1
      in_208 |    125,004    .0053758     .073123          0          1
      in_209 |    125,004    .0050718    .0710363          0          1
      in_210 |    125,004    .0051358    .0714808          0          1
-------------+---------------------------------------------------------
      in_211 |    125,004    .0051918    .0718674          0          1
      in_212 |    125,004    .0053678    .0730689          0          1
      in_213 |    125,004    .0053358    .0728519          0          1
      in_214 |    125,004    .0049678    .0703079          0          1
      in_215 |    125,004    .0049598    .0702516          0          1
-------------+---------------------------------------------------------
      in_216 |    125,004    .0047278    .0685969          0          1
      in_217 |    125,004    .0050798     .071092          0          1
      in_218 |    125,004    .0047758    .0689426          0          1
      in_219 |    125,004    .0046399    .0679585          0          1
      in_220 |    125,004    .0040479    .0634942          0          1
-------------+---------------------------------------------------------
      in_221 |    125,004    .0041999    .0646704          0          1
      in_222 |    125,004    .0039279    .0625498          0          1
      in_223 |    125,004    .0039759    .0629293          0          1
      in_224 |    125,004    .0035199    .0592244          0          1
      in_225 |    125,004    .0033919    .0581413          0          1
-------------+---------------------------------------------------------
      in_226 |    125,004    .0031999    .0564773          0          1
      in_227 |    125,004    .0031279    .0558403          0          1
      in_228 |    125,004    .0030079     .054762          0          1
      in_229 |    125,004    .0027199     .052082          0          1
      in_230 |    125,004    .0022479    .0473592          0          1
-------------+---------------------------------------------------------
      in_231 |    125,004    .0022239    .0471063          0          1
      in_232 |    125,004    .0020719    .0454715          0          1
      in_233 |    125,004    .0019759    .0444077          0          1
      in_234 |    125,004    .0019919    .0445868          0          1
      in_235 |    125,004    .0016799    .0409529          0          1
-------------+---------------------------------------------------------
      in_236 |    125,004    .0016799    .0409529          0          1
      in_237 |    125,004    .0015759    .0396671          0          1
      in_238 |    125,004    .0019039    .0435928          0          1
      in_239 |    125,004    .0015759    .0396671          0          1
      in_240 |    125,004    .0015679    .0395664          0          1
-------------+---------------------------------------------------------
      in_241 |    125,004     .001352    .0367442          0          1
      in_242 |    125,004     .001472    .0383379          0          1
      in_243 |    125,004     .001544    .0392629          0          1
      in_244 |    125,004      .00152    .0389571          0          1
      in_245 |    125,004     .001128    .0335664          0          1
-------------+---------------------------------------------------------
      in_246 |    125,004     .001384     .037176          0          1
      in_247 |    125,004     .001168    .0341556          0          1
      in_248 |    125,004     .001352    .0367442          0          1
      in_249 |    125,004     .001016    .0318582          0          1
      in_250 |    125,004      .00096    .0309686          0          1
-------------+---------------------------------------------------------
      in_251 |    125,004     .000792     .028131          0          1
      in_252 |    125,004     .000744    .0272659          0          1
      in_253 |    125,004     .000672    .0259139          0          1
      in_254 |    125,004     .000528    .0229719          0          1
      in_255 |    125,004     .000512    .0226214          0          1

.         outsheet using params/input/select_adjusted.csv, replace comma noname
> s nolabel

. restore

. 
. 
. 
. 
. global ntot = _N

. file open obs using "params/input/nobs.dat", write text replace

. file write obs ("$nobs")  _n

. file write obs ("$ntot")  _n

. file close obs

. 
. use $src/data/data_adjusted.dta, clear
(Fonseca, Michaud, Kapteyn and Galama (2017) - PSID extract, ver32)

. 
. capture program drop onemom

. program onemom, eclass 
  1.   tempname mom
  2.         local nages = 84 - 35 + 1
  3.         local nwork = 69 - 35 + 1
  4. 
.         matrix mom = J(1,3*`nages' + 3*`nwork',0) 
  5.         local i = 1
  6.         tabstat pwork if rshlt3==1&rage<=69, by(rage) save
  7.         forvalues j = 1/`nwork' {
  8.                 matrix mom[1,`i'] = r(Stat`j')
  9.                 local i = `i' + 1
 10.         }
 11.         tabstat pwork if rshlt3==2, by(rage) save 
 12.         forvalues j = 1/`nwork' {
 13.                 matrix mom[1,`i'] = r(Stat`j')
 14.                 local i = `i' + 1
 15.         }
 16.         tabstat pwork if rshlt3==3, by(rage) save 
 17.         forvalues j = 1/`nwork' {
 18.                 matrix mom[1,`i'] = r(Stat`j')
 19.                 local i = `i' + 1
 20.         }
 21.         tabstat pmed , by(rage) save 
 22.         forvalues j = 1/`nages' {
 23.                 matrix mom[1,`i'] = r(Stat`j')
 24.                 local i = `i' + 1
 25.         }
 26.         tabstat pdead, by(rage) save 
 27.         forvalues j = 1/`nages' {
 28.                 matrix mom[1,`i'] = r(Stat`j')
 29.                 local i = `i' + 1
 30.         }
 31.         tabstat ppoor, by(rage) save 
 32.         forvalues j = 1/`nages' {
 33. *               matrix mom[1,`i'] = r(Stat`j')
. *               local i = `i' + 1
.         }
 34.         tabstat pvgood, by(rage) save
 35.         forvalues j = 1/`nages' {
 36. *               matrix mom[1,`i'] = r(Stat`j')
. *               local i = `i' + 1
.         } 
 37.         tabstat pass, by(rage) save
 38.         forvalues j = 1/`nages' {
 39.                 matrix mom[1,`i'] = r(Stat`j')
 40.                 local i = `i' + 1
 41.         }
 42.         ereturn post mom 
 43. end

. 
. tsset, clear

. bootstrap _b, reps(100) seed(10101) nodots nowarn cluster(id): onemom

Bootstrap results                               Number of obs     =    125,004
                                                Replications      =        100

                                 (Replications based on 50,755 clusters in id)
------------------------------------------------------------------------------
             |   Observed   Bootstrap                         Normal-based
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
          c1 |   .9120495   .0354838    25.70   0.000     .8425025    .9815965
          c2 |   .7143582   .0680733    10.49   0.000      .580937    .8477793
          c3 |   .8488685   .0405863    20.92   0.000     .7693209    .9284161
          c4 |   .7988292   .0553885    14.42   0.000     .6902697    .9073886
          c5 |   .8020094   .0510291    15.72   0.000     .7019942    .9020246
          c6 |   .8724012   .0387084    22.54   0.000     .7965341    .9482683
          c7 |   .8528012   .0395721    21.55   0.000     .7752412    .9303611
          c8 |   .8445154   .0431404    19.58   0.000     .7599617    .9290691
          c9 |   .7907694   .0432642    18.28   0.000     .7059731    .8755656
         c10 |   .7687707   .0471041    16.32   0.000     .6764483    .8610931
         c11 |   .7306584   .0438569    16.66   0.000     .6447004    .8166164
         c12 |   .7811664   .0525541    14.86   0.000     .6781624    .8841705
         c13 |   .7113965    .054447    13.07   0.000     .6046824    .8181106
         c14 |   .7431841   .0451298    16.47   0.000     .6547314    .8316369
         c15 |   .7693092   .0428971    17.93   0.000     .6852325    .8533859
         c16 |     .72487   .0479444    15.12   0.000     .6309007    .8188393
         c17 |   .7423951   .0376386    19.72   0.000     .6686248    .8161654
         c18 |    .692967    .044087    15.72   0.000     .6065581    .7793759
         c19 |   .6035901   .0606148     9.96   0.000     .4847873    .7223928
         c20 |   .6214977   .0476986    13.03   0.000     .5280101    .7149853
         c21 |   .6002042   .0534684    11.23   0.000     .4954081    .7050003
         c22 |   .5886634   .0465935    12.63   0.000     .4973417     .679985
         c23 |   .5349303   .0487272    10.98   0.000     .4394266    .6304339
         c24 |   .4904533   .0407589    12.03   0.000     .4105674    .5703392
         c25 |   .5710193   .0444575    12.84   0.000     .4838842    .6581545
         c26 |   .5362387   .0472852    11.34   0.000     .4435614    .6289159
         c27 |   .5763421   .0405828    14.20   0.000     .4968012    .6558829
         c28 |   .5217137   .0401021    13.01   0.000     .4431151    .6003123
         c29 |   .4924922   .0398381    12.36   0.000     .4144109    .5705734
         c30 |   .3666697   .0397683     9.22   0.000     .2887253     .444614
         c31 |   .3248894   .0390061     8.33   0.000      .248439    .4013399
         c32 |   .2153581    .042775     5.03   0.000     .1315207    .2991955
         c33 |   .2390668   .0394725     6.06   0.000     .1617021    .3164316
         c34 |   .2130971   .0361273     5.90   0.000     .1422889    .2839053
         c35 |    .183262   .0361328     5.07   0.000     .1124431     .254081
         c36 |   .9665602   .0143297    67.45   0.000     .9384746    .9946458
         c37 |   .9465871   .0181649    52.11   0.000     .9109846    .9821897
         c38 |   .9576269   .0154543    61.96   0.000      .927337    .9879169
         c39 |   .9513344   .0159176    59.77   0.000     .9201364    .9825324
         c40 |   .9759047   .0159669    61.12   0.000       .94461    1.007199
         c41 |   .9527516   .0161399    59.03   0.000     .9211179    .9843853
         c42 |   .9789278   .0127485    76.79   0.000     .9539412    1.003915
         c43 |   .9584778    .016126    59.44   0.000     .9268714    .9900842
         c44 |   .9587956   .0155038    61.84   0.000     .9284087    .9891826
         c45 |   .9597595   .0163156    58.82   0.000     .9277815    .9917376
         c46 |    .964062   .0157859    61.07   0.000     .9331223    .9950018
         c47 |    .913522   .0217026    42.09   0.000     .8709858    .9560583
         c48 |   .9396527   .0198852    47.25   0.000     .9006784    .9786271
         c49 |   .9732467   .0138733    70.15   0.000     .9460555    1.000438
         c50 |   .9442256   .0168497    56.04   0.000     .9112009    .9772504
         c51 |   .9341881   .0193328    48.32   0.000     .8962965    .9720798
         c52 |   .9203039   .0207495    44.35   0.000     .8796357    .9609722
         c53 |   .9157989   .0176153    51.99   0.000     .8812737    .9503242
         c54 |   .9233923   .0189465    48.74   0.000     .8862578    .9605268
         c55 |   .9338064   .0180639    51.69   0.000     .8984018     .969211
         c56 |   .8810075   .0258641    34.06   0.000     .8303148    .9317003
         c57 |   .9155234   .0226413    40.44   0.000     .8711471    .9598996
         c58 |   .8529312   .0308653    27.63   0.000     .7924363    .9134262
         c59 |   .8789031   .0233774    37.60   0.000     .8330842     .924722
         c60 |   .8302366   .0286676    28.96   0.000     .7740492    .8864241
         c61 |   .8119758   .0314854    25.79   0.000     .7502655    .8736862
         c62 |   .8383927   .0278617    30.09   0.000     .7837848    .8930006
         c63 |   .7507062   .0304449    24.66   0.000     .6910353    .8103772
         c64 |   .7603445   .0366759    20.73   0.000     .6884611    .8322278
         c65 |   .5772381   .0344632    16.75   0.000     .5096915    .6447848
         c66 |    .521661   .0381372    13.68   0.000     .4469135    .5964085
         c67 |   .4820883   .0402491    11.98   0.000     .4032014    .5609751
         c68 |   .3927934    .037134    10.58   0.000     .3200122    .4655746
         c69 |    .336904    .035089     9.60   0.000     .2681308    .4056771
         c70 |   .3202334   .0326731     9.80   0.000     .2561953    .3842715
         c71 |   .9907221   .0075234   131.68   0.000     .9759764    1.005468
         c72 |   .9931365   .0065157   152.42   0.000      .980366    1.005907
         c73 |   .9831401   .0083874   117.22   0.000      .966701    .9995791
         c74 |   .9873235   .0066986   147.39   0.000     .9741944    1.000453
         c75 |   .9828368   .0081016   121.31   0.000     .9669579    .9987157
         c76 |   .9700902   .0075239   128.93   0.000     .9553437    .9848368
         c77 |   .9736418   .0077445   125.72   0.000     .9584628    .9888207
         c78 |   .9811905   .0068515   143.21   0.000     .9677618    .9946192
         c79 |   .9880162   .0058662   168.42   0.000     .9765186    .9995138
         c80 |   .9642169   .0090992   105.97   0.000     .9463827    .9820511
         c81 |   .9791232   .0069656   140.57   0.000      .965471    .9927755
         c82 |   .9796334   .0076664   127.78   0.000     .9646075    .9946593
         c83 |   .9550115   .0099146    96.32   0.000     .9355792    .9744438
         c84 |   .9785243   .0072397   135.16   0.000     .9643347    .9927138
         c85 |   .9807939   .0074855   131.03   0.000     .9661226    .9954652
         c86 |   .9783252   .0075306   129.91   0.000     .9635656    .9930849
         c87 |   .9753048   .0084467   115.47   0.000     .9587496      .99186
         c88 |   .9563055    .010914    87.62   0.000     .9349145    .9776966
         c89 |   .9432918   .0118798    79.40   0.000     .9200079    .9665758
         c90 |   .9603468   .0109356    87.82   0.000     .9389135    .9817802
         c91 |   .9299235   .0138231    67.27   0.000     .9028306    .9570164
         c92 |   .9445826   .0127563    74.05   0.000     .9195807    .9695845
         c93 |   .9511208   .0126632    75.11   0.000     .9263014    .9759403
         c94 |   .9330487   .0130748    71.36   0.000     .9074226    .9586749
         c95 |   .8893487   .0193271    46.02   0.000     .8514682    .9272291
         c96 |   .8924994   .0189233    47.16   0.000     .8554104    .9295883
         c97 |   .8486699   .0241558    35.13   0.000     .8013254    .8960144
         c98 |   .8784566   .0216018    40.67   0.000     .8361179    .9207953
         c99 |   .8118543   .0242898    33.42   0.000     .7642473    .8594614
        c100 |   .7243104   .0310535    23.32   0.000     .6634467    .7851741
        c101 |   .6059216   .0351653    17.23   0.000     .5369988    .6748444
        c102 |   .5917054   .0365016    16.21   0.000     .5201635    .6632474
        c103 |   .5171025   .0392201    13.18   0.000     .4402326    .5939725
        c104 |   .4411915   .0367806    12.00   0.000     .3691027    .5132802
        c105 |   .4083983   .0343571    11.89   0.000     .3410596     .475737
        c106 |  -251.6985    101.279    -2.49   0.013    -450.2016   -53.19535
        c107 |  -27.29579   103.4356    -0.26   0.792    -230.0259    175.4343
        c108 |    402.443   161.0435     2.50   0.012     86.80345    718.0825
        c109 |   128.4243   82.78167     1.55   0.121     -33.8248    290.6734
        c110 |   345.6016   122.4936     2.82   0.005     105.5185    585.6846
        c111 |   529.9548   138.8104     3.82   0.000     257.8914    802.0183
        c112 |   831.8143   132.2601     6.29   0.000     572.5894    1091.039
        c113 |   1041.715   129.1383     8.07   0.000     788.6083    1294.821
        c114 |   1123.312   147.6186     7.61   0.000     833.9845    1412.639
        c115 |   1031.951    127.477     8.10   0.000     782.1009    1281.801
        c116 |   1384.171   146.7575     9.43   0.000     1096.532     1671.81
        c117 |   1734.834   166.6736    10.41   0.000     1408.159    2061.508
        c118 |   2096.207   151.0909    13.87   0.000     1800.075     2392.34
        c119 |   2533.694   204.2836    12.40   0.000     2133.305    2934.082
        c120 |   2541.359   186.1261    13.65   0.000     2176.558    2906.159
        c121 |   2596.228   191.7658    13.54   0.000     2220.374    2972.082
        c122 |   3227.914   213.7144    15.10   0.000     2809.041    3646.786
        c123 |   3521.356   218.5621    16.11   0.000     3092.982     3949.73
        c124 |   3729.154   222.5966    16.75   0.000     3292.872    4165.435
        c125 |   3769.136   199.3756    18.90   0.000     3378.367    4159.905
        c126 |   4652.677   214.4287    21.70   0.000     4232.405     5072.95
        c127 |   4819.839   286.7422    16.81   0.000     4257.835    5381.844
        c128 |    5153.44   258.0465    19.97   0.000     4647.678    5659.202
        c129 |   5839.361   288.3891    20.25   0.000     5274.129    6404.593
        c130 |   6686.271   309.5717    21.60   0.000     6079.522     7293.02
        c131 |   6328.204   295.0032    21.45   0.000     5750.008      6906.4
        c132 |   6245.962    250.347    24.95   0.000     5755.291    6736.633
        c133 |   6950.277   357.3211    19.45   0.000      6249.94    7650.613
        c134 |   8294.258   357.0517    23.23   0.000     7594.449    8994.066
        c135 |   9162.447   414.1192    22.13   0.000     8350.789    9974.106
        c136 |   8630.119   315.1277    27.39   0.000      8012.48    9247.758
        c137 |   9029.453   365.8882    24.68   0.000     8312.325    9746.581
        c138 |    9657.59   449.2313    21.50   0.000     8777.112    10538.07
        c139 |   9843.097   427.6389    23.02   0.000      9004.94    10681.25
        c140 |   9583.421   442.7767    21.64   0.000     8715.595    10451.25
        c141 |   10518.81   480.2415    21.90   0.000     9577.553    11460.07
        c142 |   11266.09   474.8749    23.72   0.000     10335.36    12196.83
        c143 |   11578.49   444.2011    26.07   0.000     10707.87    12449.11
        c144 |   13075.42   541.2587    24.16   0.000     12014.57    14136.27
        c145 |   11628.59   498.1362    23.34   0.000     10652.26    12604.92
        c146 |   12665.08   545.9282    23.20   0.000     11595.08    13735.08
        c147 |   14163.99   638.2146    22.19   0.000     12913.11    15414.87
        c148 |   13405.71   565.1125    23.72   0.000     12298.11    14513.31
        c149 |   13659.71    736.784    18.54   0.000     12215.64    15103.78
        c150 |   13322.23   530.9576    25.09   0.000     12281.57    14362.88
        c151 |   13800.52   607.1975    22.73   0.000     12610.44    14990.61
        c152 |    13668.5   691.6401    19.76   0.000     12312.91    15024.09
        c153 |   15100.13   957.3125    15.77   0.000     13223.83    16976.43
        c154 |   14109.52    837.096    16.86   0.000     12468.85     15750.2
        c155 |   13447.38   796.8469    16.88   0.000     11885.59    15009.17
        c156 |   .0030079   .0007799     3.86   0.000     .0014794    .0045364
        c157 |   .0027765   .0008878     3.13   0.002     .0010365    .0045165
        c158 |   .0020473   .0006854     2.99   0.003      .000704    .0033907
        c159 |   .0015953   .0006161     2.59   0.010     .0003878    .0028027
        c160 |   .0022978   .0006894     3.33   0.001     .0009466     .003649
        c161 |   .0030134   .0008461     3.56   0.000      .001355    .0046719
        c162 |   .0039766   .0010732     3.71   0.000     .0018732      .00608
        c163 |   .0027875   .0007224     3.86   0.000     .0013716    .0042033
        c164 |   .0032841   .0008287     3.96   0.000     .0016599    .0049082
        c165 |   .0061949   .0014257     4.35   0.000     .0034006    .0089893
        c166 |   .0048457   .0010188     4.76   0.000     .0028489    .0068425
        c167 |    .004411   .0010537     4.19   0.000     .0023458    .0064762
        c168 |   .0058324   .0013645     4.27   0.000      .003158    .0085069
        c169 |   .0026983   .0009236     2.92   0.003     .0008881    .0045085
        c170 |   .0059507   .0011963     4.97   0.000     .0036061    .0082953
        c171 |   .0071984   .0015099     4.77   0.000      .004239    .0101578
        c172 |   .0086748   .0015844     5.48   0.000     .0055695    .0117802
        c173 |   .0071562   .0015953     4.49   0.000     .0040295    .0102829
        c174 |   .0092409   .0016741     5.52   0.000     .0059598    .0125221
        c175 |   .0077782   .0017199     4.52   0.000     .0044072    .0111491
        c176 |   .0078459      .0015     5.23   0.000     .0049059     .010786
        c177 |    .007732   .0016375     4.72   0.000     .0045225    .0109414
        c178 |   .0088123    .001702     5.18   0.000     .0054764    .0121481
        c179 |   .0170801     .00245     6.97   0.000     .0122782     .021882
        c180 |   .0162709    .002588     6.29   0.000     .0111986    .0213432
        c181 |   .0147262   .0024579     5.99   0.000     .0099088    .0195436
        c182 |   .0166905    .002567     6.50   0.000     .0116592    .0217218
        c183 |   .0100623   .0022615     4.45   0.000     .0056299    .0144947
        c184 |    .018509   .0033155     5.58   0.000     .0120108    .0250072
        c185 |   .0142782   .0028506     5.01   0.000     .0086911    .0198652
        c186 |   .0227396    .003574     6.36   0.000     .0157347    .0297445
        c187 |   .0252874   .0034854     7.26   0.000      .018456    .0321187
        c188 |   .0183107   .0030817     5.94   0.000     .0122706    .0243507
        c189 |   .0236172   .0036732     6.43   0.000     .0164178    .0308165
        c190 |   .0224215   .0043394     5.17   0.000     .0139164    .0309266
        c191 |   .0289256   .0038227     7.57   0.000     .0214333    .0364179
        c192 |   .0307908   .0053367     5.77   0.000     .0203311    .0412504
        c193 |   .0276596   .0041346     6.69   0.000      .019556    .0357632
        c194 |   .0288035   .0044533     6.47   0.000     .0200753    .0375318
        c195 |   .0430966   .0057092     7.55   0.000     .0319068    .0542863
        c196 |   .0362903   .0049981     7.26   0.000     .0264942    .0460865
        c197 |   .0457291   .0061875     7.39   0.000     .0336019    .0578563
        c198 |   .0419643   .0057136     7.34   0.000     .0307658    .0531627
        c199 |    .054672   .0070942     7.71   0.000     .0407675    .0685764
        c200 |    .043771   .0064157     6.82   0.000     .0311964    .0563456
        c201 |   .0670807   .0083342     8.05   0.000     .0507461    .0834154
        c202 |    .065123   .0098713     6.60   0.000     .0457757    .0844703
        c203 |   .0837438   .0099353     8.43   0.000      .064271    .1032167
        c204 |   .0585198   .0093316     6.27   0.000     .0402301    .0768095
        c205 |   .1044248   .0118482     8.81   0.000     .0812027    .1276468
        c206 |   106584.5   7184.158    14.84   0.000     92503.78    120665.2
        c207 |   141259.5   9390.391    15.04   0.000     122854.7    159664.4
        c208 |   126133.3   7390.425    17.07   0.000     111648.3    140618.3
        c209 |   164176.3   9768.461    16.81   0.000     145030.5    183322.2
        c210 |   155070.7    9975.12    15.55   0.000     135519.8    174621.6
        c211 |   167526.6    10092.7    16.60   0.000     147745.3    187307.9
        c212 |   171592.1   10199.79    16.82   0.000     151600.9    191583.4
        c213 |   169404.2   9254.117    18.31   0.000     151266.5      187542
        c214 |   196981.5   11463.82    17.18   0.000     174512.8    219450.1
        c215 |     197388   11927.15    16.55   0.000     174011.2    220764.7
        c216 |   205513.5   11516.82    17.84   0.000       182941    228086.1
        c217 |   229590.5   13156.56    17.45   0.000     203804.1    255376.9
        c218 |   236279.4   13589.24    17.39   0.000       209645    262913.9
        c219 |   254070.7   13512.22    18.80   0.000     227587.2    280554.1
        c220 |   246243.4   14344.43    17.17   0.000     218128.9      274358
        c221 |   242735.8   15114.89    16.06   0.000     213111.1    272360.4
        c222 |   269860.4   16430.99    16.42   0.000     237656.2    302064.5
        c223 |   296646.8   16970.38    17.48   0.000     263385.5    329908.1
        c224 |   306376.1   19044.26    16.09   0.000       269050    343702.2
        c225 |   293715.3    14433.8    20.35   0.000     265425.6      322005
        c226 |   300913.2   19473.83    15.45   0.000     262745.2    339081.2
        c227 |   302362.6   15584.73    19.40   0.000     271817.1    332908.1
        c228 |   341707.4   21011.37    16.26   0.000     300525.9      382889
        c229 |     344019   19632.58    17.52   0.000     305539.8    382498.1
        c230 |   339035.4   21731.74    15.60   0.000       296442    381628.9
        c231 |   361721.4    26084.8    13.87   0.000     310596.1    412846.7
        c232 |   326215.6   22377.92    14.58   0.000     282355.6    370075.5
        c233 |     343888   24259.13    14.18   0.000       296341    391435.1
        c234 |   324582.5   17568.44    18.48   0.000       290149      359016
        c235 |   353117.6   27458.45    12.86   0.000       299300    406935.1
        c236 |   359549.2   24394.45    14.74   0.000       311737    407361.5
        c237 |   409062.1   33499.14    12.21   0.000       343405    474719.2
        c238 |   364862.9   23207.07    15.72   0.000     319377.9      410348
        c239 |     328898   26895.69    12.23   0.000     276183.4    381612.6
        c240 |   395288.1   30146.34    13.11   0.000     336202.3    454373.8
        c241 |   387992.5    33545.8    11.57   0.000     322243.9      453741
        c242 |   339079.8   25879.26    13.10   0.000     288357.4    389802.2
        c243 |   350314.4   24469.46    14.32   0.000     302355.1    398273.7
        c244 |   390367.7    30300.9    12.88   0.000       330979    449756.3
        c245 |   371902.8   31806.77    11.69   0.000     309562.7      434243
        c246 |   377887.4   28262.41    13.37   0.000     322494.1    433280.7
        c247 |   357359.6   30892.13    11.57   0.000     296812.1      417907
        c248 |   348650.1   25439.21    13.71   0.000     298790.2    398510.1
        c249 |   376101.1   39550.91     9.51   0.000     298582.8    453619.5
        c250 |     310339   30680.02    10.12   0.000     250207.3    370470.7
        c251 |   327778.3   36036.25     9.10   0.000     257148.6    398408.1
        c252 |   335330.5   39673.61     8.45   0.000     257571.7    413089.4
        c253 |   305902.3   35994.42     8.50   0.000     235354.5      376450
        c254 |   284527.7   43654.63     6.52   0.000     198966.2    370089.2
        c255 |   285643.2   42415.99     6.73   0.000     202509.4    368777.1
------------------------------------------------------------------------------

. 
. matrix result = (e(b)',e(se)')

. matrix colnames result = moments se_moments

. svmat result

. keep if result1!=.
(124,749 observations deleted)

. keep result1 result2

. outsheet using params/input/moments.csv, replace comma nolabel nonames

. 
. 
. exit

end of do-file


. 
. * stats from PSID and MEPS

. do do/stats-meps32.do

. *************************************************
. * Constructing MEPS and NHIS Panel Statistics                      *
. * Fonseca, Michaud, Kapteyn and Galama 
. * version 32
. *************************************************
. 
. use "$src/data/meps-nhis_wide_extract.dta", clear
(MEPS1996-2008)

. sum

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    dupersid |     55,007    5.41e+07    2.68e+07       2018   9.84e+07
       fhlth |     46,059    3.393408    .7735117          1          4
         age |     55,007    47.84936    14.94729         25         84
        hlth |     54,637    3.419203     .731566          2          4
    fmepsexp |     45,535    4474.191    10213.37          0   99651.57
-------------+---------------------------------------------------------
      smoken |     20,015    .2702973    .4441244          0          1
      smokev |     20,015    .5382463    .4985475          0          1
       obese |     39,923    .2784861    .4482595          0          1
      totinc |     55,006    34388.93    31474.08          0     437861
     mepsexp |     54,712     4541.68    10476.61          0   99961.88
-------------+---------------------------------------------------------
          mx |     39,893    .0111292    .0179499      .0012     .12114
        male |     55,007           1           0          1          1
         byr |     55,007    1954.679      15.344       1912       1983
       byr_c |     55,007     5.29589    1.572602          1          7
        educ |     54,538    2.462723    1.104549          1          4
-------------+---------------------------------------------------------
       perwt |     55,007    10803.29    6920.269          0   84587.12
        year |     55,007    2002.529    3.759467       1996       2008
     mepsslf |     55,005     875.915    2155.033          0   97422.79
      inscov |     55,007    1.485411    .7756104          1          3

. sum year age byr totinc obese smokev mx mepsexp inscov 

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
        year |     55,007    2002.529    3.759467       1996       2008
         age |     55,007    47.84936    14.94729         25         84
         byr |     55,007    1954.679      15.344       1912       1983
      totinc |     55,006    34388.93    31474.08          0     437861
       obese |     39,923    .2784861    .4482595          0          1
-------------+---------------------------------------------------------
      smokev |     20,015    .5382463    .4985475          0          1
          mx |     39,893    .0111292    .0179499      .0012     .12114
     mepsexp |     54,712     4541.68    10476.61          0   99961.88
      inscov |     55,007    1.485411    .7756104          1          3

. replace mepsexp = . if mepsexp > 100000
(0 real changes made)

. sum year age byr totinc hlth obese smokev mx mepsexp inscov 

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
        year |     55,007    2002.529    3.759467       1996       2008
         age |     55,007    47.84936    14.94729         25         84
         byr |     55,007    1954.679      15.344       1912       1983
      totinc |     55,006    34388.93    31474.08          0     437861
        hlth |     54,637    3.419203     .731566          2          4
-------------+---------------------------------------------------------
       obese |     39,923    .2784861    .4482595          0          1
      smokev |     20,015    .5382463    .4985475          0          1
          mx |     39,893    .0111292    .0179499      .0012     .12114
     mepsexp |     54,712     4541.68    10476.61          0   99961.88
      inscov |     55,007    1.485411    .7756104          1          3

. tab inscov

   1 inscov |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |     37,981       69.05       69.05
          2 |      7,351       13.36       82.41
          3 |      9,675       17.59      100.00
------------+-----------------------------------
      Total |     55,007      100.00

. tab hlth

         1 hlth |      Freq.     Percent        Cum.
----------------+-----------------------------------
      poor-fair |      7,969       14.59       14.59
           good |     15,795       28.91       43.49
vgood-excellent |     30,873       56.51      100.00
----------------+-----------------------------------
          Total |     54,637      100.00

. 
. 
. 
end of do-file

. do do/stats-psid32.do

. *************************************************
. * Constructing PSID Panel Statistics                     *
. * Fonseca, Michaud, Kapteyn and Galama (2018)
. * version 32
. * Inputs
. * PSID Cornell Equivalence Files  1984-2005     *
. * wealth files (1984,1989,1994,1999,2001(2)2005 *
. * Individual files (1986, 1994-2005)            *
. * Outputs                                                       *
. *************************************************
. 
. use "$src/data/psid_extract.dta", clear
(Fonseca, Michaud, Kapteyn and Galama (2017) - PSID extract, ver32)

. 
. sum

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      hhidpn |     60,178     1561691    876148.9       4001    6478046
        hhid |     60,178    3796.842    2506.671          1      16968
        year |     60,178    1993.956    6.226469       1984       2005
     wgid_cs |     60,178    23.64189    19.50105          0    173.563
        rage |     60,178    45.12023    15.42421         22         99
-------------+---------------------------------------------------------
      rskill |     57,356    .4935491    .4999627          0          1
      rbyr_c |     60,178     3.86633    1.504549          1          6
     eqscale |     60,178    1.998436    .6127109          1   5.727298
      hhsize |     60,178    2.919605    1.318581          1          6
    hnadults |     60,178    2.373342    .9976052          1         10
-------------+---------------------------------------------------------
        male |     60,178           1           0          1          1
      spouse |     60,172    .8342252    .3718814          0          1
         ass |     25,467    199759.1    306840.7   -1228330    1999702
      riearn |     59,895    45043.92    67051.21          0    5513360
   logriearn |     48,483    10.62531    .6912828   8.518792   12.76482
-------------+---------------------------------------------------------
       rwage |     51,383    24.88264    43.15154          0   4796.746
    logrwage |     50,439    2.931705    .7786869  -7.874975   8.475693
    otherinc |     59,895    17352.34    28588.21          0    2401979
       hipen |     59,895    2325.778    8810.699          0   445793.5
     hissben |     59,895     2703.18    6730.717          0   251430.8
-------------+---------------------------------------------------------
       rshlt |     60,178    3.750208    1.063508          1          5
      rshlt3 |     60,178    2.505151    .7047811          1          3
      rshlt2 |     60,178    .8766327    .3288611          0          1
       death |     60,178    .0069959    .0833492          0          1
         bmi |     19,370    27.48563    4.718684   6.640547   67.87968
-------------+---------------------------------------------------------
       obese |     19,370    .2394941    .4267857          0          1
       rwork |     60,178    .8358536    .3704114          0          1
     ssclaim |      1,280    .4242187     .494417          0          1
       rpart |     60,178    1.487088    .7603523          1          3
          mx |     60,178      .01209    .0254149      .0012     .43372
-------------+---------------------------------------------------------
      _merge |     60,178           3           0          3          3

. keep if rage>=25&rage<=84
(2,917 observations deleted)

. sum

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      hhidpn |     57,261     1562976    875594.7       4001    6478046
        hhid |     57,261     3764.11    2486.053          1      16968
        year |     57,261    1993.964    6.218584       1984       2005
     wgid_cs |     57,261    23.72175     19.6176          0    173.563
        rage |     57,261    45.48103    14.47063         25         84
-------------+---------------------------------------------------------
      rskill |     54,630      .50108    .5000034          0          1
      rbyr_c |     57,261    3.826741    1.462299          1          6
     eqscale |     57,261    2.019819    .6108833          1   5.727298
      hhsize |     57,261    2.962033    1.317601          1          6
    hnadults |     57,261    2.407118    1.003463          1         10
-------------+---------------------------------------------------------
        male |     57,261           1           0          1          1
      spouse |     57,255    .8468431    .3601418          0          1
         ass |     24,196    206291.8    310495.6   -1228330    1999702
      riearn |     56,992    46332.19    68173.18          0    5513360
   logriearn |     46,406    10.65182    .6847457   8.518792   12.76482
-------------+---------------------------------------------------------
       rwage |     49,152    25.31647    38.31324          0   4176.788
    logrwage |     48,217    2.957087    .7738037  -7.874975   8.337297
    otherinc |     56,992    17925.14    29071.06          0    2401979
       hipen |     56,992    2373.365    8921.601          0   445793.5
     hissben |     56,992    2667.136    6670.324          0   251430.8
-------------+---------------------------------------------------------
       rshlt |     57,261    3.748223    1.059224          1          5
      rshlt3 |     57,261    2.504934    .7033657          1          3
      rshlt2 |     57,261    .8776305    .3277149          0          1
       death |     57,261    .0063743    .0795852          0          1
         bmi |     18,431    27.57316    4.709764   6.640547   67.87968
-------------+---------------------------------------------------------
       obese |     18,431    .2437741    .4293696          0          1
       rwork |     57,261    .8397339    .3668559          0          1
     ssclaim |      1,280    .4242187     .494417          0          1
       rpart |     57,261    1.475297    .7549384          1          3
          mx |     57,261     .010553     .017849      .0012     .13468
-------------+---------------------------------------------------------
      _merge |     57,261           3           0          3          3

.         
. *birth date
. tab rbyr_c

 birth year |
      group |
(1935-1945= |
    3, ref) |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      5,783       10.10       10.10
          2 |      6,059       10.58       20.68
          3 |      7,755       13.54       34.22
          4 |     16,773       29.29       63.52
          5 |     14,481       25.29       88.81
          6 |      6,410       11.19      100.00
------------+-----------------------------------
      Total |     57,261      100.00

. 
. *Health 3 and 5
. sum rshlt rshlt3

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       rshlt |     57,261    3.748223    1.059224          1          5
      rshlt3 |     57,261    2.504934    .7033657          1          3

. tab rshlt3

     health |
  status (3 |
       cat) |      Freq.     Percent        Cum.
------------+-----------------------------------
        bad |      7,007       12.24       12.24
       good |     14,334       25.03       37.27
  excellent |     35,920       62.73      100.00
------------+-----------------------------------
      Total |     57,261      100.00

. *Education
. sum rskill

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      rskill |     54,630      .50108    .5000034          0          1

. tab rskill

  education |
   level, 2 |
        cat |      Freq.     Percent        Cum.
------------+-----------------------------------
 no college |     27,256       49.89       49.89
    college |     27,374       50.11      100.00
------------+-----------------------------------
      Total |     54,630      100.00

. *Participation
. sum rwork

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       rwork |     57,261    .8397339    .3668559          0          1

. tab rwork

      employment |
       status of |
      individual |      Freq.     Percent        Cum.
-----------------+-----------------------------------
not employed   0 |      9,177       16.03       16.03
employed       1 |     48,084       83.97      100.00
-----------------+-----------------------------------
           Total |     57,261      100.00

. 
. *Income
. gen riearn2 =riearn
(269 missing values generated)

. 
. replace riearn2 = . if riearn>=250000
(523 real changes made, 523 to missing)

. replace otherinc = . if otherinc>=250000
(55 real changes made, 55 to missing)

. 
. *Wealth
. replace ass = 0 if ass<0
(1,807 real changes made)

. 
. table year, c(mean ass)

----------------------
year of   |
interview |  mean(ass)
----------+-----------
     1984 |     169087
     1985 |           
     1986 |           
     1987 |           
     1988 |           
     1989 |   195742.2
     1990 |           
     1991 |           
     1992 |           
     1993 |           
     1994 |   199393.9
     1995 |           
     1996 |           
     1997 |           
     1999 |   206125.8
     2001 |   214036.3
     2003 |   212284.9
     2005 |   241204.7
----------------------

. 
. sum rage rskill rwork riearn2 otherinc ass 

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
        rage |     57,261    45.48103    14.47063         25         84
      rskill |     54,630      .50108    .5000034          0          1
       rwork |     57,261    .8397339    .3668559          0          1
     riearn2 |     56,469    42272.73    37077.41          0   249951.1
    otherinc |     56,937    17521.27    23027.49          0   248947.3
-------------+---------------------------------------------------------
         ass |     24,196    208155.1    308670.5          0    1999702

. 
. 
.         
.         
.         
. 
. 
end of do-file

. 
. * MCBS auxiliary data for discussion

. do do/mcbs_nursing.do

. * manipulation of Eric's File for Share nursing home
. * dollars of 2004
. 
. use $src/raw/other/mcbs_nursing.dta, clear

. 
. replace total = total*196.3/188.9
(36 real changes made)

. replace nursing = nursing*196.3/188.9
(36 real changes made)

. 
. gen mcbsexp = total - nursing

. 
. #d ;
delimiter now ;
. twoway
> (line total age)
> (line mcbsexp age),
> xlabel(65(5)100,labsize(small))
> ylabel(,labsize(small))
> xtitle("age", size(small)) $fig
> ytitle("average spending in MCBS", size(small))
> legend(label(1 "total spending") label(2 "non-NH spending") size(small))
> name(mcbs);

. #d ;
delimiter now ;
. twoway
> (area nursing_frac age),
> xlabel(65(5)100,labsize(small))
> ylabel(,labsize(small)) $fig
> xtitle("age", size(small))
> ytitle("NH share of total spending in MCBS", size(small))
> legend(off)
> name(share);

. #d cr
delimiter now cr
. 
. graph combine mcbs share, rows(2)

. graph export figures/mcbs_share.eps, replace
(file figures/mcbs_share.eps written in EPS format)

. 
. 
. list age nursing_frac nursing total mcbsexp

     +----------------------------------------------------+
     | age   nursing~c     nursing       total    mcbsexp |
     |----------------------------------------------------|
  1. |  65   .06818473   433.11871   6352.1368   5919.018 |
  2. |  66   .05442333   523.07318    9611.193    9088.12 |
  3. |  67   .06213614   631.00001   10155.122   9524.121 |
  4. |  68   .06765982   713.42446   10544.285    9830.86 |
  5. |  69   .07331585   821.50555    11205.02   10383.51 |
     |----------------------------------------------------|
  6. |  70   .08356315   985.17815   11789.625   10804.45 |
  7. |  71   .08942878   1054.7631   11794.448   10739.69 |
  8. |  72   .09844224   1248.1217   12678.721    11430.6 |
  9. |  73    .0903698   1151.9235   12746.775   11594.85 |
 10. |  74   .10652428   1406.7249   13205.674   11798.95 |
     |----------------------------------------------------|
 11. |  75   .11875817   1637.6496   13789.784   12152.13 |
 12. |  76   .12597123   1747.7151   13873.923   12126.21 |
 13. |  77   .13992421   2118.8263   15142.671   13023.84 |
 14. |  78     .165641   2679.3609   16175.711   13496.35 |
 15. |  79   .18728495   3094.3489   16522.144   13427.79 |
     |----------------------------------------------------|
 16. |  80   .21816973   3601.6701   16508.569    12906.9 |
 17. |  81   .20519399   3439.4087   16761.742   13322.33 |
 18. |  82   .23176293   4171.9897   18001.109   13829.12 |
 19. |  83   .26275195   5014.7115   19085.345   14070.63 |
 20. |  84   .28408348   5537.2781   19491.729   13954.45 |
     |----------------------------------------------------|
 21. |  85   .30192418   6076.0716   20124.495   14048.42 |
 22. |  86   .32119799   6934.8075   21590.445   14655.64 |
 23. |  87   .36799088   8090.5402   21985.708   13895.17 |
 24. |  88   .38798301   9299.0784   23967.746   14668.67 |
 25. |  89   .43653644   11437.069   26199.574    14762.5 |
     |----------------------------------------------------|
 26. |  90   .46138965   11856.082   25696.463   13840.38 |
 27. |  91   .48227872   12795.177   26530.669   13735.49 |
 28. |  92   .51845106   14233.709   27454.295   13220.59 |
 29. |  93   .53975647   15669.948   29031.514   13361.57 |
 30. |  94   .55538291   17030.258   30663.994   13633.74 |
     |----------------------------------------------------|
 31. |  95   .59107301   17819.245   30147.283   12328.04 |
 32. |  96   .59353975   20653.221   34796.694   14143.47 |
 33. |  97   .64228641   21617.906   33657.735   12039.83 |
 34. |  98   .61160802   19044.655   31138.661   12094.01 |
 35. |  99   .66769274   23984.182   35920.987    11936.8 |
     |----------------------------------------------------|
 36. | 100   .69251241   26854.751   38778.728   11923.98 |
     +----------------------------------------------------+

. 
. 
end of do-file

. 
. * graph of health transitions

. do do/healthtrans.do

. *************************************************
. * Appendix D: Health Profiles                               *
. * Fonseca, Michaud, Kapteyn and Galama (2018)   *
. * Version 32
. *************************************************
. 
. 
. use $src/data/psid_extract.dta, clear
(Fonseca, Michaud, Kapteyn and Galama (2017) - PSID extract, ver32)

. * sample cuts
. keep if rage>=35&rage<=84
(18,203 observations deleted)

. egen rage5 = cut(rage), at(35(5)85) 

. drop if rshlt3==.
(0 observations deleted)

. drop if missing(hhidpn)
(0 observations deleted)

. char rbyr_c[omit] 3

. keep if year<=1997
(12,088 observations deleted)

. tsset hhidpn year
       panel variable:  hhidpn (unbalanced)
        time variable:  year, 1984 to 1997, but with gaps
                delta:  1 unit

. gen frshlt3 = f.rshlt3
(3,970 missing values generated)

. label def hlth 1 "poor" 2 "good" 3 "vgood"

. label values frshlt3 hlth

. gen poor = frshlt3==1 if frshlt3!=.
(3,970 missing values generated)

. gen good = frshlt3==2 if frshlt3!=.
(3,970 missing values generated)

. gen vgood = frshlt3==3 if frshlt3!=.
(3,970 missing values generated)

. foreach num of numlist 1 3 {
  2.         graph bar (mean) poor good vgood if rshlt3==`num', $fig over(rage5
> ) legend(rows(1) label(1 "poor") label(2 "good") label(3 "very good")) stack 
> ytitle("fraction health(t+1)") 
  3.         graph export "figures/healthtrans_psid_`num'.eps", as(eps) replace
  4. }
(file figures/healthtrans_psid_1.eps written in EPS format)
(file figures/healthtrans_psid_3.eps written in EPS format)

. 
. 
. use $src/data/meps-nhis_long_extract.dta, clear
(MEPS1996-2008)

. * sample cuts
. keep if age>=35&age<=84
(25,157 observations deleted)

. egen age5 = cut(age), at(35(5)85) 

. drop if hlth==.
(647 observations deleted)

. rename dupersid hhidpn

. destring hhidpn, replace
hhidpn: all characters numeric; replaced as long

. drop if missing(hhidpn)
(0 observations deleted)

. tsset hhidpn t
       panel variable:  hhidpn (unbalanced)
        time variable:  t, 1 to 2
                delta:  1 unit

. replace hlth = hlth-1
(83,029 real changes made)

. gen fhlth = f.hlth
(45,851 missing values generated)

. label def hlth 1 "poor" 2 "good" 3 "vgood"

. label values fhlth hlth

. gen poor = fhlth==1 if fhlth!=.
(45,851 missing values generated)

. gen good = fhlth==2 if fhlth!=.
(45,851 missing values generated)

. gen vgood = fhlth==3 if fhlth!=.
(45,851 missing values generated)

. foreach num of numlist 1 3 {
  2.         graph bar (mean) poor good vgood if hlth==`num', $fig over(age5) l
> egend(rows(1) label(1 "poor") label(2 "good") label(3 "very good")) stack yti
> tle("fraction health(t+1)") 
  3.         graph export "figures/healthtrans_meps_`num'.eps", as(eps) replace
  4. }
(file figures/healthtrans_meps_1.eps written in EPS format)
(file figures/healthtrans_meps_3.eps written in EPS format)

. 
. exit

end of do-file


. 
. * construction of consumption floor series

. do do/cfloor.do

. * computing cmin time series from Moffitt (2002)
. * http://www.econ2.jhu.edu/people/moffitt/ben_doc.pdf
. 
. * selection of variable, the real modified benefit is in 1996 dollars
. * same var as in Scholz et al. (2006)
. import delimited "$src/raw/other/ben_data_moffitt.csv", clear
(4 vars, 1,989 obs)

. 
. * first collapse by year using pop as weight
. replace cmin_real = . if cmin_real == -1
(316 real changes made, 316 to missing)

. collapse cmin_real [fw=pop], by(year)

. 
. * adjust to 2005 dollars
. replace cmin_real = cmin_real * (194.82/156.9)
(33 real changes made)

. 
. * since benefit is monthly, make annual
. replace cmin_real = cmin_real * 12
(33 real changes made)

. gen id = 1

. reshape wide cmin_real, i(id) j(year)
(note: j = 1960 1961 1962 1963 1964 1965 1966 1967 1968 1969 1970 1971 1972 197
> 3 1974 1975 1976 1977 1978 1979 1980 1981 1982 1983 1984 1985 1986 1987 1988 
> 1989 1990 1991 1992 1993 1994 1995 1996 1997 1998)

Data                               long   ->   wide
-----------------------------------------------------------------------------
Number of obs.                       39   ->       1
Number of variables                   3   ->      40
j variable (39 values)             year   ->   (dropped)
xij variables:
                              cmin_real   ->   cmin_real1960 cmin_real1961 ... 
> cmin_real1998
-----------------------------------------------------------------------------

. forvalues j = 1961/1998 {
  2.         local j1 = `j'-1
  3.         replace cmin_real`j' = cmin_real`j1' if cmin_real`j'==. & cmin_rea
> l`j1'!=.
  4. }
(1 real change made)
(1 real change made)
(1 real change made)
(0 real changes made)
(1 real change made)
(1 real change made)
(1 real change made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)

. 
. forvalues j = 1999/2060 {
  2.         gen cmin_real`j' = cmin_real1998
  3. } 

. reshape long cmin_real, i(id) j(year)
(note: j = 1960 1961 1962 1963 1964 1965 1966 1967 1968 1969 1970 1971 1972 197
> 3 1974 1975 1976 1977 1978 1979 1980 1981 1982 1983 1984 1985 1986 1987 1988 
> 1989 1990 1991 1992 1993 1994 1995 1996 1997 1998 1999 2000 2001 2002 2003 20
> 04 2005 2006 2007 2008 2009 2010 2011 2012 2013 2014 2015 2016 2017 2018 2019
>  2020 2021 2022 2023 2024 2025 2026 2027 2028 2029 2030 2031 2032 2033 2034 2
> 035 2036 2037 2038 2039 2040 2041 2042 2043 2044 2045 2046 2047 2048 2049 205
> 0 2051 2052 2053 2054 2055 2056 2057 2058 2059 2060)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                        1   ->     101
Number of variables                 102   ->       3
j variable (101 values)                   ->   year
xij variables:
cmin_real1960 cmin_real1961 ... cmin_real2060->cmin_real
-----------------------------------------------------------------------------

. drop if year<1965
(5 observations deleted)

. gen age = year - 1940

. 
. sum cmin_real if year<=2005

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
   cmin_real |         41    13735.44    1680.682    10172.3   16788.92

. egen cmin_mean = mean(cmin_real)

. #d ;
delimiter now ;
. twoway (line cmin_real year if year<=2005, lpattern(solid)) 
> (line cmin_mean year if year<=2005, lpattern(dash)),
>         xtitle("year") ytitle("ressource floor")
>         $fig
>         legend(label(1 "real ressource floor") label(2 "average"));

. #d cr
delimiter now cr
. graph export figures/xfloor.eps, as(eps) replace
(file figures/xfloor.eps written in EPS format)

. list age cmin_real

     +----------------+
     | age   cmin_r~l |
     |----------------|
  1. |  25   10833.15 |
  2. |  26   10833.15 |
  3. |  27   10833.15 |
  4. |  28    10172.3 |
  5. |  29   10439.07 |
     |----------------|
  6. |  30   16125.44 |
  7. |  31   16006.51 |
  8. |  32   15968.92 |
  9. |  33   15995.88 |
 10. |  34   16788.92 |
     |----------------|
 11. |  35    16373.8 |
 12. |  36   16172.31 |
 13. |  37   15804.38 |
 14. |  38   15564.96 |
 15. |  39   15497.69 |
     |----------------|
 16. |  40   14742.51 |
 17. |  41   14445.06 |
 18. |  42   13797.88 |
 19. |  43   13823.67 |
 20. |  44   13795.28 |
     |----------------|
 21. |  45   13730.55 |
 22. |  46   13765.85 |
 23. |  47   13582.86 |
 24. |  48   13656.08 |
 25. |  49   13722.51 |
     |----------------|
 26. |  50   14303.52 |
 27. |  51   13924.84 |
 28. |  52   13857.19 |
 29. |  53   13520.13 |
 30. |  54   13262.25 |
     |----------------|
 31. |  55   13116.48 |
 32. |  56   12899.89 |
 33. |  57   12508.18 |
 34. |  58   12911.06 |
 35. |  59   12911.06 |
     |----------------|
 36. |  60   12911.06 |
 37. |  61   12911.06 |
 38. |  62   12911.06 |
 39. |  63   12911.06 |
 40. |  64   12911.06 |
     |----------------|
 41. |  65   12911.06 |
 42. |  66   12911.06 |
 43. |  67   12911.06 |
 44. |  68   12911.06 |
 45. |  69   12911.06 |
     |----------------|
 46. |  70   12911.06 |
 47. |  71   12911.06 |
 48. |  72   12911.06 |
 49. |  73   12911.06 |
 50. |  74   12911.06 |
     |----------------|
 51. |  75   12911.06 |
 52. |  76   12911.06 |
 53. |  77   12911.06 |
 54. |  78   12911.06 |
 55. |  79   12911.06 |
     |----------------|
 56. |  80   12911.06 |
 57. |  81   12911.06 |
 58. |  82   12911.06 |
 59. |  83   12911.06 |
 60. |  84   12911.06 |
     |----------------|
 61. |  85   12911.06 |
 62. |  86   12911.06 |
 63. |  87   12911.06 |
 64. |  88   12911.06 |
 65. |  89   12911.06 |
     |----------------|
 66. |  90   12911.06 |
 67. |  91   12911.06 |
 68. |  92   12911.06 |
 69. |  93   12911.06 |
 70. |  94   12911.06 |
     |----------------|
 71. |  95   12911.06 |
 72. |  96   12911.06 |
 73. |  97   12911.06 |
 74. |  98   12911.06 |
 75. |  99   12911.06 |
     |----------------|
 76. | 100   12911.06 |
 77. | 101   12911.06 |
 78. | 102   12911.06 |
 79. | 103   12911.06 |
 80. | 104   12911.06 |
     |----------------|
 81. | 105   12911.06 |
 82. | 106   12911.06 |
 83. | 107   12911.06 |
 84. | 108   12911.06 |
 85. | 109   12911.06 |
     |----------------|
 86. | 110   12911.06 |
 87. | 111   12911.06 |
 88. | 112   12911.06 |
 89. | 113   12911.06 |
 90. | 114   12911.06 |
     |----------------|
 91. | 115   12911.06 |
 92. | 116   12911.06 |
 93. | 117   12911.06 |
 94. | 118   12911.06 |
 95. | 119   12911.06 |
     |----------------|
 96. | 120   12911.06 |
     +----------------+

. keep cmin_real

. outsheet using "params/input/cmin.csv", replace comma nonames nolabel

. 
end of do-file

. 
. exit
no; data in memory would be lost
r(4);

. 